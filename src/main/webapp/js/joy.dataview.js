/*! by joyone.cn 厦门展网信息技术有限公司  joyone 2015-04-30  1.0.20 */
!function(a,b){function c(b,d){b.filters&&(b.filters=a.grep(b.filters,function(a){return c(a,d),a.filters?a.filters.length:a.field!=d}))}function d(a){var b,c,d,e,f,g;if(a&&a.length)for(g=[],b=0,c=a.length;c>b;b++)d=a[b],f=d.text||d.value||d,e=null==d.value?d.text||d:d.value,g[b]={text:f,value:e};return g}function e(b,c){return a.grep(b,function(b){return b.filters?(b.filters=a.grep(b.filters,function(a){return a.field!=c}),b.filters.length):b.field!=c})}var f=window.joy,g=f.getPluginLang(),h=f.ui,i=a.proxy,j="joyPopup",k="init",l=".joyFilterMenu",m=g.filtermenu.EQ,n=g.filtermenu.NEQ,o={number:"numerictextbox",date:"datepicker"},p={string:"text",number:"number",date:"date"},q=f.isFunction,r=h.Widget,s='<div><div class="k-filter-help-text">#=messages.info#</div><label><input type="radio" data-#=ns#bind="checked: filters[0].value" value="true" name="filters[0].value"/>#=messages.isTrue#</label><label><input type="radio" data-#=ns#bind="checked: filters[0].value" value="false" name="filters[0].value"/>#=messages.isFalse#</label><div><button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div></div>',t='<div><div class="k-filter-help-text">#=messages.info#</div><select data-#=ns#bind="value: filters[0].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select>#if(values){#<select data-#=ns#bind="value:filters[0].value" data-#=ns#text-field="text" data-#=ns#value-field="value" data-#=ns#source=\'#=joy.stringify(values).replace(/\'/g,"&\\#39;")#\' data-#=ns#role="dropdownlist" data-#=ns#option-label="#=messages.selectValue#"></select>#}else{#<input data-#=ns#bind="value:filters[0].value" class="k-textbox" type="text" #=role ? "data-" + ns + "role=\'" + role + "\'" : ""# />#}##if(extra){#<select class="k-filter-and" data-#=ns#bind="value: logic" data-#=ns#role="dropdownlist"><option value="and">#=messages.and#</option><option value="or">#=messages.or#</option></select><select data-#=ns#bind="value: filters[1].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select>#if(values){#<select data-#=ns#bind="value:filters[1].value" data-#=ns#text-field="text" data-#=ns#value-field="value" data-#=ns#source=\'#=joy.stringify(values).replace(/\'/g,"&\\#39;")#\' data-#=ns#role="dropdownlist" data-#=ns#option-label="#=messages.selectValue#"></select>#}else{#<input data-#=ns#bind="value: filters[1].value" class="k-textbox" type="text" #=role ? "data-" + ns + "role=\'" + role + "\'" : ""#/>#}##}#<div><button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div></div>',u='<div data-#=ns#role="view" data-#=ns#init-widgets="false" class="k-grid-filter-menu"><div data-#=ns#role="header" class="k-header"><button class="k-button k-cancel">#=messages.cancel#</button>#=field#<button type="submit" class="k-button k-submit">#=messages.filter#</button></div><form class="k-filter-menu k-mobile-list"><ul class="k-filter-help-text"><li><span class="k-link">#=messages.info#</span><ul><li class="k-item"><label class="k-label">#=messages.operator#<select data-#=ns#bind="value: filters[0].operator">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select></label></li><li class="k-item"><label class="k-label">#=messages.value##if(values){#<select data-#=ns#bind="value:filters[0].value"><option value="">#=messages.selectValue#</option>#for(var val in values){#<option value="#=values[val].value#">#=values[val].text#</option>#}#</select>#}else{#<input data-#=ns#bind="value:filters[0].value" class="k-textbox" type="#=inputType#" #=useRole ? "data-" + ns + "role=\'" + role + "\'" : ""# />#}#</label></li>#if(extra){#</ul><ul class="k-filter-help-text"><li><span class="k-link"></span><li class="k-item"><label class="k-label"><input type="radio" name="logic" class="k-check" data-#=ns#bind="checked: logic" value="and" />#=messages.and#</label></li><li class="k-item"><label class="k-label"><input type="radio" name="logic" class="k-check" data-#=ns#bind="checked: logic" value="or" />#=messages.or#</label></li></ul><ul class="k-filter-help-text"><li><span class="k-link"></span><li class="k-item"><label class="k-label">#=messages.operator#<select data-#=ns#bind="value: filters[1].operator">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select></label></li><li class="k-item"><label class="k-label">#=messages.value##if(values){#<select data-#=ns#bind="value:filters[1].value"><option value="">#=messages.selectValue#</option>#for(var val in values){#<option value="#=values[val].value#">#=values[val].text#</option>#}#</select>#}else{#<input data-#=ns#bind="value:filters[1].value" class="k-textbox" type="#=inputType#" #=useRole ? "data-" + ns + "role=\'" + role + "\'" : ""# />#}#</label></li>#}#</ul></li><li class="k-button-container"><button type="reset" class="k-button">#=messages.clear#</button></li></ul></div></form></div>',v='<div data-#=ns#role="view" data-#=ns#init-widgets="false" class="k-grid-filter-menu"><div data-#=ns#role="header" class="k-header"><button class="k-button k-cancel">#=messages.cancel#</button>#=field#<button type="submit" class="k-button k-submit">#=messages.filter#</button></div><form class="k-filter-menu k-mobile-list"><ul class="k-filter-help-text"><li><span class="k-link">#=messages.info#</span><ul><li class="k-item"><label class="k-label"><input class="k-check" type="radio" data-#=ns#bind="checked: filters[0].value" value="true" name="filters[0].value"/>#=messages.isTrue#</label></li><li class="k-item"><label class="k-label"><input class="k-check" type="radio" data-#=ns#bind="checked: filters[0].value" value="false" name="filters[0].value"/>#=messages.isFalse#</label></li></ul></li><li class="k-button-container"><button type="reset" class="k-button">#=messages.clear#</button></li></ul></form></div>',w=r.extend({init:function(b,c){var d,e,g,h,j=this,k="string";r.fn.init.call(j,b,c),d=j.operators=c.operators||{},b=j.element,c=j.options,c.appendToElement||(g=b.addClass("k-with-icon k-filterable").find(".k-grid-filter"),g[0]||(g=b.prepend('<a class="k-grid-filter" href="#"><span class="k-icon k-filter"/></a>').find(".k-grid-filter")),g.attr("tabindex",-1).on("click"+l,i(j._click,j))),j.link=g||a(),j.dataSource=c.dataSource,j.field=c.field||b.attr(f.attr("field")),j.model=j.dataSource.reader.model,j._parse=function(a){return a+""},j.model&&j.model.fields&&(h=j.model.fields[j.field],h&&(k=h.type||"string",h.parse&&(j._parse=i(h.parse,h)))),c.values&&(k="enums"),j.type=k,d=d[k]||c.operators[k];for(e in d)break;j._defaultFilter=function(){return{field:j.field,operator:e||"eq",value:""}},j._refreshHandler=i(j.refresh,j),j.dataSource.bind("change",j._refreshHandler),c.appendToElement?j._init():j.refresh()},_init:function(){var b,c=this,d=c.options.ui,e=q(d);c.pane=c.options.pane,c.pane&&(c._isMobile=!0),e||(b=d||o[c.type]),c._isMobile?c._createMobileForm(b):c._createForm(b),c.form.on("submit"+l,i(c._submit,c)).on("reset"+l,i(c._reset,c)),e&&c.form.find(".k-textbox").removeClass("k-textbox").each(function(){d(a(this))}),c.form.find("["+f.attr("role")+"=numerictextbox]").removeClass("k-textbox").end().find("["+f.attr("role")+"=datetimepicker]").removeClass("k-textbox").end().find("["+f.attr("role")+"=timepicker]").removeClass("k-textbox").end().find("["+f.attr("role")+"=datepicker]").removeClass("k-textbox"),c.refresh(),c.trigger(k,{field:c.field,container:c.form})},_createForm:function(b){var c=this,e=c.options,g=c.operators||{},h=c.type;g=g[h]||e.operators[h],c.form=a('<form class="k-filter-menu"/>').html(f.template("boolean"===h?s:t)({field:c.field,format:e.format,ns:f.ns,messages:e.messages,extra:e.extra,operators:g,type:h,role:b,values:d(e.values)})),e.appendToElement?(c.element.append(c.form),c.popup=c.element.closest(".k-popup").data(j)):c.popup=c.form[j]({anchor:c.link,open:i(c._open,c),activate:i(c._activate,c),close:function(){c.options.closeCallback&&c.options.closeCallback(c.element)}}).data(j),c.form.on("keydown"+l,i(c._keydown,c))},_createMobileForm:function(b){var c=this,e=c.options,g=c.operators||{},h=c.type;g=g[h]||e.operators[h],c.form=a("<div />").html(f.template("boolean"===h?v:u)({field:c.field,format:e.format,ns:f.ns,messages:e.messages,extra:e.extra,operators:g,type:h,role:b,useRole:!f.support.input.date&&"date"===h||"number"===h,inputType:p[h],values:d(e.values)})),c.view=c.pane.append(c.form.html()),c.form=c.view.element.find("form"),c.view.element.on("click",".k-submit",function(a){c.form.submit(),a.preventDefault()}).on("click",".k-cancel",function(a){c._closeForm(),a.preventDefault()})},refresh:function(){var a=this,b=a.dataSource.filter()||{filters:[],logic:"and"};a.filterModel=f.observable({logic:"and",filters:[a._defaultFilter(),a._defaultFilter()]}),a.form&&f.bind(a.form.children().first(),a.filterModel),a._bind(b)?a.link.addClass("k-state-active"):a.link.removeClass("k-state-active")},destroy:function(){var a=this;r.fn.destroy.call(a),a.form&&(f.unbind(a.form),f.destroy(a.form),a.form.unbind(l),a.popup&&(a.popup.destroy(),a.popup=null),a.form=null),a.view&&(a.view.purge(),a.view=null),a.link.unbind(l),a._refreshHandler&&(a.dataSource.unbind("change",a._refreshHandler),a.dataSource=null),a.element=a.link=a._refreshHandler=a.filterModel=null},_bind:function(a){var b,c,d,e,f=this,g=a.filters,h=!1,i=0,j=f.filterModel;for(b=0,c=g.length;c>b;b++)e=g[b],e.field==f.field?(j.set("logic",a.logic),d=j.filters[i],d||(j.filters.push({field:f.field}),d=j.filters[i]),d.set("value",f._parse(e.value)),d.set("operator",e.operator),i++,h=!0):e.filters&&(h=h||f._bind(e));return h},_merge:function(b){var d,e,f,g=this,h=b.logic||"and",i=b.filters,j=g.dataSource.filter()||{filters:[],logic:"and"};for(c(j,g.field),i=a.grep(i,function(a){return""!==a.value&&null!=a.value}),e=0,f=i.length;f>e;e++)d=i[e],d.value=g._parse(d.value);return i.length&&(j.filters.length?(b.filters=i,"and"!==j.logic&&(j.filters=[{logic:j.logic,filters:j.filters}],j.logic="and"),j.filters.push(i.length>1?b:i[0])):(j.filters=i,j.logic=h)),j},filter:function(a){a=this._merge(a),a.filters.length&&this.dataSource.filter(a)},clear:function(){var b=this,c=b.dataSource.filter()||{filters:[]};c.filters=a.grep(c.filters,function(a){return a.filters?(a.filters=e(a.filters,b.field),a.filters.length):a.field!=b.field}),c.filters.length||(c=null),b.dataSource.filter(c)},_submit:function(a){a.preventDefault(),a.stopPropagation(),this.filter(this.filterModel.toJSON()),this._closeForm()},_reset:function(){this.clear(),this._closeForm()},_closeForm:function(){this._isMobile?this.pane.navigate("",this.options.animations.right):this.popup.close()},_click:function(a){a.preventDefault(),a.stopPropagation(),this.popup||this.pane||this._init(),this._isMobile?this.pane.navigate(this.view,this.options.animations.left):this.popup.toggle()},_open:function(){var b;a(".k-filter-menu").not(this.form).each(function(){b=a(this).data(j),b&&b.close()})},_activate:function(){this.form.find(":joyFocusable:first").focus()},_keydown:function(a){a.keyCode==f.keys.ESC&&this.popup.close()},events:[k],options:{name:"FilterMenu",extra:!0,appendToElement:!1,type:"string",operators:{string:{eq:m,neq:n,startswith:g.filtermenu.string.startswith,contains:g.filtermenu.string.contains,doesnotcontain:g.filtermenu.string.doesnotcontain,endswith:g.filtermenu.string.endswith},number:{eq:m,neq:n,gte:g.filtermenu.number.gte,gt:g.filtermenu.number.gt,lte:g.filtermenu.number.lte,lt:g.filtermenu.number.lt},date:{eq:m,neq:n,gte:g.filtermenu.date.gte,gt:g.filtermenu.date.gt,lte:g.filtermenu.date.lte,lt:g.filtermenu.date.lt},enums:{eq:m,neq:n}},messages:{info:g.filtermenu.info,isTrue:g.filtermenu.isTrue,isFalse:g.filtermenu.isFalse,filter:g.filtermenu.filter,clear:g.filtermenu.clear,and:g.filtermenu.and,or:g.filtermenu.or,selectValue:g.filtermenu.selectValue,operator:g.filtermenu.operator,value:g.filtermenu.value,cancel:g.filtermenu.cancel},animations:{left:g.filtermenu.left,right:g.filtermenu.right}}});h.plugin(w)}(jQuery),function(a,b){function c(a,b,c,d,e){return a({idx:b,text:c,ns:j.ns,numeric:d,title:e||""})}function d(a,b,c){return x({className:a.substring(1),text:b,wrapClassName:c||""})}function e(a,b,c,d){a.find(b).parent().attr(j.attr("page"),c).attr("tabindex",-1).toggleClass("k-state-disabled",d)}function f(a,b){e(a,o,1,1>=b)}function g(a,b){e(a,q,Math.max(1,b-1),1>=b)}function h(a,b,c){e(a,r,Math.min(c,b+1),b>=c)}function i(a,b,c){e(a,p,c,b>=c)}var j=window.joy,k=j.getPluginLang(),l=j.ui,m=l.Widget,n=a.proxy,o=".k-i-seek-w",p=".k-i-seek-e",q=".k-i-arrow-w",r=".k-i-arrow-e",s="change",t=".joyPager",u="click",v="keydown",w="disabled",x=j.template('<a href="\\#" title="#=text#" class="k-link k-pager-nav #= wrapClassName #"><span class="k-icon #= className #">#=text#</span></a>'),y=m.extend({init:function(b,c){var e,k,l=this;m.fn.init.call(l,b,c),c=l.options,l.dataSource=j.data.DataSource.create(c.dataSource),l.linkTemplate=j.template(l.options.linkTemplate),l.selectTemplate=j.template(l.options.selectTemplate),e=l.page(),k=l.totalPages(),l._refreshHandler=n(l.refresh,l),l.dataSource.bind(s,l._refreshHandler),c.previousNext&&(l.element.find(o).length||(l.element.append(d(o,c.messages.first,"k-pager-first")),f(l.element,e,k)),l.element.find(q).length||(l.element.append(d(q,c.messages.previous)),g(l.element,e,k))),c.numeric&&(l.list=l.element.find(".k-pager-numbers"),l.list.length||(l.list=a('<ul class="k-pager-numbers k-reset" />').appendTo(l.element))),c.input&&(l.element.find(".k-pager-input").length||l.element.append('<span class="k-pager-input k-label">'+c.messages.page+'<input class="k-textbox">'+j.format(c.messages.of,k)+"</span>"),l.element.on(v+t,".k-pager-input input",n(l._keydown,l))),c.previousNext&&(l.element.find(r).length||(l.element.append(d(r,c.messages.next)),h(l.element,e,k)),l.element.find(p).length||(l.element.append(d(p,c.messages.last,"k-pager-last")),i(l.element,e,k))),c.pageSizes&&(l.element.find(".k-pager-sizes").length||a('<span class="k-pager-sizes k-label"><select/>'+c.messages.itemsPerPage+"</span>").appendTo(l.element).find("select").html(a.map(a.isArray(c.pageSizes)?c.pageSizes:[5,10,20],function(a){return"<option>"+a+"</option>"}).join("")).end().appendTo(l.element),l.element.find(".k-pager-sizes select").val(l.pageSize()),j.ui.DropDownList&&l.element.find(".k-pager-sizes select").show().joyDropDownList(),l.element.on(s+t,".k-pager-sizes select",n(l._change,l))),c.refresh&&(l.element.find(".k-pager-refresh").length||l.element.append('<a href="#" class="k-pager-refresh k-link" title="'+c.messages.refresh+'"><span class="k-icon k-i-refresh">'+c.messages.refresh+"</span></a>"),l.element.on(u+t,".k-pager-refresh",n(l._refreshClick,l))),c.info&&(l.element.find(".k-pager-info").length||l.element.append('<span class="k-pager-info k-label" />')),l.element.on(u+t,"a",n(l._click,l)).addClass("k-pager-wrap k-widget"),c.autoBind&&l.refresh(),j.notify(l)},destroy:function(){var a=this;m.fn.destroy.call(a),a.element.off(t),a.dataSource.unbind(s,a._refreshHandler),a._refreshHandler=null,j.destroy(a.element),a.element=a.list=null},events:[s],options:{name:"Pager",selectTemplate:'<li><span class="k-state-selected">#=text#</span></li>',linkTemplate:'<li><a tabindex="-1" href="\\#" class="k-link" data-#=ns#page="#=idx#" #if (title !== "") {# title="#=title#" #}#>#=text#</a></li>',buttonCount:10,autoBind:!0,numeric:!0,info:!0,input:!1,previousNext:!0,pageSizes:!1,refresh:!1,messages:{display:k.pager.display,empty:k.pager.empty,page:k.pager.page,of:k.pager.of,itemsPerPage:k.pager.itemsPerPage,first:k.pager.first,previous:k.pager.previous,next:k.pager.next,last:k.pager.last,refresh:k.pager.refresh,morePages:k.pager.morePages}},setDataSource:function(a){var b=this;b.dataSource.unbind(s,b._refreshHandler),b.dataSource=b.options.dataSource=a,a.bind(s,b._refreshHandler),b.options.autoBind&&a.fetch()},refresh:function(a){var b,d,e,k=this,l=1,m="",n=k.page(),o=k.options,p=k.pageSize(),q=k.dataSource.total(),r=k.totalPages(),s=k.linkTemplate,t=o.buttonCount;if(!a||"itemchange"!=a.action){if(o.numeric){for(n>t&&(e=n%t,l=0===e?n-t+1:n-e+1),d=Math.min(l+t-1,r),l>1&&(m+=c(s,l-1,"...",!1,o.messages.morePages)),b=l;d>=b;b++)m+=c(b==n?k.selectTemplate:s,b,b,!0);r>d&&(m+=c(s,b,"...",!1,o.messages.morePages)),""===m&&(m=k.selectTemplate({text:0})),k.list.html(m)}o.info&&(m=q>0?j.format(o.messages.display,(n-1)*p+1,Math.min(n*p,q),q):o.messages.empty,k.element.find(".k-pager-info").html(m)),o.input&&k.element.find(".k-pager-input").html(k.options.messages.page+'<input class="k-textbox">'+j.format(o.messages.of,r)).find("input").val(n).attr(w,1>q).toggleClass("k-state-disabled",1>q),o.previousNext&&(f(k.element,n,r),g(k.element,n,r),h(k.element,n,r),i(k.element,n,r)),o.pageSizes&&k.element.find(".k-pager-sizes select").val(p).filter("["+j.attr("role")+"=dropdownlist]").joyDropDownList("value",p).joyDropDownList("text",p)}},_keydown:function(a){if(a.keyCode===j.keys.ENTER){var b=this.element.find(".k-pager-input").find("input"),c=parseInt(b.val(),10);(isNaN(c)||1>c||c>this.totalPages())&&(c=this.page()),b.val(c),this.page(c)}},_refreshClick:function(a){a.preventDefault(),this.dataSource.read()},_change:function(a){var b=parseInt(a.currentTarget.value,10);isNaN(b)||this.dataSource.pageSize(b)},_click:function(b){var c=a(b.currentTarget);b.preventDefault(),c.is(".k-state-disabled")||this.page(c.attr(j.attr("page")))},totalPages:function(){return Math.ceil((this.dataSource.total()||0)/this.pageSize())},pageSize:function(){return this.dataSource.pageSize()||this.dataSource.total()},page:function(a){return a===b?this.dataSource.total()>0?this.dataSource.page():0:(this.dataSource.page(a),void this.trigger(s,{index:a}))}});l.plugin(y)}(jQuery),function(a,b){function c(b){return a.trim(b).replace(/&nbsp;/gi,"")}function d(a,b){var c,d,e,f={};for(c=0,d=a.length;d>c;c++)e=a[c],f[e[b]]=e;return f}var e=window.joy,f=e.getPluginLang(),g=e.ui,h=a.proxy,i=a.extend,j=a.grep,k=a.map,l=a.inArray,m="k-state-selected",n="asc",o="desc",p="change",q="init",r="select",s="joyPopup",t="joyFilterMenu",u="joyMenu",v=".joyColumnMenu",w=g.Widget,x=w.extend({init:function(b,c){var d,f=this;w.fn.init.call(f,b,c),b=f.element,c=f.options,f.owner=c.owner,f.dataSource=c.dataSource,f.field=b.attr(e.attr("field")),d=b.find(".k-header-column-menu"),d[0]||(d=b.addClass("k-with-icon").prepend('<a class="k-header-column-menu" href="#"><span class="k-icon k-i-arrowhead-s"/></a>').find(".k-header-column-menu")),f.link=d.attr("tabindex",-1).on("click"+v,h(f._click,f)),f.wrapper=a('<div class="k-column-menu"/>')},_init:function(){var a=this;a.pane=a.options.pane,a.pane&&(a._isMobile=!0),a._isMobile?a._createMobileMenu():a._createMenu(),a._sort(),a._columns(),a._filter(),a._lockColumns(),a.trigger(q,{field:a.field,container:a.wrapper})},events:[q],options:{name:"ColumnMenu",messages:{sortAscending:f.columnmenu.sortAscending,sortDescending:f.columnmenu.sortDescending,filter:f.columnmenu.filter,columns:f.columnmenu.columns,done:f.columnmenu.done,settings:f.columnmenu.settings,lock:f.columnmenu.lock,unlock:f.columnmenu.unlock},filter:"",columns:!0,sortable:!0,filterable:!0,animations:{left:"slide"}},_createMenu:function(){var a=this,b=a.options;a.wrapper.html(e.template(y)({ns:e.ns,messages:b.messages,sortable:b.sortable,filterable:b.filterable,columns:a._ownerColumns(),showColumns:b.columns,lockedColumns:b.lockedColumns})),a.popup=a.wrapper[s]({anchor:a.link,open:h(a._open,a),activate:h(a._activate,a),close:function(){a.options.closeCallback&&a.options.closeCallback(a.element)}}).data(s),a.menu=a.wrapper.children()[u]({orientation:"vertical",closeOnClick:!1}).data(u)},_createMobileMenu:function(){var a=this,b=a.options,c=e.template(z)({ns:e.ns,field:a.field,messages:b.messages,sortable:b.sortable,filterable:b.filterable,columns:a._ownerColumns(),showColumns:b.columns,lockedColumns:b.lockedColumns});a.view=a.pane.append(c),a.wrapper=a.view.element.find(".k-column-menu"),a.menu=new A(a.wrapper.children(),{pane:a.pane}),a.view.element.on("click",".k-done",function(b){a.close(),b.preventDefault()}),a.options.lockedColumns&&a.view.bind("show",function(){a._updateLockedColumns()})},destroy:function(){var a=this;w.fn.destroy.call(a),a.filterMenu&&a.filterMenu.destroy(),a._refreshHandler&&a.dataSource.unbind(p,a._refreshHandler),a.options.columns&&a.owner&&(a.owner.unbind("columnShow",a._updateColumnsMenuHandler),a.owner.unbind("columnHide",a._updateColumnsMenuHandler)),a.menu&&(a.menu.element.off(v),a.menu.destroy()),a.wrapper.off(v),a.popup&&a.popup.destroy(),a.view&&a.view.purge(),a.link.off(v),a.owner=null,a.wrapper=null,a.element=null},close:function(){this.menu.close(),this.popup&&(this.popup.close(),this.popup.element.off("keydown"+v))},_click:function(a){a.preventDefault(),a.stopPropagation();var b=this.options;b.filter&&this.element.is(!b.filter)||(this.popup||this.pane||this._init(),this._isMobile?this.pane.navigate(this.view,this.options.animations.left):this.popup.toggle())},_open:function(){var b=this;a(".k-column-menu").not(b.wrapper).each(function(){a(this).data(s).close()}),b.popup.element.on("keydown"+v,function(a){a.keyCode==e.keys.ESC&&b.close()}),b.options.lockedColumns&&b._updateLockedColumns()},_activate:function(){this.menu.element.focus()},_ownerColumns:function(){var a=this.owner.columns,b=j(a,function(a){var b=!0,d=c(a.title||"");return(a.menu===!1||!a.field&&!d.length)&&(b=!1),b});return k(b,function(b){return{originalField:b.field,field:b.field||b.title,title:b.title||b.field,hidden:b.hidden,index:l(b,a),locked:!!b.locked}})},_sort:function(){var b=this;b.options.sortable&&(b.refresh(),b._refreshHandler=h(b.refresh,b),b.dataSource.bind(p,b._refreshHandler),b.menu.bind(r,function(c){var d,e=a(c.item);e.hasClass("k-sort-asc")?d=n:e.hasClass("k-sort-desc")&&(d=o),d&&(e.parent().find(".k-sort-"+(d==n?o:n)).removeClass(m),b._sortDataSource(e,d),b.close())}))},_sortDataSource:function(a,c){var d,e,f=this,g=f.options.sortable,h=f.dataSource,i=h.sort()||[];if(a.hasClass(m)&&g&&g.allowUnsort!==!1?(a.removeClass(m),c=b):a.addClass(m),g===!0||"single"===g.mode)i=[{field:f.field,dir:c}];else{for(d=0,e=i.length;e>d;d++)if(i[d].field===f.field){i.splice(d,1);break}i.push({field:f.field,dir:c})}h.sort(i)},_columns:function(){var b=this;b.options.columns&&(b._updateColumnsMenu(),b._updateColumnsMenuHandler=h(b._updateColumnsMenu,b),b.owner.bind(["columnHide","columnShow"],b._updateColumnsMenuHandler),b.menu.bind(r,function(c){var d,f,g,h,i=a(c.item),k=b.owner.columns;b._isMobile&&c.preventDefault(),i.parent().closest("li.k-columns-item")[0]&&(d=i.find(":checkbox"),d.attr("disabled")||(h=d.attr(e.attr("field")),g=j(k,function(a){return a.field==h||a.title==h})[0],f=l(g,k),g.hidden===!0?b.owner.showColumn(f):b.owner.hideColumn(f)))}))},_updateColumnsMenu:function(){var a,b,c,d,f,g=e.attr("field"),h=e.attr("locked"),i=j(this._ownerColumns(),function(a){return!a.hidden}),m=j(i,function(a){return a.originalField}),n=j(m,function(a){return a.locked===!0}).length,o=j(m,function(a){return a.locked!==!0}).length;i=k(i,function(a){return a.field});var p=this.wrapper.find(".k-columns-item input["+g+"]").prop("disabled",!1).prop("checked",!1);for(a=0,b=p.length;b>a;a++)c=p.eq(a),f="true"===c.attr(h),d=!1,l(c.attr(g),i)>-1&&(d=!0,c.prop("checked",d)),d&&(1==n&&f&&c.prop("disabled",!0),1!=o||f||c.prop("disabled",!0))},_updateColumnsLockedState:function(){var a,b,c,f,g=e.attr("field"),h=e.attr("locked"),i=d(this._ownerColumns(),"field"),j=this.wrapper.find(".k-columns-item input[type=checkbox]");for(a=0,b=j.length;b>a;a++)c=j.eq(a),f=i[c.attr(g)],f&&c.attr(h,f.locked);this._updateColumnsMenu()},_filter:function(){var b=this,c=b.options;c.filterable!==!1&&(b.filterMenu=b.wrapper.find(".k-filterable")[t](i(!0,{},{appendToElement:!0,dataSource:c.dataSource,values:c.values,field:b.field},c.filterable)).data(t),b._isMobile&&b.menu.bind(r,function(c){var d=a(c.item);d.hasClass("k-filter-item")&&b.pane.navigate(b.filterMenu.view,b.options.animations.left)}))},_lockColumns:function(){var b=this;b.menu.bind(r,function(c){var d=a(c.item);d.hasClass("k-lock")?(b.owner.lockColumn(b.field),b.close()):d.hasClass("k-unlock")&&(b.owner.unlockColumn(b.field),b.close())})},_updateLockedColumns:function(){var a=this.field,b=this.owner.columns,c=j(b,function(b){return b.field==a||b.title==a})[0],d=c.locked===!0,e=j(b,function(a){return!a.hidden&&(a.locked&&d||!a.locked&&!d)}).length,f=this.wrapper.find(".k-lock").removeClass("k-state-disabled"),g=this.wrapper.find(".k-unlock").removeClass("k-state-disabled");(d||1==e)&&f.addClass("k-state-disabled"),d&&1!=e||g.addClass("k-state-disabled"),this._updateColumnsLockedState()},refresh:function(){var a,b,c,d=this,e=d.options.dataSource.sort()||[],f=d.field;for(d.wrapper.find(".k-sort-asc, .k-sort-desc").removeClass(m),b=0,c=e.length;c>b;b++)a=e[b],f==a.field&&d.wrapper.find(".k-sort-"+a.dir).addClass(m)}}),y='<ul>#if(sortable){#<li class="k-item k-sort-asc"><span class="k-link"><span class="k-sprite k-i-sort-asc"></span>${messages.sortAscending}</span></li><li class="k-item k-sort-desc"><span class="k-link"><span class="k-sprite k-i-sort-desc"></span>${messages.sortDescending}</span></li>#if(showColumns || filterable){#<li class="k-separator"></li>#}##}##if(showColumns){#<li class="k-item k-columns-item"><span class="k-link"><span class="k-sprite k-i-columns"></span>${messages.columns}</span><ul>#for (var idx = 0; idx < columns.length; idx++) {#<li><input type="checkbox" data-#=ns#field="#=columns[idx].field.replace(/"/g,"&\\#34;")#" data-#=ns#index="#=columns[idx].index#" data-#=ns#locked="#=columns[idx].locked#"/>#=columns[idx].title#</li>#}#</ul></li>#if(filterable || lockedColumns){#<li class="k-separator"></li>#}##}##if(filterable){#<li class="k-item k-filter-item"><span class="k-link"><span class="k-sprite k-filter"></span>${messages.filter}</span><ul><li><div class="k-filterable"></div></li></ul></li>#if(lockedColumns){#<li class="k-separator"></li>#}##}##if(lockedColumns){#<li class="k-item k-lock"><span class="k-link"><span class="k-sprite k-i-lock"></span>${messages.lock}</span></li><li class="k-item k-unlock"><span class="k-link"><span class="k-sprite k-i-unlock"></span>${messages.unlock}</span></li>#}#</ul>',z='<div data-#=ns#role="view" data-#=ns#init-widgets="false" class="k-grid-column-menu"><div data-#=ns#role="header" class="k-header">${messages.settings}<button class="k-button k-done">#=messages.done#</button></div><div class="k-column-menu k-mobile-list"><ul><li><span class="k-link">${field}</span><ul>#if(sortable){#<li class="k-item k-sort-asc"><span class="k-link"><span class="k-sprite k-i-sort-asc"></span>${messages.sortAscending}</span></li><li class="k-item k-sort-desc"><span class="k-link"><span class="k-sprite k-i-sort-desc"></span>${messages.sortDescending}</span></li>#}##if(lockedColumns){#<li class="k-item k-lock"><span class="k-link"><span class="k-sprite k-i-lock"></span>${messages.lock}</span></li><li class="k-item k-unlock"><span class="k-link"><span class="k-sprite k-i-unlock"></span>${messages.unlock}</span></li>#}##if(filterable){#<li class="k-item k-filter-item"><span class="k-link k-filterable"><span class="k-sprite k-filter"></span>${messages.filter}</span></li>#}#</ul></li>#if(showColumns){#<li class="k-columns-item"><span class="k-link">${messages.columns}</span><ul>#for (var idx = 0; idx < columns.length; idx++) {#<li class="k-item"><label class="k-label"><input type="checkbox" class="k-check" data-#=ns#field="#=columns[idx].field.replace(/"/g,"&\\#34;")#" data-#=ns#index="#=columns[idx].index#" data-#=ns#locked="#=columns[idx].locked#"/>#=columns[idx].title#</label></li>#}#</ul></li>#}#</ul></div></div>',A=w.extend({init:function(a,b){w.fn.init.call(this,a,b),this.element.on("click"+v,"li:not(.k-separator):not(.k-state-disabled)","_click")},events:[r],_click:function(a){a.preventDefault(),this.trigger(r,{item:a.currentTarget})},close:function(){this.options.pane.navigate("")},destroy:function(){w.fn.destroy.call(this),this.element.off(v)}});g.plugin(x)}(jQuery),function(a,b){function c(b){return b=null!=b?b:"",b.type||a.type(b)||"string"}function d(b){b.find(":input:not(:button, ["+g.attr("role")+"=upload], ["+g.attr("skip")+"], [type=file]), select").each(function(){var b="dataBind",c=this.getAttribute(b)||"",d="checkbox"===this.type||"radio"===this.type?"checked:":"value:",e=this.name;-1===c.indexOf(d)&&e&&(c+=(c.length?",":"")+d+e,a(this).attr(b,c))})}function e(a){var b,d,e=(a.model.fields||a.model)[a.field],f=c(e),h=e?e.validation:{},i="dataType",j="dataBind",k={name:a.field};for(b in h)d=h[b],n(b,r)>=0?k[i]=b:l(d)||(k[b]=m(d)?d.value||b:d),k[g.attr(b+"-msg")]=d.message;return n(f,r)>=0&&(k[i]=f),k[j]=("boolean"===f?"checked:":"value:")+a.field,k}function f(a,b){var c,d,e=a?a.validation||{}:{};for(c in e)d=e[c],m(d)&&d.value&&(d=d.value),l(d)&&(b[c]=d)}var g=window.joy,h=(g.getPluginLang(),g.ui),i=h.Widget,j=a.extend,k=g.support.browser.msie&&g.support.browser.version<9,l=g.isFunction,m=a.isPlainObject,n=a.inArray,o=/("|\%|'|\[|\]|\$|\.|\,|\:|\;|\+|\*|\&|\!|\#|\(|\)|<|>|\=|\?|\@|\^|\{|\}|\~|\/|\||`)/g,p='<div class="k-widget k-tooltip k-tooltip-validation" style="margin:0.5em"><span class="k-icon k-warning"> </span>#=message#<div class="k-callout k-callout-n"></div></div>',q="change",r=["url","email","number","date","boolean"],s={number:function(b,c){e(c);a('<input  class="joy-numerictextbox" dataFormat="'+c.format+'"  dataBind="value:'+c.field+'" type="text"/>').appendTo(b),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},date:function(b,c){var d=e(c),f=c.format;f&&(f=g._extractFormat(f)),a('<input type="text"/>').attr(d).appendTo(b).joyDatePicker({dataFormat:c.format}),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},string:function(b,c){var d=e(c);a('<input type="text" class="k-input k-textbox"/>').attr(d).appendTo(b)},"boolean":function(b,c){var d=e(c);a('<input type="checkbox" />').attr(d).appendTo(b),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},hidden:function(b,c){a('<input type="hidden"  dataBind="value:'+c.field+'" />').appendTo(b),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},combobox:function(b,c){var d=(e(c),a('<input type="text"  class="joy-combobox"  dataTextField="'+c.dataTextField+'" dataValueField="'+c.dataValueField+'"   dataBind="value:'+c.field+",source:"+c.field+'source"  />'));d.appendTo(b);var f={};f[c.field+"source"]=c.values;var h=g.observable(f);g.bind(d,h),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},multiselect:function(b,c){var d=(e(c),a('<input type="text"  class="joy-multiselect" dataTextField="'+c.dataTextField+'" dataValueField="'+c.dataValueField+'" dataBind="value:'+c.field+",source:"+c.field+'source"  />'));d.appendTo(b);var f={};f[c.field+"source"]=c.values;var h=g.observable(f);g.bind(d,h),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},datetimepicker:function(b,c){var d=e(c),f=c.format;f&&(f=g._extractFormat(f)),a('<input type="text"/>').attr(d).appendTo(b).joyDateTimePicker({dataFormat:c.format}),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)},colorpicker:function(b,c){e(c);a('<input  class="joy-colorpicker"   dataBind="value:'+c.field+'" type="text"/>').appendTo(b),a("<span "+g.attr("for")+'="'+c.field+'" class="k-invalid-msg"/>').hide().appendTo(b)}},t=i.extend({init:function(b,c){var d=this;i.fn.init.call(d,b,c),d._validateProxy=a.proxy(d._validate,d),d.refresh()},events:[q],options:{name:"Editable",editors:s,clearContainer:!0,errorTemplate:p},editor:function(a,b){{var c=this,d=c.options.editors,e=m(a),f=e?a.field:a,h=c.options.model||{};

e&&a.values}"checkbox"==a.templateType&&(a.editor="hidden"),editor=d[a.editor],container=c.element.find("["+g.attr("container-for")+"="+f.replace(o,"\\$1")+"]"),editor=editor?editor:d.string,container=container.length?container:c.element,editor(container,j(!0,{},e?a:{field:f},{model:h}))},_validate:function(b){var c,d=this,e="boolean"==typeof b.value,f=d._validationEventInProgress,h={};h[b.field]=b.value,c=a(":input["+g.attr("bind")+'*="'+(e?"checked:":"value:")+b.field.replace(o,"\\$1")+'"]',d.element);try{d._validationEventInProgress=!0,(!d.validatable.validateInput(c)||!f&&d.trigger(q,{values:h}))&&b.preventDefault()}finally{d._validationEventInProgress=!1}},end:function(){return this.validatable.validate()},destroy:function(){var a=this;i.fn.destroy.call(a),a.options.model.unbind("set",a._validateProxy),g.unbind(a.element),a.validatable&&a.validatable.destroy(),g.destroy(a.element),a.element.removeData("joyValidator")},refresh:function(){var c,e,h,i,j,l,n,o=this,p=o.options.fields||[],q=o.options.clearContainer?o.element.empty():o.element,r=o.options.model||{},s={};for(a.isArray(p)||(p=[p]),c=0,e=p.length;e>c;c++)h=p[c],i=m(h),j=i?h.field:h,l=r[j],f(l,s),o.editor(h,l);if(!e){n=r.fields||r;for(j in n)f(n[j],s)}d(q),g.bind(q,o.options.model),o.options.model.bind("set",o._validateProxy),o.validatable=new g.ui.Validator(q,{validateOnBlur:!1,errorTemplate:o.options.errorTemplate||b,rules:s});var t=q.find(":joyFocusable").eq(0).focus();k&&t.focus()}});h.plugin(t)}(jQuery),function(a,b){function c(a){return a.position().top+3}var d=window.joy,e=d.getPluginLang(),f=d.ui.Widget,g=a.proxy,h=!1,i=".joyGroupable",j="change",k=d.template('<div class="k-group-indicator" data-#=data.ns#field="${data.field}" data-#=data.ns#title="${data.title || ""}" data-#=data.ns#dir="${data.dir || "asc"}"><a href="\\#" class="k-link"><span class="k-icon k-si-arrow-${(data.dir || "asc") == "asc" ? "n" : "s"}">(sorted ${(data.dir || "asc") == "asc" ? "ascending": "descending"})</span>${data.title ? data.title: data.field}</a><a class="k-button k-button-icon k-button-bare"><span class="k-icon k-group-delete"></span></a></div>',{useWithBlock:!1}),l=function(b){return a('<div class="k-header k-drag-clue" />').css({width:b.width(),paddingLeft:b.css("paddingLeft"),paddingRight:b.css("paddingRight"),lineHeight:b.height()+"px",paddingTop:b.css("paddingTop"),paddingBottom:b.css("paddingBottom")}).html(b.attr(d.attr("title"))||b.attr(d.attr("field"))).prepend('<span class="k-icon k-drag-status k-denied" />')},m=a('<div class="k-grouping-dropclue"/>'),n=/("|\%|'|\[|\]|\$|\.|\,|\:|\;|\+|\*|\&|\!|\#|\(|\)|<|>|\=|\?|\@|\^|\{|\}|\~|\/|\||`)/g,o=f.extend({init:function(b,e){var k,n,o=this,p=d.guid(),q=g(o._intializePositions,o),r=o._dropCuePositions=[];f.fn.init.call(o,b,e),h=d.support.isRtl(b),n=h?"right":"left",o.draggable=k=o.options.draggable||new d.ui.Draggable(o.element,{filter:o.options.draggableElements,hint:l,group:p}),o.groupContainer=a(o.options.groupContainer,o.element).joyDropTarget({group:k.options.group,dragenter:function(a){o._canDrag(a.draggable.currentTarget)&&(a.draggable.hint.find(".k-drag-status").removeClass("k-denied").addClass("k-add"),m.css("top",c(o.groupContainer)).css(n,0).appendTo(o.groupContainer))},dragleave:function(a){a.draggable.hint.find(".k-drag-status").removeClass("k-add").addClass("k-denied"),m.remove()},drop:function(b){var c,e=b.draggable.currentTarget,f=e.attr(d.attr("field")),g=e.attr(d.attr("title")),i=o.indicator(f),j=o._dropCuePositions,k=j[j.length-1];(e.hasClass("k-group-indicator")||o._canDrag(e))&&(k?(c=o._dropCuePosition(d.getOffset(m).left+parseInt(k.element.css("marginLeft"),10)*(h?-1:1)+parseInt(k.element.css("marginRight"),10)),c&&o._canDrop(a(i),c.element,c.left)&&(c.before?c.element.before(i||o.buildIndicator(f,g)):c.element.after(i||o.buildIndicator(f,g)),o._change())):(o.groupContainer.append(o.buildIndicator(f,g)),o._change()))}}).joyDraggable({filter:"div.k-group-indicator",hint:l,group:k.options.group,dragcancel:g(o._dragCancel,o),dragstart:function(a){var b=a.currentTarget,d=parseInt(b.css("marginLeft"),10),e=b.position(),f=h?e.left-d:e.left+b.outerWidth();q(),m.css({top:c(o.groupContainer),left:f}).appendTo(o.groupContainer),this.hint.find(".k-drag-status").removeClass("k-denied").addClass("k-add")},dragend:function(){o._dragEnd(this)},drag:g(o._drag,o)}).on("click"+i,".k-button",function(b){b.preventDefault(),o._removeIndicator(a(this).parent())}).on("click"+i,".k-link",function(b){var c=a(this).parent(),e=o.buildIndicator(c.attr(d.attr("field")),c.attr(d.attr("title")),"asc"==c.attr(d.attr("dir"))?"desc":"asc");c.before(e).remove(),o._change(),b.preventDefault()}),k.bind(["dragend","dragcancel","dragstart","drag"],{dragend:function(){o._dragEnd(this)},dragcancel:g(o._dragCancel,o),dragstart:function(a){var b,c,d;return o.options.allowDrag||o._canDrag(a.currentTarget)?(q(),void(r.length?(b=r[r.length-1].element,c=parseInt(b.css("marginRight"),10),d=b.position().left+b.outerWidth()+c):d=0)):void a.preventDefault()},drag:g(o._drag,o)}),o.dataSource=o.options.dataSource,o.dataSource&&o._refreshHandler?o.dataSource.unbind(j,o._refreshHandler):o._refreshHandler=g(o.refresh,o),o.dataSource&&(o.dataSource.bind("change",o._refreshHandler),o.refresh())},refresh:function(){var b=this,c=b.dataSource;b.groupContainer&&b.groupContainer.empty().append(a.map(c.group()||[],function(a){var c=a.field.replace(n,"\\$1"),e=b.element.find(b.options.filter).filter("["+d.attr("field")+"="+c+"]");return b.buildIndicator(a.field,e.attr(d.attr("title")),a.dir)}).join("")),b._invalidateGroupContainer()},destroy:function(){var a=this;f.fn.destroy.call(a),a.groupContainer.off(i),a.groupContainer.data("joyDropTarget")&&a.groupContainer.data("joyDropTarget").destroy(),a.groupContainer.data("joyDraggable")&&a.groupContainer.data("joyDraggable").destroy(),a.options.draggable||a.draggable.destroy(),a.dataSource&&a._refreshHandler&&(a.dataSource.unbind("change",a._refreshHandler),a._refreshHandler=null),a.groupContainer=a.element=a.draggable=null},options:{name:"Groupable",filter:"th",draggableElements:"th",messages:{empty:e.groupable.empty}},indicator:function(b){var c=a(".k-group-indicator",this.groupContainer);return a.grep(c,function(c){return a(c).attr(d.attr("field"))===b})[0]},buildIndicator:function(a,b,c){return k({field:a.replace(/"/g,"'"),dir:c,title:b,ns:d.ns})},descriptors:function(){var b,c,e,f,g,h=this,i=a(".k-group-indicator",h.groupContainer);return b=h.element.find(h.options.filter).map(function(){var b=a(this),e=b.attr(d.attr("aggregates")),h=b.attr(d.attr("field"));if(e&&""!==e)for(c=e.split(","),e=[],f=0,g=c.length;g>f;f++)e.push({field:h,aggregate:c[f]});return e}).toArray(),a.map(i,function(c){return c=a(c),e=c.attr(d.attr("field")),{field:e,dir:c.attr(d.attr("dir")),aggregates:b||[]}})},_removeIndicator:function(a){var b=this;a.remove(),b._invalidateGroupContainer(),b._change()},_change:function(){var a=this;a.dataSource&&a.dataSource.group(a.descriptors())},_dropCuePosition:function(b){var c=this._dropCuePositions;if(m.is(":visible")&&0!==c.length){b=Math.ceil(b);var d=c[c.length-1],e=d.left,f=d.right,g=parseInt(d.element.css("marginLeft"),10),i=parseInt(d.element.css("marginRight"),10);return b>=f&&!h||e>b&&h?b={left:d.element.position().left+(h?-g:d.element.outerWidth()+i),element:d.element,before:!1}:(b=a.grep(c,function(a){return a.left<=b&&b<=a.right||h&&b>a.right})[0],b&&(b={left:h?b.element.position().left+b.element.outerWidth()+i:b.element.position().left-g,element:b.element,before:!0})),b}},_drag:function(a){var b=this._dropCuePosition(a.x.location);b&&m.css({left:b.left,right:"auto"})},_canDrag:function(a){var b=a.attr(d.attr("field"));return"false"!=a.attr(d.attr("groupable"))&&b&&(a.hasClass("k-group-indicator")||!this.indicator(b))},_canDrop:function(a,b,c){var d=a.next(),e=a[0]!==b[0]&&(!d[0]||b[0]!==d[0]||!h&&c>d.position().left||h&&c<d.position().left);return e},_dragEnd:function(b){var c=this,e=b.currentTarget.attr(d.attr("field")),f=c.indicator(e);b!==c.options.draggable&&!b.dropped&&f&&c._removeIndicator(a(f)),c._dragCancel()},_dragCancel:function(){m.remove(),this._dropCuePositions=[]},_intializePositions:function(){var b,c=this,e=a(".k-group-indicator",c.groupContainer);c._dropCuePositions=a.map(e,function(c){return c=a(c),b=d.getOffset(c).left,{left:parseInt(b,10),right:parseInt(b+c.outerWidth(),10),element:c}})},_invalidateGroupContainer:function(){var a=this.groupContainer;a&&a.is(":empty")&&a.html(this.options.messages.empty)}});d.ui.plugin(o)}(jQuery),function(a,b){function c(b,c){b=a(b),c?b.find(".k-drag-status").removeClass("k-add").addClass("k-denied"):b.find(".k-drag-status").removeClass("k-denied").addClass("k-add")}var d=window.joy,e=d.getOffset,f=d.ui.Widget,g="change",h="k-reorderable",i=f.extend({init:function(b,i){var j,k=this,l=d.guid()+"-reorderable";f.fn.init.call(k,b,i),b=k.element.addClass(h),i=k.options,k.draggable=j=i.draggable||new d.ui.Draggable(b,{group:l,filter:i.filter,hint:i.hint}),k.reorderDropCue=a('<div class="k-reorder-cue"><div class="k-icon k-i-arrow-s"></div><div class="k-icon k-i-arrow-n"></div></div>'),b.find(j.options.filter).joyDropTarget({group:j.options.group,dragenter:function(a){if(k._draggable){var b,d=this.element,f=!k._dropTargetAllowed(d)||k._isLastDraggable();if(c(a.draggable.hint,f),!f){b=e(d);var g=b.left;i.inSameContainer&&!i.inSameContainer(d,k._draggable)?k._dropTarget=d:k._elements.index(d)>k._elements.index(k._draggable)&&(g+=d.outerWidth()),k.reorderDropCue.css({height:d.outerHeight(),top:b.top,left:g}).appendTo(document.body)}}},dragleave:function(a){c(a.draggable.hint,!0),k.reorderDropCue.remove(),k._dropTarget=null},drop:function(){if(k._dropTarget=null,k._draggable){var a=this.element,b=k._draggable;k._dropTargetAllowed(a)&&!k._isLastDraggable()&&k.trigger(g,{element:k._draggable,oldIndex:k._elements.index(b),newIndex:k._elements.index(a),position:e(k.reorderDropCue).left>e(a).left?"after":"before"})}}}),j.bind(["dragcancel","dragend","dragstart","drag"],{dragcancel:function(){k.reorderDropCue.remove(),k._draggable=null,k._elements=null},dragend:function(){k.reorderDropCue.remove(),k._draggable=null,k._elements=null},dragstart:function(a){k._draggable=a.currentTarget,k._elements=k.element.find(k.draggable.options.filter)},drag:function(a){if(k._dropTarget&&!this.hint.find(".k-drag-status").hasClass("k-denied")){var b=e(k._dropTarget).left,c=k._dropTarget.outerWidth();k.reorderDropCue.css(a.pageX>b+c/2?{left:b+c}:{left:b})}}})},options:{name:"Reorderable",filter:"*"},events:[g],_isLastDraggable:function(){var a,b=this.options.inSameContainer,c=this._draggable[0],d=this._elements.get(),e=!1;if(!b)return!1;for(;!e&&d.length>0;)a=d.pop(),e=c!==a&&b(c,a);return!e},_dropTargetAllowed:function(a){var b=this.options.inSameContainer,c=this.options.dragOverContainers,d=this._draggable;return d[0]===a[0]?!1:b&&c?b(d,a)?!0:c(this._elements.index(d)):!0},destroy:function(){var b=this;f.fn.destroy.call(b),b.element.find(b.draggable.options.filter).each(function(){var b=a(this);b.data("joyDropTarget")&&b.data("joyDropTarget").destroy()}),b.draggable&&(b.draggable.destroy(),b.draggable.element=b.draggable=null),b.elements=b.reorderDropCue=b._elements=b._draggable=null}});d.ui.plugin(i)}(jQuery),function(a,b){var c=window.joy,d=c.ui,e=d.Widget,f=a.proxy,g=c.isFunction,h=a.extend,i="horizontal",j="vertical",k="start",l="resize",m="resizeend",n=e.extend({init:function(a,b){var c=this;e.fn.init.call(c,a,b),c.orientation=c.options.orientation.toLowerCase()!=j?i:j,c._positionMouse=c.orientation==i?"x":"y",c._position=c.orientation==i?"left":"top",c._sizingDom=c.orientation==i?"outerWidth":"outerHeight",c.draggable=new d.Draggable(a,{distance:0,filter:b.handle,drag:f(c._resize,c),dragcancel:f(c._cancel,c),dragstart:f(c._start,c),dragend:f(c._stop,c)}),c.userEvents=c.draggable.userEvents},events:[l,m,k],options:{name:"Resizable",orientation:i},resize:function(){},_max:function(a){var c=this,d=c.hint?c.hint[c._sizingDom]():0,e=c.options.max;return g(e)?e(a):e!==b?c._initialElementPosition+e-d:e},_min:function(a){var c=this,d=c.options.min;return g(d)?d(a):d!==b?c._initialElementPosition+d:d},_start:function(b){var c=this,d=c.options.hint,e=a(b.currentTarget);c._initialElementPosition=e.position()[c._position],c._initialMousePosition=b[c._positionMouse].startLocation,d&&(c.hint=g(d)?a(d(e)):d,c.hint.css({position:"absolute"}).css(c._position,c._initialElementPosition).appendTo(c.element)),c.trigger(k,b),c._maxPosition=c._max(b),c._minPosition=c._min(b),a(document.body).css("cursor",e.css("cursor"))},_resize:function(a){var c,d=this,e=d._maxPosition,f=d._minPosition,g=d._initialElementPosition+(a[d._positionMouse].location-d._initialMousePosition);c=f!==b?Math.max(f,g):g,d.position=c=e!==b?Math.min(e,c):c,d.hint&&d.hint.toggleClass(d.options.invalidClass||"",c==e||c==f).css(d._position,c),d.resizing=!0,d.trigger(l,h(a,{position:c}))},_stop:function(b){var c=this;c.hint&&c.hint.remove(),c.resizing=!1,c.trigger(m,h(b,{position:c.position})),a(document.body).css("cursor","")},_cancel:function(a){var c=this;c.hint&&(c.position=b,c.hint.css(c._position,c._initialElementPosition),c._stop(a))},destroy:function(){var a=this;e.fn.destroy.call(a),a.draggable&&a.draggable.destroy()},press:function(a){if(a){var b=a.position(),c=this;c.userEvents.press(b.left,b.top,a[0]),c.targetPosition=b,c.target=a}},move:function(a){var c=this,d=c._position,e=c.targetPosition,f=c.position;f===b&&(f=e[d]),e[d]=f+a,c.userEvents.move(e.left,e.top)},end:function(){this.userEvents.end(),this.target=this.position=b}});c.ui.plugin(n)}(jQuery),function(a,b){function c(a,b){var c=d.getOffset(a),e=b.left+b.width,f=b.top+b.height;return c.right=c.left+a.outerWidth(),c.bottom=c.top+a.outerHeight(),!(c.left>e||c.right<b.left||c.top>f||c.bottom<b.top)}var d=window.joy,e=d.ui.Widget,f=a.proxy,g=Math.abs,h=(Array.prototype.shift,"aria-selected"),i="k-state-selected",j="k-state-selecting",k="k-selectable",l="change",m=".joySelectable",n="k-state-unselecting",o=!1;!function(a){!function(){a('<div class="parent"><span /></div>').on("click",">*",function(){o=!0}).find("span").click().end().off()}()}(a);var p=e.extend({init:function(b,c){var g,h=this;e.fn.init.call(h,b,c),h._marquee=a("<div class='k-marquee'><div class='k-marquee-color'></div></div>"),h._lastActive=null,h.element.addClass(k),h.relatedTarget=h.options.relatedTarget,g=h.options.multiple,h.userEvents=new d.UserEvents(h.element,{global:!0,allowSelection:!0,filter:(o?"":"."+k+" ")+h.options.filter,tap:f(h._tap,h)}),g&&h.userEvents.bind("start",f(h._start,h)).bind("move",f(h._move,h)).bind("end",f(h._end,h)).bind("select",f(h._select,h))},events:[l],options:{name:"Selectable",filter:">*",multiple:!1,relatedTarget:a.noop},_isElement:function(a){var b,c=this.element,d=c.length,e=!1;for(a=a[0],b=0;d>b;b++)if(c[b]===a){e=!0;break}return e},_tap:function(b){var c,d=a(b.target),e=this,f=b.event.ctrlKey||b.event.metaKey,g=e.options.multiple,h=g&&b.event.shiftKey,j=b.event.which,m=b.event.button;!e._isElement(d.closest("."+k))||j&&3==j||m&&2==m||(c=d.hasClass(i),g&&f||e.clear(),d=d.add(e.relatedTarget(d)),h?e.selectRange(e._firstSelectee(),d):(c&&f?(e._unselect(d),e._notify(l)):e.value(d),e._lastActive=e._downTarget=d))},_start:function(b){var c,d=this,e=a(b.target),f=e.hasClass(i),g=b.event.ctrlKey||b.event.metaKey;return d._downTarget=e,d._isElement(e.closest("."+k))?(d.options.useAllItems?d._items=d.element.find(d.options.filter):(c=e.closest(d.element),d._items=c.find(d.options.filter)),d._marquee.appendTo(document.body).css({left:b.x.client+1,top:b.y.client+1,width:0,height:0}),g||d.clear(),e=e.add(d.relatedTarget(e)),void(f&&(d._selectElement(e,!0),g&&e.addClass(n)))):void d.userEvents.cancel()},_move:function(a){var b=this,c={left:a.x.startLocation>a.x.location?a.x.location:a.x.startLocation,top:a.y.startLocation>a.y.location?a.y.location:a.y.startLocation,width:g(a.x.initialDelta),height:g(a.y.initialDelta)};b._marquee.css(c),b._invalidateSelectables(c,a.event.ctrlKey||a.event.metaKey),a.preventDefault()},_end:function(){var a=this;a._marquee.remove(),a._unselect(a.element.find(a.options.filter+"."+n)).removeClass(n);var b=a.element.find(a.options.filter+"."+j);b=b.add(a.relatedTarget(b)),a.value(b),a._lastActive=a._downTarget,a._items=null},_invalidateSelectables:function(a,b){var d,e,f,g,h=this._downTarget[0],k=this._items;for(d=0,e=k.length;e>d;d++)g=k.eq(d),f=g.add(this.relatedTarget(g)),c(g,a)?g.hasClass(i)?b&&h!==g[0]&&f.removeClass(i).addClass(n):g.hasClass(j)||g.hasClass(n)||f.addClass(j):g.hasClass(j)?f.removeClass(j):b&&g.hasClass(n)&&f.removeClass(n).addClass(i)},value:function(a){var b=this,c=f(b._selectElement,b);return a?(a.each(function(){c(this)}),void b._notify(l)):b.element.find(b.options.filter+"."+i)},_firstSelectee:function(){var a,b=this;return null!==b._lastActive?b._lastActive:(a=b.value(),a.length>0?a[0]:b.element.find(b.options.filter)[0])},_selectElement:function(b,c){var d=a(b),e=!c&&this._notify("select",{element:b}),f=d.find(".j-checkbox");f.prop("checked",!f.is(":checked")),d.removeClass(j),e||(d.addClass(i),this.options.aria&&d.attr(h,!0))},_notify:function(a,b){return b=b||{},this.trigger(a,b)},_unselect:function(a){return a.removeClass(i),this.options.aria&&a.attr(h,!1),a},_select:function(b){var c="input,a,textarea,.k-multiselect-wrap,select",e=d.support.browser.msie;a(b.event.target).is(c)?(this.userEvents.cancel(),this._downTarget=null):(!e||e&&!a(d._activeElement()).is(c))&&b.preventDefault()},clear:function(){var a=this.element.find(this.options.filter+"."+i);this._unselect(a)},selectRange:function(b,c){var d,e,f,g=this;for(g.clear(),g.element.length>1&&(f=g.options.continuousItems()),f&&f.length||(f=g.element.find(g.options.filter)),b=a.inArray(a(b)[0],f),c=a.inArray(a(c)[0],f),b>c&&(e=b,b=c,c=e),g.options.useAllItems||(c+=g.element.length-1),d=b;c>=d;d++)g._selectElement(f[d]);g._notify(l)},destroy:function(){var a=this;e.fn.destroy.call(a),a.element.off(m),a.userEvents.destroy(),a._marquee=a._lastActive=a.element=a.userEvents=null}});d.ui.plugin(p)}(jQuery),function(a,b){function c(b,c){try{return a.contains(b,c)||b==c}catch(d){return!1}}function d(a){return a.clone()}function e(a){return a.clone().removeAttr("id").css("visibility","hidden")}var f=window.joy,g=f.ui.Widget,h="start",i="beforeMove",j="move",k="end",l="change",m="cancel",n="sort",o="remove",p="receive",q=">*",r=-1,s=g.extend({init:function(a,b){var c=this;g.fn.init.call(c,a,b),c.options.placeholder||(c.options.placeholder=e),c.options.hint||(c.options.hint=d),c._draggable=c._createDraggable(),c.floating=!1},events:[h,i,j,k,l,m],options:{name:"Sortable",hint:null,placeholder:null,filter:q,holdToDrag:!1,disabled:null,container:null,connectWith:null,handler:null,cursorOffset:null,axis:null,cursor:"auto"},destroy:function(){this._draggable.destroy(),g.fn.destroy.call(this)},_createDraggable:function(){var b=this,c=b.element,d=b.options;return new f.ui.Draggable(c,{filter:d.filter,hint:f.isFunction(d.hint)?d.hint:a(d.hint),holdToDrag:d.holdToDrag,container:d.container?a(d.container):null,cursorOffset:d.cursorOffset,axis:d.axis,dragstart:a.proxy(b._dragstart,b),dragcancel:a.proxy(b._dragcancel,b),drag:a.proxy(b._drag,b),dragend:a.proxy(b._dragend,b)})},_dragstart:function(b){var c=this.draggedElement=b.currentTarget,d=b.target||f.elementUnderCursor(b),e=this.options.disabled,g=this.options.handler,i=this.options.placeholder,j=this.placeholder=a(f.isFunction(i)?i.call(this,c):i);e&&c.is(e)?b.preventDefault():g&&!a(d).is(g)?b.preventDefault():this.trigger(h,{item:c,draggableEvent:b})?b.preventDefault():(this.floating=this._isFloating(c),c.css("display","none"),c.before(j),this._setCursor())},_dragcancel:function(a){this._cancel(),this.trigger(m,{item:this.draggedElement}),this._resetCursor()},_drag:function(b){var c,d,e,f,g,h=this.draggedElement,i=this._findTarget(b),j={left:b.x.location,top:b.y.location},k={x:b.x.delta,y:b.y.delta},l=this.options.axis,m={item:h,list:this,draggableEvent:b};if("x"===l||"y"===l)return void this._movementByAxis(l,j,k[l],m);if(i){if(c=this._getElementCenter(i.element),d={left:Math.round(j.left-c.left),top:Math.round(j.top-c.top)},a.extend(m,{target:i.element}),i.appendToBottom)return void this._movePlaceholder(i,null,m);if(this.floating?k.x<0&&d.left<0?e="prev":k.x>0&&d.left>0&&(e="next"):k.y<0&&d.top<0?e="prev":k.y>0&&d.top>0&&(e="next"),e){for(g="prev"===e?jQuery.fn.prev:jQuery.fn.next,f=g.call(i.element);f.length&&!f.is(":visible");)f=g.call(f);f[0]!=this.placeholder[0]&&this._movePlaceholder(i,e,m)}}},_dragend:function(b){var c,d,e,f,g=this.placeholder,h=this.draggedElement,i=this.indexOf(h),j=this.indexOf(g),m=this.options.connectWith;return this._resetCursor(),e={action:n,item:h,oldIndex:i,newIndex:j,draggableEvent:b},j>=0?d=this.trigger(k,e):(c=g.parents(m).getjoySortable(),e.action=o,f=a.extend({},e,{action:p,oldIndex:r,newIndex:c.indexOf(g)}),d=!(!this.trigger(k,e)&&!c.trigger(k,f))),d||j===i?void this._cancel():(g.replaceWith(h),h.show(),this._draggable.dropped=!0,e={action:this.indexOf(h)!=r?n:o,item:h,oldIndex:i,newIndex:this.indexOf(h),draggableEvent:b},this.trigger(l,e),void(c&&(f=a.extend({},e,{action:p,oldIndex:r,newIndex:c.indexOf(h)}),c.trigger(l,f))))},_findTarget:function(b){var c,d,e=this._findElementUnderCursor(b),f=this.options.connectWith;return a.contains(this.element[0],e)?(c=this.items(),d=c.filter(e)[0]||c.has(e)[0],d?{element:a(d),sortable:this}:null):this.element[0]==e&&this.isEmpty()?{element:this.element,sortable:this,appendToBottom:!0}:f?this._searchConnectedTargets(e,b):void 0},_findElementUnderCursor:function(a){{var b=f.elementUnderCursor(a),d=a.sender;this.options.disabled,this.options.filter,this.items()}return c(d.hint[0],b)&&(d.hint.hide(),b=f.elementUnderCursor(a),b||(b=f.elementUnderCursor(a)),d.hint.show()),b},_searchConnectedTargets:function(b,c){for(var d,e,f,g=a(this.options.connectWith),h=0;h<g.length;h++)if(d=g.eq(h).getjoySortable(),a.contains(g[h],b)){if(d)return e=d.items(),f=e.filter(b)[0]||e.has(b)[0],f?(d.placeholder=this.placeholder,{element:a(f),sortable:d}):null}else if(g[h]==b&&(d&&d.isEmpty()||this._isCursorAfterLast(d,c)))return{element:g.eq(h),sortable:d,appendToBottom:!0}},_isCursorAfterLast:function(a,b){var c,d,e=a.items().last(),g={left:b.x.location,top:b.y.location};return c=f.getOffset(e),c.top+=e.outerHeight(),c.left+=e.outerWidth(),d=this.floating?c.left-g.left:c.top-g.top,0>d?!0:!1},_movementByAxis:function(b,c,d,e){var f,g="x"===b?c.left:c.top,h=0>d?this.placeholder.prev():this.placeholder.next();h.length&&!h.is(":visible")&&(h=0>d?h.prev():h.next()),a.extend(e,{target:h}),f=this._getElementCenter(h),f&&(f="x"===b?f.left:f.top),h.length&&0>d&&0>g-f?this._movePlaceholder({element:h,sortable:this},"prev",e):h.length&&d>0&&g-f>0&&this._movePlaceholder({element:h,sortable:this},"next",e)},_movePlaceholder:function(a,b,c){var d=this.placeholder;a.sortable.trigger(i,c)||(b?"prev"===b?a.element.before(d):"next"===b&&a.element.after(d):a.element.append(d),a.sortable.trigger(j,c))},_setCursor:function(){var b,c=this.options.cursor;c&&"auto"!==c&&(b=a(document.body),this._originalCursorType=b.css("cursor"),b.css({cursor:c}),this._cursorStylesheet||(this._cursorStylesheet=a("<style>* { cursor: "+c+" !important; }</style>")),this._cursorStylesheet.appendTo(b))},_resetCursor:function(){this._originalCursorType&&(a(document.body).css("cursor",this._originalCursorType),this._originalCursorType=null,this._cursorStylesheet.remove())},_getElementCenter:function(a){var b=a.length?f.getOffset(a):null;return b&&(b.top+=a.outerHeight()/2,b.left+=a.outerWidth()/2),b},_isFloating:function(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))},_cancel:function(){this.draggedElement.show(),this.placeholder.remove()},_items:function(){var a,b=this.options.filter;return a=b?this.element.find(b):this.element.children()},indexOf:function(a){var b=this._items(),c=this.placeholder,d=this.draggedElement;return c&&a[0]==c[0]?b.not(d).index(a):b.not(c).index(a)},items:function(){var a=this.placeholder,b=this._items();return a&&(b=b.not(a)),b},isEmpty:function(){return!this.items().not(":hidden").length}});f.ui.plugin(s)}(jQuery),function($,undefined){function groupCells(a){return new Array(a+1).join('<td class="k-group-cell">&nbsp;</td>')}function stringifyAttributes(a){var b,c=" ";if(a){if(typeof a===STRING)return a;for(b in a)c+=b+'="'+a[b]+'"'}return c}function heightAboveHeader(a){var b=0;return $("> .k-grouping-header, > .k-grid-toolbar",a).each(function(){b+=this.offsetHeight}),b}function cursor(a,b){$("th, th .k-grid-filter, th .k-link",a).add(document.body).css("cursor",b)}function buildEmptyAggregatesObject(a){var b,c,d={},e={};if(!isEmptyObject(a))for(isArray(a)||(a=[a]),b=0,c=a.length;c>b;b++)d[a[b].aggregate]=0,e[a[b].field]=d;return e}function reorder(a,b,c,d){b=a.eq(b),"number"==typeof c?b[d?"insertBefore":"insertAfter"](a.eq(c)):b.appendTo(c)}function elements(a,b,c){return $(a).add(b).find(c)}function attachCustomCommandEvent(a,b,c){var d,e,f,g;for(c=isArray(c)?c:[c],d=0,e=c.length;e>d;d++)f=c[d],isPlainObject(f)&&f.click&&(g=f.name||f.text,b.on(CLICK+NS,"a.k-grid-"+(g||"").replace(/\s/g,""),{commandName:g},proxy(f.click,a)))}function visibleColumns(a){return grep(a,function(a){return!a.hidden})}function columnsWidth(a){for(var b,c=0,d=0,e=a.length;e>d;d++)b=a[d].style.width,b&&-1==b.indexOf("%")&&(c+=parseInt(b,10));return c}function lockedColumns(a){return grep(a,function(a){return a.locked})}function nonLockedColumns(a){return grep(a,function(a){return!a.locked})}function visibleNonLockedColumns(a){return grep(a,function(a){return!a.locked&&!a.hidden})}function visibleLockedColumns(a){return grep(a,function(a){return a.locked&&!a.hidden})}function appendContent(a,b,c){var d,e=a;return tbodySupportsInnerHtml?a[0].innerHTML=c:(d=document.createElement("div"),d.innerHTML="<table><tbody>"+c+"</tbody></table>",a=d.firstChild.firstChild,b[0].replaceChild(a,e[0]),a=$(a)),a}function addHiddenStyle(a){a=a||{};var b=a.style;return b?(b=b.replace(/((.*)?display)(.*)?:([^;]*)/i,"$1:none"),b===a.style&&(b=b.replace(/(.*)?/i,"display:none;$1"))):b="display:none",extend({},a,{style:b})}function removeHiddenStyle(a){a=a||{};var b=a.style;return b&&(a.style=b.replace(/(display\s*:\s*none\s*;?)*/gi,"")),a}function normalizeCols(a,b,c,d){var e,f=a.find(">colgroup"),g=map(b,function(a){return e=a.width,e&&0!==parseInt(e,10)?joy.format('<col style="width:{0}"/>',typeof e===STRING?e:e+"px"):"<col />"});(c||f.find(".k-hierarchy-col").length)&&g.splice(0,0,'<col class="k-hierarchy-col" />'),f.length&&f.remove(),f=$(new Array(d+1).join('<col class="k-group-col">')+g.join("")),f.is("colgroup")||(f=$("<colgroup/>").append(f)),a.prepend(f),browser.msie&&8==browser.version&&(a.css("display","inline-table"),window.setTimeout(function(){a.css("display","")},1))}function convertToObject(a,b,c){var d,e,f,g={};for(e=0,f=a.length;f>e;e++)d=a[e],g[d[c]]=d[b];return g}function formatGroupValue(a,b,c,d,e){var f=c&&c.length&&isPlainObject(c[0])&&"value"in c[0],g=f?convertToObject(c,d,e)[a]:a;return g=null!=g?g:"",b?joy.format(b,g):g}function setCellVisibility(a,b,c){for(var d,e=0,f=a[e];f;){if(d=c?!0:"none"!==f.style.display,d&&!nonDataCellsRegExp.test(f.className)&&--b<0){f.style.display=c?"":"none";break}f=a[++e]}}function hideColumnCells(a,b){for(var c,d,e=0,f=a.length;f>e;e+=1)d=a.eq(e),d.is(".k-grouping-row,.k-detail-row")?(c=d.children(":not(.k-group-cell):first,.k-detail-cell").last(),c.attr("colspan",parseInt(c.attr("colspan"),10)-1)):(d.hasClass("k-grid-edit-row")&&(c=d.children(".k-edit-container")[0])&&(c=$(c),c.attr("colspan",parseInt(c.attr("colspan"),10)-1),c.find("col").eq(b).remove(),d=c.find("tr:first")),setCellVisibility(d[0].cells,b,!1))}function showColumnCells(a,b){for(var c,d,e,f=0,g=a.length;g>f;f+=1)d=a.eq(f),d.is(".k-grouping-row,.k-detail-row")?(c=d.children(":not(.k-group-cell):first,.k-detail-cell").last(),c.attr("colspan",parseInt(c.attr("colspan"),10)+1)):(d.hasClass("k-grid-edit-row")&&(c=d.children(".k-edit-container")[0])&&(c=$(c),c.attr("colspan",parseInt(c.attr("colspan"),10)+1),normalizeCols(c.find(">form>table"),visibleColumns(e),!1,0),d=c.find("tr:first")),setCellVisibility(d[0].cells,b,!0))}function updateColspan(a,b){var c,d,e;for(d=0,e=a.length;e>d;d+=1)c=a.eq(d).children().last(),c.attr("colspan",parseInt(c.attr("colspan"),10)+1),c=b.eq(d).children().last(),c.attr("colspan",parseInt(c.attr("colspan"),10)-1)}function tableWidth(a){var b,c,d=0,e=a.find(">colgroup>col");for(b=0,c=e.length;c>b;b+=1)d+=parseInt(e[b].style.width,10);return d}function adjustRowHeight(a,b){var c,d=a.clientHeight,e=b.clientHeight;d>e?c=d+"px":e>d&&(c=e+"px"),c&&(a.style.height=b.style.height=c)}function getCommand(a,b){var c,d,e;if(typeof a===STRING&&a===b)return a;if(isPlainObject(a)&&a.name===b)return a;if(isArray(a))for(c=0,d=a.length;d>c;c++)if(e=a[c],typeof e===STRING&&e===b||e.name===b)return e;return null}function focusTable(a,b){var c=browser.msie;if(b===!0){a=$(a);var d,e,f=c&&a.parent().is(".k-grid-content,.k-grid-header-wrap");if(f&&(d=a.parent().scrollTop(),e=a.parent().scrollLeft()),c)try{a[0].setActive()}catch(g){a[0].focus()}else a[0].focus();f&&(a.parent().scrollTop(d),a.parent().scrollLeft(e))}else $(a).one("focusin",function(a){a.preventDefault()}).focus()}function tableClick(a){var b=$(a.currentTarget),c=b.is("th"),d=this.table.add(this.lockedTable),e=this.thead.parent().add($(">table",this.lockedHeader)),f=b.closest("table")[0];joy.support.touch||(f===d[0]||f===d[1]||f===e[0]||f===e[1])&&(this.current(b),(c||!$(a.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap"))&&setTimeout(function(){isIE8&&$(joy._activeElement()).hasClass("k-widget")||focusTable(f,!0)}),c&&a.preventDefault())}function verticalTable(a,b,c,d){if(a=$(a),d){var e=b;b=c,c=e}return b.not(a).length!=b.length?a:b.eq(a[0]==c[0]?0:1)}function moveVertical(a,b,c,d,e){var f,g,h=e?"prevAll":"nextAll";return a?(f=a.parent()[h](NAVROW).first(),f[0]||!e&&!a.is("th")||(b=verticalTable(b,c,d,e),focusTable(b),f=b.find((e?">thead>":">tbody>")+NAVROW).first()),g=a.index(),a=f.children().eq(g),a[0]&&a.is(NAVCELL)||(a=f.children(NAVCELL).first())):a=c.find(FIRSTNAVITEM),a}function moveLeft(a,b,c,d,e){var f=c.length>1;return a?a.prev()[0]?a=a.prevAll(DATA_CELL).first():f&&(b==c[1]?(focusTable(c[0]),a=e(a.parent()).children(DATA_CELL).last()):b==d[1]&&(focusTable(d[0]),a=d.eq(0).find("tr>"+DATA_CELL).last())):a=c.find(FIRSTNAVITEM),a}function moveRight(a,b,c,d,e){var f=c.length>1;return a?a.next()[0]?a=a.nextAll(DATA_CELL).first():f&&(b==c[0]?(focusTable(c[1]),a=e(a.parent()).children(DATA_CELL).first()):b==d[0]&&(focusTable(d[1]),a=d.eq(1).find("tr>"+DATA_CELL).first())):a=c.find(FIRSTNAVITEM),a}function tabNext(a,b,c,d,e){var f=2==c.length,g=!0,h=e?a.prevAll(DATA_CELL+":first"):a.nextAll(":visible:first");return h.length||(h=a.parent(),f&&(g=e&&b==c[0]||!e&&b==c[1],h=d(h)),g&&(h=h[e?"prevAll":"nextAll"]("tr:not(.k-grouping-row):not(.k-detail-row):visible:first")),h=h.children(DATA_CELL+(e?":last":":first"))),h}function groupRowBuilder(a,b,c){return'<tr class="k-grouping-row">'+groupCells(b)+'<td colspan="'+a+'" aria-expanded="true"><p class="k-reset"><a class="k-icon k-i-collapse" href="#" tabindex="-1"></a>'+c+"</p></td></tr>"}function groupRowLockedContentBuilder(a,b,c){return'<tr class="k-grouping-row"><td colspan="'+a+'" aria-expanded="true"><p class="k-reset">&nbsp;</p></td></tr>'}var joy=window.joy,joyLang=joy.getPluginLang(),lang=joy.getLang(),langc=joy.getCommonLang(),ui=joy.ui,DataSource=joy.data.DataSource,Groupable=ui.Groupable,tbodySupportsInnerHtml=joy.support.tbodyInnerHtml,activeElement=joy._activeElement,Widget=ui.Widget,keys=joy.keys,isPlainObject=$.isPlainObject,extend=$.extend,map=$.map,grep=$.grep,isArray=$.isArray,inArray=$.inArray,push=Array.prototype.push,proxy=$.proxy,isFunction=joy.isFunction,isEmptyObject=$.isEmptyObject,math=Math,PROGRESS="progress",ERROR="error",DATA_CELL=":not(.k-group-cell):not(.k-hierarchy-cell):visible",SELECTION_CELL_SELECTOR="tbody>tr:not(.k-grouping-row):not(.k-detail-row):not(.k-group-footer) > td:not(.k-group-cell):not(.k-hierarchy-cell)",NAVROW="tr:not(.k-footer-template):visible",NAVCELL=":not(.k-group-cell):not(.k-hierarchy-cell):visible",FIRSTNAVITEM=NAVROW+":first>"+NAVCELL+":first",HEADERCELLS="th.k-header:not(.k-group-cell):not(.k-hierarchy-cell)",NS=".joyGrid",EDIT="edit",SAVE="save",REMOVE="remove",DETAILINIT="detailInit",FILTERMENUINIT="filterMenuInit",COLUMNMENUINIT="columnMenuInit",CHANGE="change",COLUMNHIDE="columnHide",COLUMNSHOW="columnShow",SAVECHANGES="saveChanges",DATABOUND="dataBound",DETAILEXPAND="detailExpand",DETAILCOLLAPSE="detailCollapse",FOCUSED="k-state-focused",SELECTED="k-state-selected",COLUMNRESIZE="columnResize",COLUMNREORDER="columnReorder",CLICK="click",HEIGHT="height",TABINDEX="tabIndex",FUNCTION="function",STRING="string",DELETECONFIRM=joyLang.grid.delete_confirm,CONFIRMDELETE="Delete",CANCELDELETE="Cancel",formatRegExp=/(\}|\#)/gi,templateHashRegExp=/#/gi,whitespaceRegExp="[\\x20\\t\\r\\n\\f]",nonDataCellsRegExp=new RegExp("(^|"+whitespaceRegExp+")(k-group-cell|k-hierarchy-cell)("+whitespaceRegExp+"|$)"),COMMANDBUTTONTMPL='<a class="k-button k-button-icontext #=className#" #=attr# href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',DIR="dir",ASC="asc",SINGLE="single",FIELD="field",DESC="desc",sorterNS=".joySorter",TLINK=".k-link",ARIASORT="aria-sort",isRtl=!1,browser=joy.support.browser,isIE7=browser.msie&&7==browser.version,isIE8=browser.msie&&8==browser.version,VirtualScrollable=Widget.extend({
init:function(a,b){var c=this;Widget.fn.init.call(c,a,b),c._refreshHandler=proxy(c.refresh,c),c.setDataSource(b.dataSource),c.wrap()},setDataSource:function(a){var b=this;b.dataSource&&b.dataSource.unbind(CHANGE,b._refreshHandler),b.dataSource=a,b.dataSource.bind(CHANGE,b._refreshHandler)},options:{name:"VirtualScrollable",itemHeight:$.noop},destroy:function(){var a=this;Widget.fn.destroy.call(a),a.dataSource.unbind(CHANGE,a._refreshHandler),a.wrapper.add(a.verticalScrollbar).off(NS),a.drag&&(a.drag.destroy(),a.drag=null),a.wrapper=a.element=a.verticalScrollbar=null,a._refreshHandler=null},wrap:function(){var a,b=this,c=joy.support.scrollbar()+1,d=b.element;d.css({width:"auto",overflow:"hidden"}).css(isRtl?"padding-left":"padding-right",c),b.content=d.children().first(),a=b.wrapper=b.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll"+NS+" mousewheel"+NS,proxy(b._wheelScroll,b)),joy.support.kineticScrollNeeded&&(b.drag=new joy.UserEvents(b.wrapper,{global:!0,move:function(c){b.verticalScrollbar.scrollTop(b.verticalScrollbar.scrollTop()-c.y.delta),a.scrollLeft(a.scrollLeft()-c.x.delta),c.preventDefault()}})),b.verticalScrollbar=$('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:c}).appendTo(d).bind("scroll"+NS,proxy(b._scroll,b))},_wheelScroll:function(a){var b=this.verticalScrollbar.scrollTop(),c=joy.wheelDeltaY(a);c&&(a.preventDefault(),this.verticalScrollbar.scrollTop(b+-c))},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b._rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=math.max(math.floor(c/e),0),k=math.max(j+math.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d._rangeStart||e.skip()||0,i=math.floor(a/g)*g,j=!1,k=.33;return h>a?(j=!0,h=math.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(i+g-g*k>a&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g)),j},_page:function(a,b){var c=this,d=c.dataSource;clearTimeout(c._timeout),c._fetching=!0,c._rangeStart=a,d.inRange(a,b)?d.range(a,b):(joy.ui.progress(c.wrapper.parent(),!0),c._timeout=setTimeout(function(){d.range(a,b)},100))},refresh:function(){var a,b,c,d=this,e="",f=25e4,g=d.dataSource,h=d._rangeStart,i=joy.support.kineticScrollNeeded?0:joy.support.scrollbar(),j=d.wrapper[0];joy.ui.progress(d.wrapper.parent(),!1),clearTimeout(d._timeout),c=d.itemHeight=d.options.itemHeight()||0;var k=j.scrollWidth>j.offsetWidth?i:0;for(a=g.total()*c+k,b=0;b<math.floor(a/f);b++)e+='<div style="width:1px;height:'+f+'px"></div>';a%f&&(e+='<div style="width:1px;height:'+a%f+'px"></div>'),d.verticalScrollbar.html(e),j.scrollTop=d._scrollTop,d.drag&&d.drag.cancel(),h&&!d._fetching&&(d._rangeStart=g.skip()),d._fetching=!1}}),defaultCommands={create:{text:joyLang.grid.add_new_record,imageClass:"k-add",className:"k-grid-add",iconClass:"k-icon"},cancel:{text:joyLang.grid.cancel_changes,imageClass:"k-cancel",className:"k-grid-cancel-changes",iconClass:"k-icon"},save:{text:joyLang.grid.save_changes,imageClass:"k-update",className:"k-grid-save-changes",iconClass:"k-icon"},destroy:{text:joyLang.grid.delete_record,imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"},edit:{text:joyLang.grid.edit,imageClass:"k-edit",className:"k-grid-edit",iconClass:"k-icon"},update:{text:joyLang.grid.update,imageClass:"k-update",className:"k-grid-update",iconClass:"k-icon"},canceledit:{text:joyLang.grid.cancel,imageClass:"k-cancel",className:"k-grid-cancel",iconClass:"k-icon"}},Grid=Widget.extend({init:function(a,b){var c=this;b=isArray(b)?{dataSource:b}:b,Widget.fn.init.call(c,a,b),isRtl=joy.support.isRtl(a),c._element(),c._aria(),c._columns(c.options.columns),c._dataSource(),c._tbody(),c.options.showPageControl||(c.options.pageOptions=!1),c._pageOptions(),c._thead(),c._groupable(),c._toolbar(),c._setContentHeight(),c._navigatable(),c._selectable(),c._details(),c._editable(),c._attachCustomCommandsEvent(),c.options.autoBind?(c._templates(),c.dataSource.fetch()):c._footer(),c.lockedContent&&(c.wrapper.addClass("k-grid-lockedcolumns"),c._resizeHandler=function(){c.resize()},$(window).on("resize"+NS,c._resizeHandler)),c._thead(),joy.notify(c)},events:[CHANGE,"dataBinding","cancel",DATABOUND,DETAILEXPAND,DETAILCOLLAPSE,DETAILINIT,FILTERMENUINIT,COLUMNMENUINIT,EDIT,SAVE,REMOVE,SAVECHANGES,COLUMNRESIZE,COLUMNREORDER,COLUMNSHOW,COLUMNHIDE],setDataSource:function(a){var b=this;b.options.dataSource=a,b._dataSource(),b._pageOptions(),b.options.groupable&&b._groupable(),b._thead(),b.virtualScrollable&&b.virtualScrollable.setDataSource(b.options.dataSource),b.options.autoBind&&a.fetch()},options:{name:"Grid",columns:[],toolbarOptions:null,autoBind:!0,filterable:!1,scrollable:!0,sortable:!0,selectable:"multiple",navigatable:!0,pageOptions:{buttonCount:5,input:!0,refresh:!0},showPageControl:!0,editType:!1,groupable:!1,rowTemplate:"",altRowTemplate:"",dataSource:{},height:null,resizable:!0,reorderable:!0,showColMenu:!1,detailTemplate:null,columnResizeHandleWidth:3,saveUrl:null,mobile:"",pkField:"id",pageSize:null,initResult:null,rowHeightFit:null},destroy:function(){var a,b=this;Widget.fn.destroy.call(b),b._resizeHandler&&$(window).off("resize"+NS,b._resizeHandler),b.pager&&b.pager.element&&b.pager.destroy(),b.pager=null,b.groupable&&b.groupable.element&&b.groupable.element.joyGroupable("destroy"),b.groupable=null,b.options.reorderable&&b.wrapper.data("joyReorderable").destroy(),b.selectable&&b.selectable.destroy(),b.resizable&&(b.resizable.destroy(),b._resizeUserEvents&&(b._resizeHandleDocumentClickHandler&&$(document).off("click",b._resizeHandleDocumentClickHandler),b._resizeUserEvents.destroy(),b._resizeUserEvents=null),b.resizable=null),b.virtualScrollable&&b.virtualScrollable.element&&b.virtualScrollable.destroy(),b.virtualScrollable=null,b._destroyColumnAttachments(),b._destroyEditable(),b.dataSource&&(b.dataSource.unbind(CHANGE,b._refreshHandler).unbind(PROGRESS,b._progressHandler).unbind(ERROR,b._errorHandler),b._refreshHandler=b._progressHandler=b._errorHandler=null),a=b.element.add(b.wrapper).add(b.table).add(b.thead).add(b.wrapper.find(">.k-grid-toolbar")),b.content&&(a=a.add(b.content).add(b.content.find(">.k-virtual-scrollable-wrap"))),b.lockedHeader&&b._removeLockedContainers(),b.pane&&b.pane.destroy(),b._draggableInstance&&b._draggableInstance.element&&b._draggableInstance.destroy(),b._draggableInstance=null,a.off(NS),joy.destroy(b.wrapper),b.scrollables=b.thead=b.tbody=b.element=b.table=b.content=b.footer=b.wrapper=b._groupableClickHandler=b._setContentWidthHandler=null},setOptions:function(a){var b=this;Widget.fn.setOptions.call(this,a),b._templates()},fetch:function(a,b,c){var d=this,e=d.dataSource.options.fields;d.options.initResult=a;for(var f=0;f<e.length;f++)null!=e[f].enumData?e[f].values=a[e[f].enumData]:null!=a[e[f].field]&&(e[f].values=a[e[f].field]);d.options.dataSource.transport={read:{url:b,data:c}},d.options.dataSource.type="odata",d.options.dataSource.serverPaging=!0,d._dataSource(),d._pageOptions(),d._sortable(),d._filterable(),d.nofirst||(d._scrollable(),d._updateCols()),d.nofirst=!0,d._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(d._appendLockedColumnHeader(d.thead.closest(".k-grid-header")),d._appendLockedColumnContent(),d._applyLockedContainersWidth()),d._resizable(),d._draggable(),d._reorderable(),d.groupable&&d._attachGroupable(),d.options.groupable&&d._groupable(),d.virtualScrollable&&d.virtualScrollable.setDataSource(d.options.dataSource),d._templates(),d.dataSource.fetch()},loadAsa:function(a,b){var c=this,d=c.dataSource.options.fields;c.options.initResult=a;for(var e=0;e<d.length;e++)null!=d[e].enumData?d[e].values=a[d[e].enumData]:null!=a[d[e].field]&&(d[e].values=a[d[e].field]);c.options.dataSource.data=b,c._dataSource(),c._pageOptions(),c._pageOptions(),c._sortable(),c._filterable(),c.nofirst||(c._scrollable(),c._updateCols()),c.nofirst=!0,c._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(c._appendLockedColumnHeader(c.thead.closest(".k-grid-header")),c._appendLockedColumnContent(),c._applyLockedContainersWidth()),c._resizable(),c._draggable(),c._reorderable(),c.options.groupable&&c._groupable(),c.virtualScrollable&&c.virtualScrollable.setDataSource(c.options.dataSource),c._templates(),c.dataSource.fetch()},load:function(a,b){var c=this,d=c.dataSource.options.fields;c.options.initResult=a;for(var e=0;e<d.length;e++)null!=d[e].enumData?d[e].values=a[d[e].enumData]:null!=a[d[e].field]&&(d[e].values=a[d[e].field]);c.options.dataSource.data=b,c._dataSource(),c._pageOptions(),c._pageOptions(),c._sortable(),c._filterable(),c.nofirst||(c._scrollable(),c._updateCols()),c.nofirst=!0,c._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(c._appendLockedColumnHeader(c.thead.closest(".k-grid-header")),c._appendLockedColumnContent(),c._applyLockedContainersWidth()),c._resizable(),c._draggable(),c._reorderable(),c._setContentHeight(),c.options.groupable&&c._groupable(),c.virtualScrollable&&c.virtualScrollable.setDataSource(c.options.dataSource),c._templates(),c.dataSource.fetch()},fetchAsa:function(a,b,c,d){var e=this,f=e.dataSource.options.fields;e.options.initResult=a,e.asaRead={url:b,method:c,search:d};for(var g=0;g<f.length;g++)null!=f[g].enumData?f[g].values=a[f[g].enumData]:null!=a[f[g].field]&&(f[g].values=a[f[g].field]);d||(d={}),joy.getJSONAsa(b,c,d,function(a){e.options.dataSource.data=a.NewDataSet.Table,e._dataSource(),e._pageOptions(),e._pageOptions(),e._sortable(),e._filterable(),e.nofirst||(e._scrollable(),e._updateCols()),e.nofirst=!0,e._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(e._appendLockedColumnHeader(e.thead.closest(".k-grid-header")),e._appendLockedColumnContent(),e._applyLockedContainersWidth()),e._resizable(),e._draggable(),e._reorderable(),e.options.groupable&&e._groupable(),e.virtualScrollable&&e.virtualScrollable.setDataSource(e.options.dataSource),e._templates(),e.dataSource.fetch()})},reflashAsa:function(){var a=this,b=this.asaRead;asaread&&joy.getJSONAsa(b.url,b.method,b.search,function(b){a.options.dataSource.data=b.NewDataSet.Table,a._dataSource(),a._pageOptions(),a._pageOptions(),a._sortable(),a._filterable(),a.nofirst||(a._scrollable(),a._updateCols()),a.nofirst=!0,a._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(a._appendLockedColumnHeader(a.thead.closest(".k-grid-header")),a._appendLockedColumnContent(),a._applyLockedContainersWidth()),a._resizable(),a._draggable(),a._reorderable(),a.options.groupable&&a._groupable(),a.virtualScrollable&&a.virtualScrollable.setDataSource(a.options.dataSource),a._templates(),a.dataSource.fetch()})},getChecked:function(){var a=new Array,b=0;return this.element.find(".j-checkbox").each(function(){$(this).is(":checked")&&(a[b]=$(this).val(),b++)}),a},setChecked:function(a,b){var c=this;b||(b="id");for(var d=0;d<a.length;d++){var e=c.dataSource.getByField(b,a[d]),f=c.tbody.find("tr["+joy.attr("uid")+"="+e.uid+"]");f.find(".j-checkbox").prop("checked",!0)}},checkAll:function(){this.element.find(".j-checkbox").each(function(){$(this).prop("checked",!0)})},inverse:function(){this.element.find(".j-checkbox").each(function(){$(this).prop("checked",!$(this).is(":checked"))})},uncheckAll:function(){this.element.find(".j-checkbox").each(function(){$(this).prop("checked",!1)})},items:function(){return this.tbody.children().filter(function(){var a=$(this);return!a.hasClass("k-grouping-row")&&!a.hasClass("k-detail-row")&&!a.hasClass("k-group-footer")})},_destroyColumnAttachments:function(){var a=this;a.resizeHandle=null,a.thead&&a.thead.find("th").each(function(){var a=$(this),b=a.data("joyFilterMenu"),c=a.data("joySorter"),d=a.data("joyColumnMenu");b&&b.destroy(),c&&c.destroy(),d&&d.destroy()})},_attachCustomCommandsEvent:function(){var a,b,c,d=this,e=d.columns||[];for(b=0,c=e.length;c>b;b++)a=e[b].command,a&&attachCustomCommandEvent(d,d.wrapper,a)},_aria:function(){var a=this.element.attr("id")||"aria";a&&(this._cellId=a+"_active_cell")},_element:function(){var a=this,b=a.element;b.is("table")||(b=a.options.scrollable?a.element.find("> .k-grid-content > table"):a.element.children("table"),b.length||(b=$("<table />").appendTo(a.element))),isIE7&&b.attr("cellspacing",0),a.table=b.attr("role",a._hasDetails()?"treegrid":"grid"),a._wrapper()},_createResizeHandle:function(a,b){var c,d=this,e=d.options.columnResizeHandleWidth,f=d.options.scrollable,g=d.resizeHandle;if(g&&d.lockedContent&&g.data("th")[0]!==b[0]&&(g.remove(),g=null),g||(g=d.resizeHandle=$('<div class="k-resize-handle"><div class="k-resize-handle-inner"></div></div>'),a.append(g)),isRtl){var h=b.closest(".k-grid-header-wrap, .k-grid-header-locked"),i=browser.msie?h.scrollLeft():0,j=browser.webkit?h[0].scrollWidth-h[0].offsetWidth-h.scrollLeft():0,k=browser.mozilla?h[0].scrollWidth-h[0].offsetWidth-(h[0].scrollWidth-h[0].offsetWidth-h.scrollLeft()):0;c=b.position().left-j+k-i}else c=b[0].offsetWidth,b.prevAll(":visible").each(function(){c+=this.offsetWidth});g.css({top:f?0:heightAboveHeader(d.wrapper),left:c-e,height:b.outerHeight(),width:3*e}).data("th",b).show()},_positionColumnResizeHandle:function(a){var b=this,c=b.options.columnResizeHandleWidth,d=b.lockedHeader?b.lockedHeader.find("thead:first"):$();b.thead.add(d).on("mousemove"+NS,"th",function(a){var d=$(this);if(!d.hasClass("k-group-cell")&&!d.hasClass("k-hierarchy-cell")){var e=a.clientX,f=$(window).scrollLeft(),g=d.offset().left+(isRtl?0:this.offsetWidth);e+f>g-c&&g+c>e+f?b._createResizeHandle(d.closest("div"),d):b.resizeHandle?b.resizeHandle.hide():cursor(b.wrapper,"")}})},_resizeHandleDocumentClick:function(a){$(a.target).closest(".k-column-active").length||($(document).off(a),this._hideResizeHandle())},_hideResizeHandle:function(){this.resizeHandle&&(this.resizeHandle.data("th").removeClass("k-column-active"),this.lockedContent&&!this._isMobile?(this.resizeHandle.remove(),this.resizeHandle=null):this.resizeHandle.hide())},_positionColumnResizeHandleTouch:function(a){var b=this,c=b.lockedHeader?b.lockedHeader.find("thead:first"):$();b._resizeUserEvents=new joy.UserEvents(c.add(b.thead),{filter:"th:not(.k-group-cell):not(.k-hierarchy-cell)",threshold:10,hold:function(a){var c=$(a.target);a.preventDefault(),c.addClass("k-column-active"),b._createResizeHandle(c.closest("div"),c),b._resizeHandleDocumentClickHandler||(b._resizeHandleDocumentClickHandler=proxy(b._resizeHandleDocumentClick,b)),$(document).on("click",b._resizeHandleDocumentClickHandler)}})},_resizable:function(){var a,b,c,d,e,f,g,h=this,i=h.options,j=this._isMobile,k=joy.support.mobileOS?0:joy.support.scrollbar();i.resizable&&(a=i.scrollable?h.wrapper.find(".k-grid-header-wrap:first"):h.wrapper,j?h._positionColumnResizeHandleTouch(a):h._positionColumnResizeHandle(a),h.resizable&&h.resizable.destroy(),h.resizable=new ui.Resizable(a.add(h.lockedHeader),{handle:".k-resize-handle",hint:function(a){return $('<div class="k-grid-resize-indicator" />').css({height:a.data("th").outerHeight()+h.tbody.attr("clientHeight")})},start:function(a){g=$(a.currentTarget).data("th"),j&&h._hideResizeHandle();var k=$.inArray(g[0],g.parent().children(":visible")),l=g.closest("table");e=l.parent().hasClass("k-grid-header-locked");var m=e?h.lockedTable:h.table,n=h.footer||$();h.footer&&h.lockedContent&&(n=h.footer.children(e?".k-grid-footer-locked":".k-grid-footer-wrap")),cursor(h.wrapper,"col-resize"),f=i.scrollable?l.find("col:eq("+k+")").add(m.children("colgroup").find("col:eq("+k+")")).add(n.find("colgroup").find("col:eq("+k+")")):m.children("colgroup").find("col:eq("+k+")"),b=a.x.location,c=g.outerWidth(),d=e?m.children("tbody").outerWidth():h.tbody.outerWidth()},resize:function(a){var j=isRtl?-1:1,l=c+a.x.location*j-b*j;if(i.scrollable){var m=(e?h.lockedFooter.children("table"):h.footer.find(">.k-grid-footer-wrap>table"))||$(),n=g.closest("table"),o=e?h.lockedTable:h.table,p=!1,q=h.wrapper.width()-k,r=l;e&&d-c+r>q&&(r=c+(q-d-2*k),0>r&&(r=l),p=!0),r>10&&(f.css("width",r),d&&(r=p?q-2*k:d+a.x.location*j-b*j,o.add(n).add(m).css("width",r),e||(h._footerWidth=r)))}else l>10&&f.css("width",l)},resizeend:function(){var a,b,d=g.outerWidth();cursor(h.wrapper,""),c!=d&&(b=h.lockedHeader?h.lockedHeader.find("thead:first").add(h.thead):g.parent(),a=h.columns[b.find("th:not(.k-group-cell):not(.k-hierarchy-cell)").index(g)],a.width=d,h.trigger(COLUMNRESIZE,{column:a,oldWidth:c,newWidth:d}),h._applyLockedContainersWidth(),h._syncLockedContentHeight(),h._syncLockedHeaderHeight()),h._hideResizeHandle(),g=null}}))},_draggable:function(){var a=this;a.options.reorderable&&(a._draggableInstance&&a._draggableInstance.destroy(),a._draggableInstance=a.wrapper.joyDraggable({group:joy.guid(),filter:a.content?".k-grid-header:first "+HEADERCELLS:"table:first>.k-grid-header "+HEADERCELLS,drag:function(){a._hideResizeHandle()},hint:function(a){return $('<div class="k-header k-drag-clue" />').css({width:a.width(),paddingLeft:a.css("paddingLeft"),paddingRight:a.css("paddingRight"),lineHeight:a.height()+"px",paddingTop:a.css("paddingTop"),paddingBottom:a.css("paddingBottom")}).html(a.attr(joy.attr("title"))||a.attr(joy.attr("field"))||a.text()).prepend('<span class="k-icon k-drag-status k-denied" />')}}).data("joyDraggable"))},_reorderable:function(){var a=this;a.options.reorderable&&(a.wrapper.data("joyReorderable")&&a.wrapper.data("joyReorderable").destroy(),a.wrapper.joyReorderable({draggable:a._draggableInstance,dragOverContainers:function(b){return a.columns[b].lockable!==!1},inSameContainer:function(a,b){return $(a).parent()[0]===$(b).parent()[0]},change:function(b){var c=a.columns[b.oldIndex];a.trigger(COLUMNREORDER,{newIndex:b.newIndex,oldIndex:inArray(c,a.columns),column:c}),a.reorderColumn(b.newIndex,c,"before"===b.position)}}))},reorderColumn:function(a,b,c){var d,e,f,g=this,h=g.columns,i=inArray(b,h),j=h[a],k=inArray(b,visibleColumns(h)),l=inArray(j,visibleColumns(h)),m=l,n=l,o=$(),p=!!j.locked,q=lockedColumns(h).length,r=g.footer||g.wrapper.find(".k-grid-footer");if(i!==a&&!(!b.locked&&p&&1==nonLockedColumns(h).length||b.locked&&!p&&1==q)){for(j.hidden&&(p?(l=g.lockedTable.find("colgroup"),m=g.lockedHeader.find("colgroup"),n=$(g.lockedFooter).find(">table>colgroup")):(l=g.tbody.prev(),m=g.thead.prev(),n=r.find(".k-grid-footer-wrap").find(">table>colgroup"))),b.locked=p,g._hideResizeHandle(),c===undefined&&(c=i>a),h.splice(c?a:a+1,0,b),h.splice(a>i?i:i+1,1),g._templates(),reorder(elements(g.lockedHeader,g.thead.prev(),"col:not(.k-group-col,.k-hierarchy-col)"),k,m,c),g.options.scrollable&&reorder(elements(g.lockedTable,g.tbody.prev(),"col:not(.k-group-col,.k-hierarchy-col)"),k,l,c),reorder(elements(g.lockedHeader,g.thead,"th.k-header:not(.k-group-cell,.k-hierarchy-cell)"),i,a,c),r&&r.length&&(reorder(elements(g.lockedFooter,r.find(".k-grid-footer-wrap"),">table>colgroup>col:not(.k-group-col,.k-hierarchy-col)"),k,n,c),reorder(r.find(".k-footer-template>td:not(.k-group-cell,.k-hierarchy-cell)"),i,a,c)),d=g.tbody.children(":not(.k-grouping-row,.k-detail-row)"),g.lockedTable&&(q>a?i>=q&&updateColspan(g.lockedTable.find(">tbody>tr.k-grouping-row"),g.table.find(">tbody>tr.k-grouping-row")):q>i&&updateColspan(g.table.find(">tbody>tr.k-grouping-row"),g.lockedTable.find(">tbody>tr.k-grouping-row")),o=g.lockedTable.find(">tbody>tr:not(.k-grouping-row,.k-detail-row)")),e=0,f=d.length;f>e;e+=1)reorder(elements(o[e],d[e],">td:not(.k-group-cell,.k-hierarchy-cell)"),i,a,c);g._updateTablesWidth(),g._applyLockedContainersWidth(),g._syncLockedContentHeight()}},lockColumn:function(a){var b=this.columns;if(a="number"==typeof a?b[a]:grep(b,function(b){return b.field===a})[0],a&&!a.locked&&!a.hidden){var c=lockedColumns(b).length-1;this.reorderColumn(c,a,!1)}},unlockColumn:function(a){var b=this.columns;if(a="number"==typeof a?b[a]:grep(b,function(b){return b.field===a})[0],a&&a.locked&&!a.hidden){var c=lockedColumns(b).length;this.reorderColumn(c,a,!0)}},cellIndex:function(a){var b=0;return this.lockedTable&&!$.contains(this.lockedTable[0],a[0])&&(b=lockedColumns(this.columns).length),$(a).parent().children("td:not(.k-group-cell,.k-hierarchy-cell)").index(a)+b},_modelForContainer:function(a){a=$(a),a.is("tr")||"popup"===this._editMode()||(a=a.closest("tr"));var b=a.attr(joy.attr("uid"));return this.dataSource.getByUid(b)},_editable:function(){var a=this,b=a.selectable&&a.selectable.options.multiple,c=a.options.editType,d=function(){var b=activeElement(),c=a._editContainer;!c||$.contains(c[0],b)||c[0]===b||$(b).closest(".k-animation-container").length||a.editable.end()&&a.closeCell()};if(c){var e=a._editMode();"incell"===e?c.update!==!1&&a.wrapper.on(CLICK+NS,"tr:not(.k-grouping-row) > td",function(c){var d=$(this),e=a.lockedTable&&d.closest("table")[0]===a.lockedTable[0];d.hasClass("k-hierarchy-cell")||d.hasClass("k-detail-cell")||d.hasClass("k-group-cell")||d.hasClass("k-edit-cell")||d.has("a.k-grid-delete").length||d.has("button.k-grid-delete").length||d.closest("tbody")[0]!==a.tbody[0]&&!e||$(c.target).is(":input")||(a.editable?a.editable.end()&&(b&&$(activeElement()).blur(),a.closeCell(),a.editCell(d)):a.editCell(d))}).on("focusin"+NS,function(){clearTimeout(a.timer),a.timer=null}).on("focusout"+NS,function(){a.timer=setTimeout(d,1)}):c.update!==!1&&a.wrapper.on(CLICK+NS,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-edit",function(b){b.preventDefault(),a.editRow($(this).closest("tr"))}),c.destroy!==!1?a.wrapper.on(CLICK+NS,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible .k-grid-delete",function(b){b.preventDefault(),b.stopPropagation(),a.removeRow($(this).closest("tr"))}):a.wrapper.on(CLICK+NS,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible button.k-grid-delete",function(b){b.stopPropagation(),a._confirmation()||b.preventDefault()})}},editCell:function(a){a=$(a);var b=this,c=b.columns[b.cellIndex(a)],d=b._modelForContainer(a);if(d&&(!d.editable||d.editable(c.field))&&!c.command&&c.field){b._attachModelChange(d),b._editContainer=a,b.editable=a.addClass("k-edit-cell").joyEditable({fields:{field:c.field,format:c.format,editor:c.editor,values:c.values},model:d,change:function(c){b.trigger(SAVE,{values:c.values,container:a,model:d})&&c.preventDefault()}}).data("joyEditable");var e=a.parent().addClass("k-grid-edit-row");b.lockedContent&&adjustRowHeight(e[0],b._relatedRow(e).addClass("k-grid-edit-row")[0]),b.trigger(EDIT,{container:a,model:d})}},_adjustLockedHorizontalScrollBar:function(){var a=this.content,b=a[0].offsetHeight-a[0].clientHeight>0?joy.support.scrollbar():0;this.lockedContent.height(a.height()-b)},_syncLockedContentHeight:function(){this.lockedTable&&(this._adjustLockedHorizontalScrollBar(),this._adjustRowsHeight(this.table,this.lockedTable))},_syncLockedHeaderHeight:function(){this.lockedHeader&&this._adjustRowsHeight(this.lockedHeader.children("table"),this.thead.parent())},_syncLockedFooterHeight:function(){this.lockedFooter&&this.footer&&this.footer.length&&this._adjustRowsHeight(this.lockedFooter.children("table"),this.footer.find(".k-grid-footer-wrap > table"))},_destroyEditable:function(){var a=this,b=function(){a.editable&&(a._detachModelChange(),a.editable.destroy(),a.editable=null,a._editContainer=null,a._destroyEditView())};a.editable&&("popup"!==a._editMode()||a._isMobile?b():a._editContainer.data("joyWindow").bind("deactivate",b).close()),a._actionSheet&&(a._actionSheet.destroy(),a._actionSheet=null)},_destroyEditView:function(){this.editView&&(this.editView.purge(),this.editView=null,this.pane.navigate(""))},_attachModelChange:function(a){var b=this;b._modelChangeHandler=function(a){b._modelChange({field:a.field,model:this})},a.bind("change",b._modelChangeHandler)},_detachModelChange:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b);c&&c.unbind(CHANGE,a._modelChangeHandler)},closeCell:function(a){var b,c,d,e,f=this,g=f._editContainer;g&&(b=g.closest("tr").attr(joy.attr("uid")),e=f.dataSource.getByUid(b),a&&f.trigger("cancel",{container:g,model:e})||(g.removeClass("k-edit-cell"),c=f.columns[f.cellIndex(g)],d=g.parent().removeClass("k-grid-edit-row"),f._destroyEditable(),f._displayCell(g,c,e),g.hasClass("k-dirty-cell")&&$('<span class="k-dirty"/>').prependTo(g),f.lockedContent&&adjustRowHeight(d.css("height","")[0],f._relatedRow(d).css("height","")[0])))},_displayCell:function(a,b,c){var d=this,e={storage:{},count:0},f=extend({},joy.Template,d.options.templateSettings),g=joy.template(d._cellTmpl(b,e),f);e.count>0&&(g=proxy(g,e.storage)),a.empty().html(g(c))},removeRow:function(a){this._confirmation(a)&&this._removeRow(a)},_removeRow:function(a){var b,c=this,d=c._editMode();"incell"!==d&&c.cancelRow(),a=$(a).hide(),b=c._modelForContainer(a),b&&!c.trigger(REMOVE,{row:a,model:b})?(c.dataSource.remove(b),("inline"===d||"popup"===d)&&c.dataSource.sync()):"incell"===d&&c._destroyEditable()},_editMode:function(){var a="incell",b=this.options.editType;return b!==!0&&(a="string"==typeof b?b:b.mode||a),a},editRow:function(a){var b,c=this;a instanceof joy.data.ObservableObject?b=a:(a=$(a),b=c._modelForContainer(a));var d,e=c._editMode(),f=c.options.navigatable;c.cancelRow(),b&&(c._attachModelChange(b),"popup"===e?c._createPopupEditor(b):"inline"===e?c._createInlineEditor(a,b):"incell"===e&&$(a).children(DATA_CELL).each(function(){var a=$(this),d=c.columns[a.index()];return b=c._modelForContainer(a),b&&(!b.editable||b.editable(d.field))&&d.field?(c.editCell(a),!1):void 0}),d=c.editView?c.editView.element:c._editContainer,d.on(CLICK+NS,"a.k-grid-cancel",function(a){if(a.preventDefault(),a.stopPropagation(),!c.trigger("cancel",{container:d,model:b})){var e=c.items().index($(c.current()).parent());c.cancelRow(),f&&(c.current(c.items().eq(e).children().filter(NAVCELL).first()),focusTable(c.table,!0))}}),d.on(CLICK+NS,"a.k-grid-update",function(a){a.preventDefault(),a.stopPropagation(),c.saveRow()}))},_createPopupEditor:function(a){var b,c,d,e,f,g,h,i,j,k=this,l="<div "+joy.attr("uid")+'="'+a.uid+'" class="k-popup-edit-form'+(k._isMobile?" k-mobile-list":"")+'"><div class="k-edit-form-container">',m=[],n=k.options.editType,o=n.template,p=isPlainObject(n)?n.window:{},q=extend({},joy.Template,k.options.templateSettings);if(p=p||{},o)for(typeof o===STRING&&(o=window.unescape(o)),l+=joy.template(o,q)(a),d=0,e=k.columns.length;e>d;d++)b=k.columns[d],b.command&&(i=getCommand(b.command,"edit"),i&&(c=i));else for(d=0,e=k.columns.length;e>d;d++)if(b=k.columns[d],b.command)b.command&&(i=getCommand(b.command,"edit"),i&&(c=i));else if(l+='<div class="k-edit-label"><label for="'+b.field+'">'+(b.title||b.field||"")+"</label></div>",a.editable&&!a.editable(b.field)||!b.field){var r={storage:{},count:0};f=joy.template(k._cellTmpl(b,r),q),r.count>0&&(f=proxy(f,r.storage)),l+='<div class="k-edit-field">'+f(a)+"</div>"}else m.push({field:b.field,format:b.format,editor:b.editor,values:b.values}),l+="<div "+joy.attr("container-for")+'="'+b.field+'" class="k-edit-field"></div>';c&&isPlainObject(c)&&(c.text&&isPlainObject(c.text)&&(g=c.text.update,h=c.text.cancel),c.attr&&(j=c.attr));var s;k._isMobile?(l+="</div></div>",k.editView=k.pane.append("<div data-"+joy.ns+'role="view" data-'+joy.ns+'init-widgets="false" class="k-grid-edit-form"><div data-'+joy.ns+'role="header" class="k-header">'+k._createButton({name:"update",text:g,attr:j})+(p.title||"Edit")+k._createButton({name:"canceledit",text:h,attr:j})+"</div>"+l+"</div>"),s=k._editContainer=k.editView.element.find(".k-popup-edit-form")):(l+='<div class="k-edit-buttons k-state-default">',l+=k._createButton({name:"update",text:g,attr:j})+k._createButton({name:"canceledit",text:h,attr:j}),l+="</div></div></div>",s=k._editContainer=$(l).appendTo(k.wrapper).eq(0).joyWindow(extend({modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1,close:function(b){if(b.userTriggered){if(b.sender.element.focus(),k.trigger("cancel",{container:s,model:a}))return void b.preventDefault();var c=k.items().index($(k.current()).parent());k.cancelRow(),k.options.navigatable&&(k.current(k.items().eq(c).children().filter(NAVCELL).first()),focusTable(k.table,!0))}}},p))),k.editable=k._editContainer.joyEditable({fields:m,model:a,clearContainer:!1}).data("joyEditable"),k._isMobile&&s.find("input[type=checkbox],input[type=radio]").parent(".k-edit-field").addClass("k-check").prev(".k-edit-label").addClass("k-check").click(function(){$(this).next().children("input").click()}),k._openPopUpEditor(),k.trigger(EDIT,{container:s,model:a})},_openPopUpEditor:function(){this._isMobile?this.pane.navigate(this.editView,this._editAnimation):this._editContainer.data("joyWindow").center().open()},_createInlineEditor:function(a,b){var c,d,e,f=this,g=[];f.lockedContent&&(a=a.add(f._relatedRow(a))),a.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){if(d=$(this),c=f.columns[f.cellIndex(d)],c.command||!c.field||b.editable&&!b.editable(c.field)){if(c.command&&(e=getCommand(c.command,"edit"))){d.empty();var a,h,i;isPlainObject(e)&&(e.text&&isPlainObject(e.text)&&(a=e.text.update,h=e.text.cancel),e.attr&&(i=e.attr)),$(f._createButton({name:"update",text:a,attr:i})+f._createButton({name:"canceledit",text:h,attr:i})).appendTo(d)}}else g.push(c),d.attr(joy.attr("container-for"),c.field),d.empty()}),f._editContainer=a,f.editable=new joy.ui.Editable(a.addClass("k-grid-edit-row"),{fields:g,model:b,clearContainer:!1}),a.length>1&&(adjustRowHeight(a[0],a[1]),f._applyLockedContainersWidth()),f.trigger(EDIT,{container:a,model:b})},cancelRow:function(){var a,b=this,c=b._editContainer;c&&(a=b._modelForContainer(c),b._destroyEditable(),b.dataSource.cancelChanges(a),b._displayRow("popup"!==b._editMode()?c:b.items().filter("["+joy.attr("uid")+"="+a.uid+"]")))},saveRow:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b),d=a.editable;b&&d&&d.end()&&!a.trigger(SAVE,{container:b,model:c})&&(a.dataSource.transport.options.update.url=a.options.saveUrl,a.dataSource.transport.options.update.type="POST",a.dataSource.transport.options.create.url=a.options.saveUrl,a.dataSource.transport.options.create.type="POST",a.dataSource.sync())},_displayRow:function(a){var b,c,d=this,e=d._modelForContainer(a),f=a.hasClass("k-alt");e&&(d.lockedContent&&(b=$((f?d.lockedAltRowTemplate:d.lockedRowTemplate)(e)),d._relatedRow(a.last()).replaceWith(b)),c=$((f?d.altRowTemplate:d.rowTemplate)(e)),a.replaceWith(c),b&&adjustRowHeight(c[0],b[0]))},_showMessage:function(a,b){var c=this;if(!c._isMobile)return window.confirm(a.title);var d=joy.template('<ul><li class="km-actionsheet-title">#:title#</li><li><a href="\\#" class="k-button k-grid-delete">#:confirmDelete#</a></li></ul>'),e=$(d(a)).appendTo(c.view.element),f=c._actionSheet=new joy.mobile.ui.ActionSheet(e,{cancel:a.cancelDelete,cancelTemplate:'<li class="km-actionsheet-cancel"><a class="k-button" href="\\#">#:cancel#</a></li>',close:function(){this.destroy()},command:function(a){var d=$(a.currentTarget).parent();d.hasClass("km-actionsheet-cancel")||c._removeRow(b)},popup:c._actionSheetPopupOptions});return f.open(b),!1},_confirmation:function(a){var b=this,c=b.options.editType,d=c===!0||typeof c===STRING?DELETECONFIRM:c.confirmation;return d!==!1&&null!=d?(typeof d===FUNCTION&&(d=d(b._modelForContainer(a))),b._showMessage({confirmDelete:c.confirmDelete||CONFIRMDELETE,cancelDelete:c.cancelDelete||CANCELDELETE,title:d===!0?DELETECONFIRM:d},a)):!0},cancelChanges:function(){this.dataSource.cancelChanges()},saveChanges:function(){var a=this;(a.editable&&a.editable.end()||!a.editable)&&!a.trigger(SAVECHANGES)&&a.dataSource.sync()},addRow:function(){var a,b=this,c=b.dataSource,d=b._editMode(),e=b.options.editType.createAt||"bottom",f=c.pageSize(),g=c.view()||[];if(b.editable&&b.editable.end()||!b.editable){"incell"!=d&&b.cancelRow(),a=c.indexOf(g[0]),"bottom"==e.toLowerCase()&&(a+=g.length,f&&!c.options.serverPaging&&f<=g.length&&(a-=1)),0>a&&(a=c.page()>c.totalPages()?(c.page()-1)*f:0);

var h;h=c.insert(a,{});var i=h.uid,j=b.lockedContent?b.lockedTable:b.table,k=j.find("tr["+joy.attr("uid")+"="+i+"]"),l=k.children("td:not(.k-group-cell,.k-hierarchy-cell)").eq(b._firstEditableColumnIndex(k));"inline"===d&&k.length?b.editRow(k):"popup"===d?b.editRow(h):l.length&&b.editCell(l)}},_firstEditableColumnIndex:function(a){var b,c,d,e=this,f=e.columns,g=e._modelForContainer(a);for(c=0,d=f.length;d>c;c++)if(b=f[c],g&&(!g.editable||g.editable(b.field))&&!b.command&&b.field)return c;return-1},_toolbar:function(){var a,b=this,c=b.wrapper,d=b.options.toolbarOptions,e=b.options.editType;d&&(a=b.wrapper.find(".k-grid-toolbar"),a.length||(isFunction(d)||(d=typeof d===STRING?d:b._toolbarTmpl(d).replace(templateHashRegExp,"\\#"),d=proxy(joy.template(d),b)),a=$('<div class="k-toolbar k-grid-toolbar" />').html(d({})).prependTo(c)),e&&e.create!==!1&&a.on(CLICK+NS,".k-grid-add",function(a){a.preventDefault(),b.addRow()}).on(CLICK+NS,".k-grid-cancel-changes",function(a){a.preventDefault(),b.cancelChanges()}).on(CLICK+NS,".k-grid-save-changes",function(a){a.preventDefault(),b.saveChanges()}))},_toolbarTmpl:function(a){var b,c,d=this,e="";if(isArray(a))for(b=0,c=a.length;c>b;b++)e+=d._createButton(a[b]);return e},_createButton:function(a){var b=a.template||COMMANDBUTTONTMPL,c=typeof a===STRING?a:a.name||a.text,d=defaultCommands[c]?defaultCommands[c].className:"k-grid-"+(c||"").replace(/\s/g,""),e={className:d,text:c,imageClass:"",attr:"",iconClass:""};if(!(c||isPlainObject(a)&&a.template))throw new Error("Custom commands should have name specified");return isPlainObject(a)?(a.className&&(a.className+=" "+e.className),"edit"===c&&isPlainObject(a.text)&&(a=extend(!0,{},a),a.text=a.text.edit),a.attr&&isPlainObject(a.attr)&&(a.attr=stringifyAttributes(a.attr)),e=extend(!0,e,defaultCommands[c],a)):e=extend(!0,e,defaultCommands[c]),joy.template(b)(e)},_hasFooters:function(){return!!this.footerTemplate||!!this.groupFooterTemplate||this.footer&&this.footer.length>0||this.wrapper.find(".k-grid-footer").length>0},_groupable:function(){var a=this;a._groupableClickHandler?a.table.off(CLICK+NS,a._groupableClickHandler):a._groupableClickHandler=function(b){var c=$(this),d=c.closest("tr");c.hasClass("k-i-collapse")?a.collapseGroup(d):a.expandGroup(d),b.preventDefault(),b.stopPropagation()},a._isLocked()?a.lockedTable.on(CLICK+NS,".k-grouping-row .k-i-collapse, .k-grouping-row .k-i-expand",a._groupableClickHandler):a.table.on(CLICK+NS,".k-grouping-row .k-i-collapse, .k-grouping-row .k-i-expand",a._groupableClickHandler),a._attachGroupable()},_attachGroupable:function(){var a=this,b=a.wrapper,c=a.options.groupable,d=HEADERCELLS+":visible["+joy.attr("field")+"]",e=HEADERCELLS+"["+joy.attr("field")+"]";c&&(b.has("div.k-grouping-header")[0]||$("<div>&nbsp;</div>").addClass("k-grouping-header").prependTo(b),a.groupable&&a.groupable.destroy(),a.groupable=new Groupable(b,extend({},c,{draggable:a._draggableInstance,groupContainer:">div.k-grouping-header",dataSource:a.dataSource,draggableElements:a.content?".k-grid-header:first "+d:"table:first>.k-grid-header "+d,filter:a.content?".k-grid-header:first "+e:"table:first>.k-grid-header "+e,allowDrag:a.options.reorderable})))},_continuousItems:function(a,b){if(this.lockedContent){for(var c=this,d=c.table.add(c.lockedTable),e=$(a,d[0]),f=$(a,d[1]),g=b?lockedColumns(c.columns).length:1,h=b?c.columns.length-g:1,i=[],j=0;j<e.length;j+=g)push.apply(i,e.slice(j,j+g)),push.apply(i,f.splice(0,h));return i}},_selectable:function(){var a,b,c=this,d=[],e=c.options.selectable;if(e){a=typeof e===STRING&&e.toLowerCase().indexOf("multiple")>-1,b=typeof e===STRING&&e.toLowerCase().indexOf("cell")>-1,c._hasDetails()&&(d[d.length]=".k-detail-row"),(c.options.groupable||c._hasFooters())&&(d[d.length]=".k-grouping-row,.k-group-footer"),d=d.join(","),""!==d&&(d=":not("+d+")");var f=c.table;c.lockedContent&&(f=f.add(c.lockedTable));var g=">"+(b?SELECTION_CELL_SELECTOR:"tbody>tr"+d);c.selectable=new joy.ui.Selectable(f,{filter:g,aria:!0,multiple:a,change:function(){c.trigger(CHANGE)},useAllItems:c.lockedContent&&a&&b,relatedTarget:function(a){if(!b&&c.lockedContent){for(var d,e=$(),f=0,g=a.length;g>f;f++)d=c._relatedRow(a[f]),inArray(d[0],a)<0&&(e=e.add(d));return e}},continuousItems:function(){return c._continuousItems(g,b)}}),c.options.navigatable&&c.table.on("keydown"+NS,function(d){var e=c.current();if(d.keyCode===keys.SPACEBAR&&d.target==c.table[0]&&!e.is(".k-edit-cell,.k-header")&&e.parent().is(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")){if(d.preventDefault(),d.stopPropagation(),e=b?e:e.parent(),a)if(d.ctrlKey){if(e.hasClass(SELECTED))return e.removeClass(SELECTED),void c.trigger(CHANGE)}else c.selectable.clear();else c.selectable.clear();c.selectable.value(e)}})}},_relatedRow:function(a){var b=this.lockedTable;if(a=$(a),!b)return a;var c=a.closest(this.table.add(this.lockedTable)),d=c.find(">tbody>tr").index(a);return c=c[0]===this.table[0]?b:this.table,c.find(">tbody>tr").eq(d)},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(CHANGE)},select:function(a){var b=this,c=b.selectable;return a=$(a),a.length?(c.options.multiple||(c.clear(),a=a.first()),void c.value(a)):c.value()},getSelect:function(){var a=this;if(1==this.select().length)return a._modelForContainer(a.select());var b=new Array;return this.select().each(function(){b.push(a._modelForContainer(this))}),b},setSelect:function(a,b){var c=this,d=c.selectable;if(b||(b="id"),a.constructor!=Array){var e=c.dataSource.getByField(b,a),f=c.tbody.find("tr["+joy.attr("uid")+"="+e.uid+"]");d.value(f)}else for(var g=0;g<a.length;g++){var e=c.dataSource.getByField(b,a[g]),f=c.tbody.find("tr["+joy.attr("uid")+"="+e.uid+"]");d.value(f)}},current:function(a){var b=this,c=b.options.scrollable,d=b._current,e=b.table.add(b.thead.parent());if(a!==undefined&&a.length&&(!d||d[0]!==a[0])&&(d&&(d.removeClass(FOCUSED).removeAttr("id"),e.removeAttr("aria-activedescendant")),a.attr("id",b._cellId),b._current=a.addClass(FOCUSED),e.attr("aria-activedescendant",b._cellId),a.length&&c)){var f=a.closest("table").parent();f.is(".k-grid-content,.k-grid-content-locked")&&b._scrollTo(a.parent()[0],b.content[0]),f.is(".k-grid-content-locked,.k-grid-header-locked")||(c.virtual?b._scrollTo(a[0],b.content.find(">.k-virtual-scrollable-wrap")[0]):b._scrollTo(a[0],b.content[0]))}return b._current},_removeCurrent:function(){this._current&&(this._current.removeClass(FOCUSED),this._current=null)},_scrollTo:function(a,b){var c=a.tagName.toLowerCase(),d="td"===c||"th"===c,e=a[d?"offsetLeft":"offsetTop"],f=a[d?"offsetWidth":"offsetHeight"],g=b[d?"scrollLeft":"scrollTop"],h=b[d?"clientWidth":"clientHeight"],i=e+f,j=0;j=g>e?e:i>g+h?h>=f?i-h:e:g,b[d?"scrollLeft":"scrollTop"]=j},_navigatable:function(){var a=this,b=proxy(a.current,a),c=a.table.add(a.lockedTable),d=a.thead.parent().add($(">table",a.lockedHeader)),e=(a._isLocked(),c),f=joy.support.isRtl(a.element);a.options.navigatable&&(a.options.scrollable&&(e=c.add(d),d.attr(TABINDEX,-1)),d.on("keydown"+NS,function(a){a.altKey&&a.keyCode==keys.DOWN&&(b().find(".k-grid-filter, .k-header-column-menu").click(),a.stopImmediatePropagation())}).find("a.k-link").attr("tabIndex",-1),c.attr(TABINDEX,math.max(c.attr(TABINDEX)||0,0)).on("mousedown"+NS+" keydown"+NS,".k-detail-cell",function(a){a.target!==a.currentTarget&&a.stopImmediatePropagation()}),e.on(joy.support.touch?"touchstart"+NS:"mousedown"+NS,NAVROW+">"+NAVCELL,proxy(tableClick,a)).on("focus"+NS,function(){if(!joy.support.touch){var a=b();a&&a.is(":visible")?a.addClass(FOCUSED):b($(this).find(FIRSTNAVITEM)),c.attr(TABINDEX,-1),d.attr(TABINDEX,-1),$(this).attr(TABINDEX,0)}}).on("focusout"+NS,function(){var a=b();a&&a.removeClass(FOCUSED)}).on("keydown"+NS,function(e){var g,h,i=e.keyCode,j=!1,k=!e.isDefaultPrevented()&&!$(e.target).is(":button,a,:input,a>.k-icon"),l=a.options.pageOptions,m=a.dataSource,n="incell"==a._editMode(),o=e.shiftKey,p=proxy(a._relatedRow,a),q=b();if(q&&q.is("th")&&(k=!0),k&&i==keys.UP)b(moveVertical(q,e.currentTarget,c,d,!0)),j=!0;else if(k&&i==keys.DOWN)b(moveVertical(q,e.currentTarget,c,d)),j=!0;else if(k&&i==(f?keys.RIGHT:keys.LEFT))b(moveLeft(q,e.currentTarget,c,d,p)),j=!0;else if(k&&i==(f?keys.LEFT:keys.RIGHT))b(moveRight(q,e.currentTarget,c,d,p)),j=!0;else if(k&&l&&keys.PAGEDOWN==i)m.page(m.page()+1),j=!0;else if(k&&l&&keys.PAGEUP==i)m.page(m.page()-1),j=!0;else if(i==keys.ENTER||keys.F2==i)if(q=q?q:c.find(FIRSTNAVITEM),q.is("th"))q.find(".k-link").click(),j=!0;else if(q.parent().is(".k-master-row,.k-grouping-row"))q.parent().find(".k-icon:first").click(),j=!0;else{var r=q.find(":joyFocusable:first");if(!q.hasClass("k-edit-cell")&&r[0]&&q.hasClass("k-state-focused"))r.focus(),j=!0;else if(a.options.editType&&!$(e.target).is(":button,.k-button,textarea")){var s=$(e.target).closest("[role=gridcell]");s[0]||(s=q),a._handleEditing(s,!1,n?e.currentTarget:c[0]),j=!0}}else if(keys.ESC==i)g=activeElement(),q&&$.contains(q[0],g)&&!q.hasClass("k-edit-cell")&&!q.parent().hasClass("k-grid-edit-row")?(focusTable(e.currentTarget,!0),j=!0):!a._editContainer||q&&!a._editContainer.has(q[0])&&q[0]!==a._editContainer[0]||(n?a.closeCell(!0):(h=$(q).parent().index(),g&&g.blur(),a.cancelRow(),h>=0&&a.current(c.find(">tbody>tr").eq(h).children().filter(NAVCELL).first())),browser.msie&&browser.version<9&&document.body.focus(),focusTable(n?e.currentTarget:c[0],!0),j=!0);else if(keys.TAB==i){var t;q=$(q),a.options.editType&&n&&(t=$(activeElement()).closest(".k-edit-cell"),t[0]&&t[0]!==q[0]&&(q=t)),t=tabNext(q,e.currentTarget,c,p,o),!q.is("th")&&t.length&&a.options.editType&&n&&(a._handleEditing(q,t,t.closest(c)),j=!0)}j&&(e.preventDefault(),e.stopPropagation())}))},_handleEditing:function(a,b,c){var d,e,f=this,g=$(activeElement()),h=f._editMode(),i=browser.msie,j=i&&browser.version<9,k=f._editContainer;if(c=$(c),e="incell"==h?a.hasClass("k-edit-cell"):a.parent().hasClass("k-grid-edit-row"),f.editable){if($.contains(k[0],g[0])&&(browser.opera||j?g.change().triggerHandler("blur"):(g.blur(),i&&g.blur())),!f.editable)return void focusTable(c);if(!f.editable.end())return f.current("incell"==h?k:k.children().filter(DATA_CELL).first()),d=k.find(":joyFocusable:first")[0],void(d&&d.focus());"incell"==h?f.closeCell():(f.saveRow(),e=!0)}b&&f.current(b),j&&document.body.focus(),focusTable(c,!0),(!e&&!b||b)&&("incell"==h?f.editCell(f.current()):f.editRow(f.current().parent()))},_wrapper:function(){var a=this,b=a.table,c=a.options.height,d=a.element;d.is("div")||(d=d.wrap("<div/>").parent()),a.wrapper=d.addClass("k-grid k-widget"),c&&(a.wrapper.css(HEIGHT,c),b.css(HEIGHT,"auto")),a._initMobile()},_initMobile:function(){var a=this.options,b=this;if(this._isMobile=a.mobile===!0&&joy.support.mobileOS||"phone"===a.mobile||"tablet"===a.mobile,this._isMobile){var c=this.wrapper.addClass("k-grid-mobile").wrap("<div data-"+joy.ns+'role="view" data-'+joy.ns+'init-widgets="false"></div>').parent();this.pane=joy.mobile.ui.Pane.wrap(c),this.view=this.pane.view(),this._actionSheetPopupOptions=$(document.documentElement).hasClass("km-root")?{modal:!1}:{align:"bottom center",position:"bottom center",effect:"slideIn:up"},a.height&&this.pane.element.parent().css(HEIGHT,a.height),this._editAnimation="slide",this.view.bind("show",function(){b._isLocked()&&(b._updateTablesWidth(),b._applyLockedContainersWidth(),b._syncLockedContentHeight(),b._syncLockedHeaderHeight(),b._syncLockedFooterHeight())})}},_tbody:function(){var a,b=this,c=b.table;a=c.find(">tbody"),a.length||(a=$("<tbody/>").appendTo(c)),b.tbody=a.attr("role","rowgroup")},_scrollable:function(){var a,b,c=this,d=c.options,e=d.scrollable,f=e!==!0&&e.virtual&&!c.virtualScrollable,g=!joy.support.kineticScrollNeeded||f?joy.support.scrollbar():0;if(e){a=c.wrapper.children(".k-grid-header"),a[0]||(a=$('<div class="k-grid-header" />').insertBefore(c.table)),a.css(isRtl?"padding-left":"padding-right",e.virtual?g+1:g),b=$('<table role="grid" />'),isIE7&&b.attr("cellspacing",0),b.append(c.thead),a.empty().append($('<div class="k-grid-header-wrap" />').append(b)),c.content=c.table.parent(),c.content.is(".k-virtual-scrollable-wrap")&&(c.content=c.content.parent()),c.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(c.content=c.table.wrap('<div class="k-grid-content" />').parent()),f&&(c.virtualScrollable=new VirtualScrollable(c.content,{dataSource:c.dataSource,itemHeight:function(){return c._averageRowHeight()}})),c.scrollables=a.children(".k-grid-header-wrap");var h=c.wrapper.find(".k-grid-footer"),i=isRtl&&browser.webkit?g:0;if(h.length&&(c.scrollables=c.scrollables.add(h.children(".k-grid-footer-wrap"))),e.virtual)c.content.find(">.k-virtual-scrollable-wrap").bind("scroll"+NS,function(){c.scrollables.scrollLeft(this.scrollLeft+i),c.lockedContent&&(c.lockedContent[0].scrollTop=this.scrollTop)});else{c.content.bind("scroll"+NS,function(){c.scrollables.scrollLeft(this.scrollLeft+i),c.lockedContent&&(c.lockedContent[0].scrollTop=this.scrollTop)});var j=joy.touchScroller(c.content);j&&j.movable&&j.movable.bind("change",function(a){c.scrollables.scrollLeft(-a.sender.x),c.lockedContent&&c.lockedContent.scrollTop(-a.sender.y)})}}},_setContentWidth:function(){var a,b=this,c="k-grid-content-expander",d='<div class="'+c+'"></div>',e=b.resizable;b.options.scrollable&&b.wrapper.is(":visible")&&(a=b.table.parent().children("."+c),b._setContentWidthHandler=proxy(b._setContentWidth,b),b.dataSource&&b.dataSource.view().length?a[0]&&(a.remove(),e&&e.unbind("resize",b._setContentWidthHandler)):(a[0]||(a=$(d).appendTo(b.table.parent()),e&&e.bind("resize",b._setContentWidthHandler)),b.thead&&a.width(b.thead.width())),b._applyLockedContainersWidth())},_applyLockedContainersWidth:function(){if(this.options.scrollable&&this.lockedHeader){var a,b=this.thead.parent(),c=b.parent(),d=this.wrapper[0].clientWidth,e=this._groups(),f=joy.support.scrollbar(),g=this.lockedHeader.find(">table>colgroup>col:not(.k-group-col, .k-hierarchy-col)"),h=b.find(">colgroup>col:not(.k-group-col, .k-hierarchy-col)"),i=columnsWidth(g),j=columnsWidth(h);e>0&&(i+=this.lockedHeader.find(".k-group-cell:first").outerWidth()*e),i>=d&&(i=d-3*f),this.lockedHeader.add(this.lockedContent).width(i),c[0].style.width=c.parent().width()-i-2+"px",b.add(this.table).width(j),this.virtualScrollable&&(d-=f),this.content[0].style.width=d-i-2+"px",this.lockedFooter&&this.lockedFooter.length&&(this.lockedFooter.width(i),a=this.footer.find(".k-grid-footer-wrap"),a[0].style.width=c[0].clientWidth+"px",a.children().first().width(j))}},_setContentHeight:function(){var a=this,b=a.options,c=a.wrapper.innerHeight(),d=a.wrapper.children(".k-grid-header"),e=joy.support.scrollbar();if(b.scrollable&&a.wrapper.is(":visible")){c-=d.outerHeight(),a.pager&&(c-=a.pager.element.outerHeight()),b.groupable&&(c-=a.wrapper.children(".k-grouping-header").outerHeight()),b.toolbarOptions&&(c-=a.wrapper.children(".k-grid-toolbar").outerHeight()),a.footerTemplate&&(c-=a.wrapper.children(".k-grid-footer").outerHeight());var f=function(a){var b,c;return a[0].style.height?!0:(b=a.height(),a.height("auto"),c=a.height(),b!=c?(a.height(""),!0):(a.height(""),!1))};f(a.wrapper)&&(c>2*e?(a.lockedContent&&a.lockedContent.height(c-(a.content[0].offsetHeight-a.content[0].clientHeight>0?e:0)),a.content.height(c)):a.content.height(2*e+1))}else b.scrollable&&a.content.height(c-30)},_averageRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.items().length,a._sum=b,a._measures=1);var c=a.table.outerHeight()/a.items().length;return b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures),b},_dataSource:function(){var a,b=this,c=b.options,d=c.dataSource;if(b.options.rowHeightFit){var e=parseInt(($(window).height()-b.element.offset().top-70)/parseInt(b.options.rowHeightFit)),f=e*parseInt(b.options.rowHeightFit);b.element.parent().css("height",f+60+"px"),0==e&&(e=1),b.options.dataSource.pageSize=e,b.options.pageSize=e}var g,h=b.table,i=h.find("th");if(0!=i.length){g={model:{id:b.options.pkField,idField:b.options.pkField}},g.model.fields={};for(var j=0;j<i.length;j++){var k=i.eq(j),l=k.attr("dataType"),m=k.attr("field");m||(m=k.text().replace(/\s|[^A-z0-9]/g,"")),""!=m&&(g.model.fields[m]={type:l})}d.schema=g,d.pageSize=c.pageSize,d.schema.idField=b.options.pkField,d.schema.id=b.options.pkField,c.dataSource=d}d=isArray(d)?{data:d}:d,isPlainObject(d)&&(extend(d,{table:b.table,fields:b.columns}),a=c.pageOptions,isPlainObject(a)&&a.pageSize!==undefined&&(d.pageSize=a.pageSize)),b.dataSource&&b._refreshHandler?b.dataSource.unbind(CHANGE,b._refreshHandler).unbind(PROGRESS,b._progressHandler).unbind(ERROR,b._errorHandler):(b._refreshHandler=proxy(b.refresh,b),b._progressHandler=proxy(b._requestStart,b),b._errorHandler=proxy(b._error,b)),b.dataSource=DataSource.create(d).bind(CHANGE,b._refreshHandler).bind(PROGRESS,b._progressHandler).bind(ERROR,b._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_modelChange:function(a){var b,c,d,e,f=this,g=a.model,h=f.tbody.find("tr["+joy.attr("uid")+"="+g.uid+"]"),i=h.hasClass("k-alt"),j=f.items().index(h);if(h.children(".k-edit-cell").length&&!f.options.rowTemplate)h.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){b=$(this),c=f.columns[f.cellIndex(b)],c.field===a.field&&(b.hasClass("k-edit-cell")?b.addClass("k-dirty-cell"):(f._displayCell(b,c,g),$('<span class="k-dirty"/>').prependTo(b)))});else if(!h.hasClass("k-grid-edit-row")){if(f.lockedContent&&(d=(i?f.lockedAltRowTemplate:f.lockedRowTemplate)(g),f._relatedRow(h).replaceWith(d)),d=(i?f.altRowTemplate:f.rowTemplate)(g),h.replaceWith(d),d=f.items().eq(j),f.lockedContent){var k=f._relatedRow(d)[0];adjustRowHeight(d[0],k),d=d.add(k)}for(j=0,e=f.columns.length;e>j;j++)c=f.columns[j],c.field===a.field&&(b=d.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(j),$('<span class="k-dirty"/>').prependTo(b));f.trigger("itemChange",{item:d,data:g,ns:ui})}},_pageOptions:function(){var a,b=this,c=b.options.pageOptions;c&&(a=b.wrapper.children("div.k-grid-pager"),a.length||(a=$('<div class="k-pager-wrap k-grid-pager"/>').appendTo(b.wrapper)),b.pager&&b.pager.destroy(),b.pager="object"==typeof c&&c instanceof joy.ui.Pager?c:new joy.ui.Pager(a,extend({},c,{dataSource:b.dataSource})))},_footer:function(){var a,b=this,c=b.dataSource.aggregates(),d="",e=b.footerTemplate,f=b.options,g=b.footer||b.wrapper.find(".k-grid-footer");if(e)if(c=isEmptyObject(c)?buildEmptyAggregatesObject(b.dataSource.aggregate()):c,d=$(b._wrapFooter(e(c))),g.length){var h=d;g.replaceWith(h),g=b.footer=h}else g=b.footer=f.scrollable?f.pageOptions?d.insertBefore(b.wrapper.children("div.k-grid-pager")):d.appendTo(b.wrapper):d.insertBefore(b.tbody);else g&&!b.footer&&(b.footer=g);if(g.length&&(f.scrollable&&(a=g.attr("tabindex",-1).children(".k-grid-footer-wrap"),b.scrollables=b.scrollables.filter(function(){return!$(this).is(".k-grid-footer-wrap")}).add(a)),b._footerWidth&&g.find("table").css("width",b._footerWidth),a)){var i=b.content.scrollLeft(),j=f.scrollable!==!0&&f.scrollable.virtual&&!b.virtualScrollable;j&&(i=b.wrapper.find(".k-virtual-scrollable-wrap").scrollLeft()),a.scrollLeft(i)}b.lockedContent&&(b._appendLockedColumnFooter(),b._applyLockedContainersWidth(),b._syncLockedFooterHeight())},_wrapFooter:function(a){var b=this,c="",d=joy.support.mobileOS?0:joy.support.scrollbar();return b.options.scrollable?(c=$('<div class="k-grid-footer"><div class="k-grid-footer-wrap"><table'+(isIE7?' cellspacing="0"':"")+"><tbody>"+a+"</tbody></table></div></div>"),b._appendCols(c.find("table")),c.css(isRtl?"padding-left":"padding-right",d),c):'<tfoot class="k-grid-footer">'+a+"</tfoot>"},_columnMenu:function(){var a,b,c,d,e,f,g=this,h=g.columns,i=g.options,j=i.showColMenu,k=this._isMobile,l=function(a){g.trigger(COLUMNMENUINIT,{field:a.field,container:a.container})},m=function(a){focusTable(a.closest("table"),!0)};if(j){"boolean"==typeof j&&(j={}),f=g.thead.find("th:not(.k-hierarchy-cell):not(.k-group-cell)");for(var n=0,o=f.length;o>n;n++){b=h[n];var p=f.eq(n);"checkbox"!=b.templateType&&(b.command||!b.field&&!p.attr("data-"+joy.ns+"field")||(a=p.data("joyColumnMenu"),a&&a.destroy(),d=b.sortable!==!1&&j.sortable!==!1?i.sortable:!1,e=i.filterable&&b.filterable!==!1&&j.filterable!==!1?extend({pane:g.pane},b.filterable,i.filterable):!1,c={dataSource:g.dataSource,values:b.values,columns:j.columns,sortable:d,filterable:e,messages:j.messages,owner:g,closeCallback:m,init:l,pane:g.pane,filter:k?":not(.k-column-active)":"",lockedColumns:b.lockable!==!1&&lockedColumns(h).length>0},p.joyColumnMenu(c)))}}},_headerCells:function(){return this.thead.find("th").filter(function(){var a=$(this);return!a.hasClass("k-group-cell")&&!a.hasClass("k-hierarchy-cell")})},_filterable:function(){var a,b,c,d=this,e=d.columns,f=function(a){d.trigger(FILTERMENUINIT,{field:a.field,container:a.container})},g=function(a){focusTable(a.closest("table"),!0)},h=d.options.filterable;if(h&&!d.options.showColMenu){b=d._headerCells();for(var i=0,j=b.length;j>i;i++)if(c=b.eq(i),e[i].filterable!==!1&&!e[i].command&&(e[i].field||c.attr("data-"+joy.ns+"field"))){a=c.data("joyFilterMenu"),a&&a.destroy();var k=e[i].filterable,l=extend({},h,k,{dataSource:d.dataSource,values:e[i].values,closeCallback:g,init:f,pane:d.pane});k&&k.messages&&(l.messages=extend(!0,{},h.messages,k.messages)),c.joyFilterMenu(l)}}},_sortable:function(){var a,b,c,d=this,e=d.columns,f=d.options.sortable;if(f){for(var g=d._headerCells(),h=0,i=g.length;i>h;h++)a=e[h],a.sortable!==!1&&!a.command&&a.field&&(c=g.eq(h),b=c.data("joySorter"),b&&b.destroy(),c.attr("data-"+joy.ns+"field",a.field).joySorter(extend({},f,a.sortable,{dataSource:d.dataSource,aria:!0,filter:":not(.k-column-active)"})));g=null}},_columns:function(columns){var that=this,table=that.table,encoded,lockedCols,dataSource=that.options.dataSource;if(columns=columns.length?columns:map(table.find("th"),function(th,idx){th=$(th);var sortable=th.attr("sortable"),filterable=th.attr("filterable"),dataType=th.attr("dataType"),groupable=th.attr("groupable"),field=th.attr("field"),enumData=th.attr("enumData"),dataTextField=th.attr("dataTextField"),dataValueField=th.attr("dataValueField"),menu=th.attr("menu"),format=th.attr("dataFormat"),width=th.attr("colWidth"),template=th.attr("template"),align=th.attr("align"),title=th.html(),values=th.attr("values"),templateType=th.attr("templateType"),editor=th.attr("editor"),command=th.attr("command"),max=th.attr("max"),min=th.attr("min"),label=th.attr("label");field||(field=th.text().replace(/\s|[^A-z0-9]/g,"")),command||(command=""),editor||(editor=dataType),(null!=template||""!=template)&&(template=$("#"+template).html());var templateButton={};if(null!=label){var tt=label.split(":");title="lg"==tt[0]?lang[tt[1]]:"lgc"==tt[0]?langc[tt[1]]:label}if("button"==templateType){for(var button=th.find("button"),i=0;i<button.length;i++){var btn=button.eq(i),btnlabel=btn.attr("label");if(null!=btnlabel){var tt=btnlabel.split(":");btn.html("lg"==tt[0]?lang[tt[1]]:"lgc"==tt[0]?langc[tt[1]]:btnlabel)}btn.joyButton({imageUrl:btn.attr("imageUrl"),icon:btn.attr("icon"),btnType:"gridBtn"}).data("joyButton");var smcBind=btn.attr("smcBind"),div=$("<div></div>");div.append(btn),null!=smcBind?templateButton[smcBind+"-"+Math.ceil(1e8*Math.random())]=div.html():templateButton[Math.ceil(1e8*Math.random())+"-button"]=div.html()}title=null==label?"<a class='k-link' href='#'>"+joyLang.grid.control+"</a>":"<a class='k-link' href='#'>"+title+"</a>",filterable="false",sortable="false",groupable="false"}else"checkbox"==templateType?(template="<input class='j-checkbox' type='checkbox' value='#:data."+field+"#'/>",filterable="false",sortable="false",groupable="false"):"template"==templateType&&(title=null==label?"<a class='k-link' href='#'>"+joyLang.grid.control+"</a>":"<a class='k-link' href='#'>"+title+"</a>",template=th.html(),filterable="false",groupable="false");if(""==align||null==align)if(null!=dataType)switch(dataType){case"number":align="right";break;case"string":align="left";break;case"date":align="center";break;default:align="left"}else align="left";return(null==dataTextField||""==dataTextField)&&(dataTextField="text"),(null==dataValueField||""==dataValueField)&&(dataValueField="value"),{field:field,type:dataType,sortable:"false"!==sortable,filterable:"false"!==filterable,groupable:"false"!==groupable,menu:menu,template:template,templateType:templateType,templateButton:templateButton,width:width,format:format?"{0:"+format+"}":null,title:title,enumData:enumData,dataTextField:dataTextField,dataValueField:dataValueField,align:align,values:eval("("+values+")"),command:""==command?"":command.split(","),editor:editor,max:max,min:min}}),encoded=!(that.table.find("tbody tr").length>0&&(!dataSource||!dataSource.transport)),that.options.scrollable){if(lockedCols=lockedColumns(columns),columns=nonLockedColumns(columns),lockedCols.length>0&&0===columns.length)throw new Error("There should be at least one non locked columns");columns=lockedCols.concat(columns)}that.columns=map(columns,function(a){return a=typeof a===STRING?{field:a}:a,a.hidden&&(a.attributes=addHiddenStyle(a.attributes),a.footerAttributes=addHiddenStyle(a.footerAttributes),a.headerAttributes=addHiddenStyle(a.headerAttributes)),extend({encoded:encoded},a)})},_groups:function(){var a=this.dataSource.group();return a?a.length:0},_tmpl:function(a,b,c,d){var e,f,g,h,i=this,j=extend({},joy.Template,i.options.templateSettings),k=b.length,l={storage:{},count:0},m=i._hasDetails(),n=[],o=i._groups();if(!a){for(a="<tr",c&&n.push("k-alt"),m&&n.push("k-master-row"),n.length&&(a+=' class="'+n.join(" ")+'"'),k&&(a+=" "+joy.attr("uid")+'="#='+joy.expr("uid",j.paramName)+'#"'),a+=" role='row'>",o>0&&!d&&(a+=groupCells(o)),m&&(a+='<td class="k-hierarchy-cell"><a class="k-icon k-plus" href="\\#" tabindex="-1"></a></td>'),e=0;k>e;e++)g=b[e],f=g.template,h=typeof f,a+="<td align='"+g.align+"' "+stringifyAttributes(g.attributes)+" role='gridcell'>",a+=i._cellTmpl(g,l),a+="</td>";a+="</tr>"}return a=joy.template(a,j),l.count>0?proxy(a,l.storage):a},_headerCellText:function(a){var b=this,c=extend({},joy.Template,b.options.templateSettings),d=a.headerTemplate,e=typeof d,f=a.title||a.field||"";return e===FUNCTION?f=joy.template(d,c)({}):e===STRING&&(f=d),f},_cellTmpl:function(a,b){var c,d,e=this,f=extend({},joy.Template,e.options.templateSettings),g=a.template,h=f.paramName,i=a.field,j="",k=a.format,l=typeof g,m=a.values,n=a.dataTextField,o=a.dataValueField;if("button"==a.templateType){if(g="",null!=e.options.initResult){var p=a.templateButton;for(var q in p)if(null==e.options.initResult[q.substring(0,q.indexOf("-"))])g+=p[q];else if(1==e.options.initResult[q.substring(0,q.indexOf("-"))])g+=p[q];else{var r=$(p[q]);r.attr("class","k-button k-gridBtn k-button-icontext k-state-disabled"),r.attr("disabled","disabled"),r.attr("aria-disabled",!0);var s=$("<div></div>");s.append(r),g+=s.html()}}j+=g}if(a.command){if(isArray(a.command)){for(c=0,d=a.command.length;d>c;c++)j+=e._createButton(a.command[c]);return j.replace(templateHashRegExp,"\\#")}return e._createButton(a.command).replace(templateHashRegExp,"\\#")}return l===FUNCTION?(b.storage["tmpl"+b.count]=g,j+="#=this.tmpl"+b.count+"("+h+")#",b.count++):l===STRING?j+=g:m&&m.length&&isPlainObject(m[0])&&o in m[0]&&i?(j+="#var v ="+joy.stringify(convertToObject(m,n,o))+"#",j+="#var m = (",f.useWithBlock||(j+=h+"."),j+=i+"+'').split(',')#",j+="#var nut = '' #",j+="#for(var i=0;i<m.length;i++){#",j+="#var f = v[m[i]]#",j+="${f != null ? (nut+f) : ''}",j+="#nut=','#",j+="#}#"):(j+=a.encoded?"#:":"#=",k&&(j+='joy.format("'+k.replace(formatRegExp,"\\$1")+'",'),i?"date"==a.type&&k?(i=joy.expr(i,h),j+=i+"==null?'':joy.parseDate("+i+")"):(i=joy.expr(i,h),j+=i+"==null?'':"+i):j+="''",k&&(j+=")"),j+="#"),j},_templates:function(){var a=this,b=a.options,c=a.dataSource,d=c.group(),e=a.footer||a.wrapper.find(".k-grid-footer"),f=c.aggregate(),g=lockedColumns(a.columns),h=b.scrollable?nonLockedColumns(a.columns):a.columns;if(b.scrollable&&g.length){if(b.rowTemplate||b.altRowTemplate)throw new Error("Having both row template and locked columns is not supported");a.rowTemplate=a._tmpl(b.rowTemplate,h,!1,!0),a.altRowTemplate=a._tmpl(b.altRowTemplate||b.rowTemplate,h,!0,!0),a.lockedRowTemplate=a._tmpl(b.rowTemplate,g),a.lockedAltRowTemplate=a._tmpl(b.altRowTemplate||b.rowTemplate,g,!0)}else a.rowTemplate=a._tmpl(b.rowTemplate,h),a.altRowTemplate=a._tmpl(b.altRowTemplate||b.rowTemplate,h,!0);a._hasDetails()&&(a.detailTemplate=a._detailTmpl(b.detailTemplate||"")),(a._group&&!isEmptyObject(f)||!isEmptyObject(f)&&!e.length||grep(a.columns,function(a){return a.footerTemplate}).length)&&(a.footerTemplate=a._footerTmpl(a.columns,f,"footerTemplate","k-footer-template")),d&&grep(a.columns,function(a){return a.groupFooterTemplate}).length&&(f=$.map(d,function(a){return a.aggregates}),a.groupFooterTemplate=a._footerTmpl(h,f,"groupFooterTemplate","k-group-footer",g.length),b.scrollable&&g.length&&(a.lockedGroupFooterTemplate=a._footerTmpl(g,f,"groupFooterTemplate","k-group-footer")))},_footerTmpl:function(a,b,c,d,e){var f,g,h,i,j,k=this,l=extend({},joy.Template,k.options.templateSettings),m=l.paramName,n="",o={},p=0,q={},r=k._groups(),s=buildEmptyAggregatesObject(b);for(n+='<tr class="'+d+'">',r>0&&!e&&(n+=groupCells(r)),k._hasDetails()&&(n+='<td class="k-hierarchy-cell">&nbsp;</td>'),f=0,g=a.length;g>f;f++)j=a[f],h=j[c],i=typeof h,n+="<td"+stringifyAttributes(j.footerAttributes)+">",h?(i!==FUNCTION&&(q=s[j.field]?extend({},l,{paramName:m+"."+j.field}):{},h=joy.template(h,q)),o["tmpl"+p]=h,n+="#=this.tmpl"+p+"("+m+")#",p++):n+="&nbsp;",n+="</td>";return n+="</tr>",n=joy.template(n,l),p>0?proxy(n,o):n},_detailTmpl:function(a){var b=this,c="",d=extend({},joy.Template,b.options.templateSettings),e=d.paramName,f={},g=0,h=b._groups(),i=visibleColumns(b.columns).length,j=typeof a;return c+='<tr class="k-detail-row">',h>0&&(c+=groupCells(h)),c+='<td class="k-hierarchy-cell"></td><td class="k-detail-cell"'+(i?' colspan="'+i+'"':"")+">",j===FUNCTION?(f["tmpl"+g]=a,c+="#=this.tmpl"+g+"("+e+")#",g++):c+=a,c+="</td></tr>",c=joy.template(c,d),g>0?proxy(c,f):c},_hasDetails:function(){var a=this;return null!==a.options.detailTemplate||(a._events[DETAILINIT]||[]).length},_details:function(){var a=this;if(a.options.scrollable&&a._hasDetails()&&lockedColumns(a.columns).length)throw new Error("Having both detail template and locked columns is not supported");a.table.on(CLICK+NS,".k-hierarchy-cell .k-plus, .k-hierarchy-cell .k-minus",function(b){var c,d,e=$(this),f=e.hasClass("k-plus"),g=e.closest("tr.k-master-row"),h=a.detailTemplate,i=a._hasDetails();return e.toggleClass("k-plus",!f).toggleClass("k-minus",f),i&&!g.next().hasClass("k-detail-row")&&(d=a.dataItem(g),$(h(d)).addClass(g.hasClass("k-alt")?"k-alt":"").insertAfter(g),a.trigger(DETAILINIT,{masterRow:g,detailRow:g.next(),data:d,detailCell:g.next().find(".k-detail-cell")})),c=g.next(),a.trigger(f?DETAILEXPAND:DETAILCOLLAPSE,{masterRow:g,detailRow:c}),c.toggle(f),a._current&&a._current.attr("aria-expanded",f),b.preventDefault(),!1})},dataItem:function(a){if(a=$(a)[0],!a)return null;var b,c,d=this.tbody.children(),e=/k-grouping-row|k-detail-row|k-group-footer/,f=a.sectionRowIndex;for(c=f,b=0;f>b;b++)e.test(d[b].className)&&c--;return this._data[c]},expandRow:function(a){$(a).find("> td .k-plus, > td .k-i-expand").click()},collapseRow:function(a){$(a).find("> td .k-minus, > td .k-i-collapse").click()},_createHeaderCells:function(a){var b,c,d,e,f=this,g="";for(b=0,e=a.length;e>b;b++)c=a[b],d=f._headerCellText(c),"checkbox"==c.templateType?g+="<th ><input type='checkbox' /></th>":c.command?g+="<th"+stringifyAttributes(c.headerAttributes)+">"+d+"</th>":(g+="<th role='columnheader' "+joy.attr("field")+"='"+(c.field||"")+"' ",c.title&&(g+=joy.attr("title")+'="'+c.title.replace(/'/g,"'")+'" '),c.groupable!==undefined&&(g+=joy.attr("groupable")+"='"+c.groupable+"' "),c.aggregates&&(g+=joy.attr("aggregates")+"='"+c.aggregates+"'"),
g+=stringifyAttributes(c.headerAttributes),g+=">"+d+"</th>");return g},_appendLockedColumnContent:function(){var a,b,c,d=this.columns,e=this.table.find("col:not(.k-group-col,.k-hierarchy-col)"),f=$();for(a=0,b=d.length;b>a;a++)d[a].locked&&!d[a].hidden&&(f=f.add(e.eq(a)));c=$('<div class="k-grid-content-locked"><table'+(isIE7?' cellspacing="0"':"")+"><colgroup/><tbody></tbody></table></div>"),e=c.find("colgroup"),e.append(f),this.lockedContent=c.insertBefore(this.content),this.lockedTable=c.children("table")},_appendLockedColumnFooter:function(){var a,b,c=this,d=c.footer,e=d.find(".k-footer-template>td"),f=d.find(".k-grid-footer-wrap>table>colgroup>col"),g=$('<div class="k-grid-footer-locked"><table><colgroup /><tbody><tr class="k-footer-template"></tr></tbody></table></div>'),h=c._groups(),i=$(),j=$();for(i=i.add(e.filter(".k-group-cell")),a=0,b=lockedColumns(c.columns).length;b>a;a++)i=i.add(e.eq(a+h));for(j=j.add(f.filter(".k-group-col")),a=0,b=visibleLockedColumns(c.columns).length;b>a;a++)j=j.add(f.eq(a+h));i.appendTo(g.find("tr")),j.appendTo(g.find("colgroup")),c.lockedFooter=g.prependTo(d)},_appendLockedColumnHeader:function(a){var b,c,d,e,f,g,h,i=this,j=this.columns,k=0,l=$(),m=$();for(e=i.thead.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),h=i.thead.find(".k-header:not(.k-group-cell,.k-hierarchy-cell)"),b=0,d=j.length;d>b;b++)j[b].locked&&(j[b].hidden||(l=l.add(e.eq(b-k))),m=m.add(h.eq(b))),j[b].hidden&&k++;m.length&&(c='<div class="k-grid-header-locked" style="width:1px"><table'+(isIE7?' cellspacing="0"':"")+"><colgroup/><thead><tr></tr></thead></table></div>",g=$(c),e=g.find("colgroup"),f=g.find("thead tr"),e.append(l),f.append(m),this.lockedHeader=g.prependTo(a),this._syncLockedHeaderHeight())},_removeLockedContainers:function(){var a=this.lockedHeader.add(this.lockedContent).add(this.lockedFooter);a.off(NS).remove(),this.lockedHeader=this.lockedContent=this.lockedFooter=null},_thead:function(){var a,b=this,c=b.columns,d=b._hasDetails()&&c.length,e="",f=b.table.find(">thead");f.length||(f=$("<thead/>").insertBefore(b.tbody)),b.lockedHeader&&b.thead?(a=b.thead.find("tr:has(th):first").html(""),b._removeLockedContainers()):a=b.element.find("tr:has(th):first"),a.length||(a=f.children().first(),a.length||(a=$("<tr/>"))),a.children().length?d&&!a.find(".k-hierarchy-cell")[0]&&a.prepend('<th class="k-hierarchy-cell">&nbsp;</th>'):(d&&(e+='<th class="k-hierarchy-cell">&nbsp;</th>'),e+=b._createHeaderCells(b.columns),a.html(e),a.find(":checkbox").click(function(){var a=$(this).is(":checked");b.element.find(".j-checkbox").each(function(){$(this).prop("checked",a)})})),a.attr("role","row").find("th").addClass("k-header"),b.options.scrollable||f.addClass("k-grid-header"),a.find("script").remove().end().appendTo(f),b.thead&&b._destroyColumnAttachments(),b.thead=f.attr("role","rowgroup"),b._sortable(),b._filterable(),b._scrollable(),b._updateCols(),b._columnMenu(),this.options.scrollable&&lockedColumns(this.columns).length&&(b._appendLockedColumnHeader(b.thead.closest(".k-grid-header")),b._appendLockedColumnContent(),b._applyLockedContainersWidth()),b._resizable(),b._draggable(),b._reorderable(),b.groupable&&b._attachGroupable()},_isLocked:function(){return null!=this.lockedHeader},_updateCols:function(a){a=a||this.thead.parent().add(this.table),this._appendCols(a,this._isLocked())},_updateLockedCols:function(a){this._isLocked()&&(a=a||this.lockedHeader.find("table").add(this.lockedTable),normalizeCols(a,visibleLockedColumns(this.columns),this._hasDetails(),this._groups()))},_appendCols:function(a,b){b?normalizeCols(a,visibleNonLockedColumns(this.columns),this._hasDetails(),0):normalizeCols(a,visibleColumns(this.columns),this._hasDetails(),this._groups())},_autoColumns:function(a){if(a&&a.toJSON){var b,c=this;a=a.toJSON();for(b in a)c.columns.push({field:b});c._thead(),c._templates()}},_rowsHtml:function(a,b){var c,d,e=this,f="",g=b.rowTemplate,h=b.altRowTemplate;for(c=0,d=a.length;d>c;c++)f+=c%2?h(a[c]):g(a[c]),e._data.push(a[c]);return f},_groupRowHtml:function(a,b,c,d,e,f){var g,h,i=this,j="",k=a.field,l=grep(i.columns,function(a){return a.field==k})[0]||{},m=l.groupHeaderTemplate,n=(l.title||k)+": "+formatGroupValue(a.value,l.format,l.values,l.dataTextField,l.dataValueField),o=extend({},{field:a.field,value:a.value},a.aggregates[a.field]),p=i._groupAggregatesDefaultObject||{},q=(e.rowTemplate,e.altRowTemplate,e.groupFooterTemplate),r=a.items;if(m&&(n=typeof m===FUNCTION?m(o):joy.template(m)(o)),j+=d(b,c,n),a.hasSubgroups)for(g=0,h=r.length;h>g;g++)j+=i._groupRowHtml(r[g],f?b:b-1,c+1,d,e,f);else j+=i._rowsHtml(r,e);return q&&(j+=q(extend(p,a.aggregates))),j},collapseGroup:function(a){a=$(a);var b,c,d,e,f,g=1,h=$();for(this._isLocked()&&(a.closest("div").hasClass("k-grid-content-locked")?h=this.tbody.children("tr:eq("+a.index()+")").nextAll("tr"):(h=a.nextAll("tr"),a=this.lockedTable.find(">tbody>tr:eq("+a.index()+")"))),b=a.find(".k-group-cell").length,a.find(".k-icon").addClass("k-i-expand").removeClass("k-i-collapse"),a.find("td:first").attr("aria-expanded",!1),a=a.nextAll("tr"),d=0,e=a.length;e>d&&(f=a.eq(d),c=f.find(".k-group-cell").length,f.hasClass("k-grouping-row")?g++:f.hasClass("k-group-footer")&&g--,!(b>=c||f.hasClass("k-group-footer")&&0>g));d++)f.hide(),h.eq(d).hide()},expandGroup:function(a){a=$(a);var b,c,d,e,f,g=this,h=$(),i=1;for(this._isLocked()&&(a.closest("div").hasClass("k-grid-content-locked")?h=this.tbody.children("tr:eq("+a.index()+")").nextAll("tr"):(h=a.nextAll("tr"),a=this.lockedTable.find(">tbody>tr:eq("+a.index()+")"))),b=a.find(".k-group-cell").length,a.find(".k-icon").addClass("k-i-collapse").removeClass("k-i-expand"),a.find("td:first").attr("aria-expanded",!0),a=a.nextAll("tr"),e=0,f=a.length;f>e&&(c=a.eq(e),d=c.find(".k-group-cell").length,!(b>=d));e++)d!=b+1||c.hasClass("k-detail-row")||(c.show(),h.eq(e).show(),c.hasClass("k-grouping-row")&&c.find(".k-icon").hasClass("k-i-collapse")&&g.expandGroup(c),c.hasClass("k-master-row")&&c.find(".k-icon").hasClass("k-minus")&&(c.next().show(),h.eq(e+1).show())),c.hasClass("k-grouping-row")&&i++,c.hasClass("k-group-footer")&&(1==i?(c.show(),h.eq(e).show()):i--)},_updateHeader:function(a){var b=this,c=b._isLocked()?b.lockedHeader:b.thead,d=c.find("th.k-group-cell"),e=d.length;a>e?$(new Array(a-e+1).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(c.find("tr")):e>a&&(e-=a,$(grep(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){return a&&b&&(a=a.hasSubgroups?this._firstDataItem(a.items[0],b):a.items[0]),a},_updateTablesWidth:function(){var a,b=this;b._isLocked()&&(a=$(">.k-grid-footer>.k-grid-footer-wrap>table",b.wrapper).add(b.thead.parent()).add(b.table),b._footerWidth=tableWidth(a.eq(0)),a.width(b._footerWidth),a=$(">.k-grid-footer>.k-grid-footer-locked>table",b.wrapper).add(b.lockedHeader.find(">table")).add(b.lockedTable),a.width(tableWidth(a.eq(0))))},hideColumn:function(a){var b,c,d,e,f,g,h=this,i=0,j=h.footer||h.wrapper.find(".k-grid-footer"),k=h.columns,l=visibleLockedColumns(k).length;if(a="number"==typeof a?k[a]:grep(k,function(b){return b.field===a})[0],a&&!a.hidden){if(g=inArray(a,visibleColumns(k)),a.hidden=!0,a.attributes=addHiddenStyle(a.attributes),a.footerAttributes=addHiddenStyle(a.footerAttributes),a.headerAttributes=addHiddenStyle(a.headerAttributes),h._templates(),h._updateCols(),h._updateLockedCols(),setCellVisibility(elements($(">table>thead",h.lockedHeader),h.thead,">tr>th"),g,!1),j[0]&&(h._updateCols(j.find(">.k-grid-footer-wrap>table")),h._updateLockedCols(j.find(">.k-grid-footer-locked>table")),setCellVisibility(j.find(".k-footer-template>td"),g,!1)),h.lockedTable&&l>g?hideColumnCells(h.lockedTable.find(">tbody>tr"),g):hideColumnCells(h.tbody.children(),g-l),h.lockedTable)h._updateTablesWidth(),h._applyLockedContainersWidth(),h._syncLockedContentHeight(),h._syncLockedHeaderHeight(),h._syncLockedFooterHeight();else{for(d=h.thead.prev().find("col"),c=0,f=d.length;f>c;c+=1){if(e=d[c].style.width,!e||-1!=e.indexOf("%")){i=0;break}i+=parseInt(e,10)}b=$(">.k-grid-header table:first,>.k-grid-footer table:first",h.wrapper).add(h.table),h._footerWidth=null,i&&(b.width(i),h._footerWidth=i),browser.msie&&8==browser.version&&(b.css("display","inline-table"),setTimeout(function(){b.css("display","table")},1))}h.trigger(COLUMNHIDE,{column:a})}},showColumn:function(a){var b,c,d,e,f,g,h,i=this,j=i.columns,k=i.footer||i.wrapper.find(".k-grid-footer"),l=lockedColumns(j).length;if(a="number"==typeof a?j[a]:grep(j,function(b){return b.field===a})[0],a&&a.hidden){if(h=inArray(a,j),a.hidden=!1,a.attributes=removeHiddenStyle(a.attributes),a.footerAttributes=removeHiddenStyle(a.footerAttributes),a.headerAttributes=removeHiddenStyle(a.headerAttributes),i._templates(),i._updateCols(),i._updateLockedCols(),setCellVisibility(elements($(">table>thead",i.lockedHeader),i.thead,">tr>th"),h,!0),k[0]&&(i._updateCols(k.find(">.k-grid-footer-wrap>table")),i._updateLockedCols(k.find(">.k-grid-footer-locked>table")),setCellVisibility(k.find(".k-footer-template>td"),h,!0)),i.lockedTable&&l>h?showColumnCells(i.lockedTable.find(">tbody>tr"),h):showColumnCells(i.tbody.children(),h-l),i.lockedTable)i._updateTablesWidth(),i._applyLockedContainersWidth(),i._syncLockedContentHeight(),i._syncLockedHeaderHeight();else if(d=$(">.k-grid-header table:first,>.k-grid-footer table:first",i.wrapper).add(i.table),a.width){for(e=0,g=i.thead.prev().find("col"),b=0,c=g.length;c>b;b+=1){if(f=g[b].style.width,f.indexOf("%")>-1){e=0;break}e+=parseInt(f,10)}i._footerWidth=null,e&&(d.width(e),i._footerWidth=e)}else d.width("");i.trigger(COLUMNSHOW,{column:a})}},_progress:function(a){var b=this.element;this.lockedContent?b=this.wrapper:this.element.is("table")?b=this.element.parent():this.content&&this.content.length&&(b=this.content),joy.ui.progress(b,a)},_resize:function(){this.content&&(this._setContentHeight(),this._setContentWidth())},_isActiveInTable:function(){var a=activeElement();return this.table[0]===a||$.contains(this.table[0],a)||this._isLocked()&&(this.lockedTable[0]===a||$.contains(this.lockedTable[0],a))},refresh:function(a){var b,c=this,d=c.dataSource.view(),e=c.options.navigatable,f=$(c.current()),g=!1,h=(c.dataSource.group()||[]).length,i=h+visibleColumns(c.columns).length;a&&"itemchange"===a.action&&c.editable||(a=a||{},c.trigger("dataBinding",{action:a.action||"rebind",index:a.index,items:a.items})||(e&&(c._isActiveInTable()||c._editContainer&&c._editContainer.data("joyWindow"))&&(g=f.is("th"),b=0,g&&(b=c.thead.find("th:not(.k-group-cell)").index(f))),c._destroyEditable(),c._progress(!1),c._hideResizeHandle(),c._data=[],c.columns.length||(c._autoColumns(c._firstDataItem(d[0],h)),i=h+c.columns.length),c._group=h>0||c._group,c._group&&(c._templates(),c._updateCols(),c._updateLockedCols(),c._updateHeader(h),c._group=h>0),c._renderContent(d,i,h),c._renderLockedContent(d,i,h),c._footer(),c._setContentHeight(),c._setContentWidth(),b>=0&&(c._removeCurrent(),c.current(g?c.thead.find("th:not(.k-group-cell)").eq(b):c.table.add(c.lockedTable).find(FIRSTNAVITEM).first()),c._current&&focusTable(c._current.closest("table")[0],!0)),c.trigger(DATABOUND)))},_renderContent:function(a,b,c){var d,e,f=this,g="",h=null!=f.lockedContent,i={rowTemplate:f.rowTemplate,altRowTemplate:f.altRowTemplate,groupFooterTemplate:f.groupFooterTemplate};if(b=h?b-visibleLockedColumns(f.columns).length:b,c>0)for(b=h?b-c:b,f.detailTemplate&&b++,f.groupFooterTemplate&&(f._groupAggregatesDefaultObject=buildEmptyAggregatesObject(f.dataSource.aggregate())),d=0,e=a.length;e>d;d++)g+=f._groupRowHtml(a[d],b,0,h?groupRowLockedContentBuilder:groupRowBuilder,i,h);else g+=f._rowsHtml(a,i);f.tbody=appendContent(f.tbody,f.table,g)},_renderLockedContent:function(a,b,c){var d,e,f="",g={rowTemplate:this.lockedRowTemplate,altRowTemplate:this.lockedAltRowTemplate,groupFooterTemplate:this.lockedGroupFooterTemplate};if(this.lockedContent){var h=this.lockedTable;if(c>0)for(b-=visibleNonLockedColumns(this.columns).length,d=0,e=a.length;e>d;d++)f+=this._groupRowHtml(a[d],b,0,groupRowBuilder,g);else f=this._rowsHtml(a,g);appendContent(h.children("tbody"),h,f),this._syncLockedContentHeight()}},_adjustRowsHeight:function(a,b){var c,d=a[0].rows,e=d.length,f=b[0].rows,g=a.add(b),h=[];for(c=0;e>c;c++){d[c].style.height&&(d[c].style.height=f[c].style.height="");var i=d[c].clientHeight,j=f[c].clientHeight,k=0;i>j?k=i:j>i&&(k=j),h.push(k)}for(c=0,e=g.length;e>c;c++)g[c].style.display="none";for(c=0;e>c;c++)h[c]&&(d[c].style.height=f[c].style.height=h[c]+"px");for(c=0,e=g.length;e>c;c++)g[c].style.display=""}}),Sorter=Widget.extend({init:function(a,b){var c,d=this;Widget.fn.init.call(d,a,b),d._refreshHandler=proxy(d.refresh,d),d.dataSource=d.options.dataSource.bind("change",d._refreshHandler),c=d.element.find(TLINK),c[0]||(c=d.element.wrapInner('<a class="k-link" href="#"/>').find(TLINK)),d.link=c,d.element.on("click"+sorterNS,proxy(d._click,d))},options:{name:"Sorter",mode:SINGLE,allowUnsort:!0,compare:null,filter:""},destroy:function(){var a=this;Widget.fn.destroy.call(a),a.element.off(sorterNS),a.dataSource.unbind("change",a._refreshHandler),a._refreshHandler=a.element=a.link=a.dataSource=null},refresh:function(){var a,b,c,d,e=this,f=e.dataSource.sort()||[],g=e.element,h=g.attr(joy.attr(FIELD));for(g.removeAttr(joy.attr(DIR)),g.removeAttr(ARIASORT),a=0,b=f.length;b>a;a++)c=f[a],h==c.field&&g.attr(joy.attr(DIR),c.dir);d=g.attr(joy.attr(DIR)),g.find(".k-i-arrow-n,.k-i-arrow-s").remove(),d===ASC?($('<span class="k-icon k-i-arrow-n" />').appendTo(e.link),g.attr(ARIASORT,"ascending")):d===DESC&&($('<span class="k-icon k-i-arrow-s" />').appendTo(e.link),g.attr(ARIASORT,"descending"))},_click:function(a){var b,c,d=this,e=d.element,f=e.attr(joy.attr(FIELD)),g=e.attr(joy.attr(DIR)),h=d.options,i=null==d.options.compare?undefined:d.options.compare,j=d.dataSource.sort()||[];if(a.preventDefault(),!h.filter||e.is(h.filter)){if(g=g===ASC?DESC:g===DESC&&h.allowUnsort?undefined:ASC,h.mode===SINGLE)j=[{field:f,dir:g,compare:i}];else if("multiple"===h.mode){for(b=0,c=j.length;c>b;b++)if(j[b].field===f){j.splice(b,1);break}j.push({field:f,dir:g,compare:i})}d.dataSource.sort(j)}}});ui.plugin(Grid),ui.plugin(VirtualScrollable),ui.plugin(Sorter)}(jQuery),function(a,b){var c=window.joy,d="change",e="cancel",f="dataBound",g="dataBinding",h=c.ui.Widget,i=c.keys,j=">*",k="progress",l="error",m="k-state-focused",n="k-state-selected",o="k-edit-item",p="string",q="edit",r="remove",s="save",t="click",u=".joyListView",v=a.proxy,w=c._activeElement,x=c.ui.progress,y=c.data.DataSource,z=h.extend({init:function(b,d){var e=this;d=a.isArray(d)?{dataSource:d}:d,h.fn.init.call(e,b,d),d=e.options,e.wrapper=b=e.element,b[0].id&&(e._itemId=b[0].id+"_lv_active"),e._element(),e._dataSource(),e._templates(),e._navigatable(),e._selectable(),e._pageable(),e._crudHandlers(),e.options.autoBind&&e.dataSource.fetch(),c.notify(e)},events:[d,e,g,f,q,r,s],options:{name:"ListView",autoBind:!0,selectable:!1,navigatable:!1,template:"",altTemplate:"",editTemplate:""},setOptions:function(a){h.fn.setOptions.call(this,a),this._templates()},_templates:function(){var a=this.options;this.template=c.template(a.template||""),this.altTemplate=c.template(a.altTemplate||a.template),this.editTemplate=c.template(a.editTemplate||"")},_item:function(a){return this.element.children()[a]()},items:function(){return this.element.children()},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),this.options.autoBind&&a.fetch()},_unbindDataSource:function(){var a=this;a.dataSource.unbind(d,a._refreshHandler).unbind(k,a._progressHandler).unbind(l,a._errorHandler)},_dataSource:function(){var a=this;a.dataSource&&a._refreshHandler?a._unbindDataSource():(a._refreshHandler=v(a.refresh,a),a._progressHandler=v(a._progress,a),a._errorHandler=v(a._error,a)),a.dataSource=y.create(a.options.dataSource).bind(d,a._refreshHandler).bind(k,a._progressHandler).bind(l,a._errorHandler)},_progress:function(){x(this.element,!0)},_error:function(){x(this.element,!1)},_element:function(){this.element.addClass("k-widget k-listview").attr("role","listbox")},refresh:function(a){var b,d,e,h,i,j=this,k=j.dataSource.view(),l="",m=j.template,n=j.altTemplate,o=w();if(a=a||{},"itemchange"===a.action)return void(j._hasBindingTarget()||j.editable||(b=a.items[0],e=j.items().filter("["+c.attr("uid")+"="+b.uid+"]"),e.length>0&&(h=e.index(),e.replaceWith(m(b)),e=j.items().eq(h),e.attr(c.attr("uid"),b.uid),j.trigger("itemChange",{item:e,data:b}))));if(!j.trigger(g,{action:a.action||"rebind",items:a.items,index:a.index})){for(j._destroyEditable(),h=0,i=k.length;i>h;h++)l+=h%2?n(k[h]):m(k[h]);for(j.element.html(l),d=j.items(),h=0,i=k.length;i>h;h++)d.eq(h).attr(c.attr("uid"),k[h].uid).attr("role","option").attr("aria-selected","false");j.element[0]===o&&j.options.navigatable&&j.current(d.eq(0)),j.trigger(f)}},_pageable:function(){var b,d,e=this,f=e.options.pageable;a.isPlainObject(f)&&(d=f.pagerId,b=a.extend({},f,{dataSource:e.dataSource,pagerId:null}),e.pager=new c.ui.Pager(a("#"+d),b))},_selectable:function(){var a,b,e=this,f=e.options.selectable,g=e.options.navigatable;f&&(a=typeof f===p&&f.toLowerCase().indexOf("multiple")>-1,a&&e.element.attr("aria-multiselectable",!0),e.selectable=new c.ui.Selectable(e.element,{aria:!0,multiple:a,filter:j,change:function(){e.trigger(d)}}),g&&e.element.on("keydown"+u,function(c){if(c.keyCode===i.SPACEBAR){if(b=e.current(),c.target==c.currentTarget&&c.preventDefault(),a)if(c.ctrlKey){if(b&&b.hasClass(n))return void b.removeClass(n)}else e.selectable.clear();else e.selectable.clear();e.selectable.value(b)}}))},current:function(a){var c=this,d=c.element,e=c._current,f=c._itemId;return a===b?e:(e&&e[0]&&(e[0].id===f&&e.removeAttr("id"),e.removeClass(m),d.removeAttr("aria-activedescendant")),a&&a[0]&&(f=a[0].id||f,c._scrollTo(a[0]),d.attr("aria-activedescendant",f),a.addClass(m).attr("id",f)),void(c._current=a))},_scrollTo:function(b){var c,d=this,e=!1,f="scroll";"auto"==d.wrapper.css("overflow")||d.wrapper.css("overflow")==f?c=d.wrapper[0]:(c=window,e=!0);var g=function(d,g){var h=e?a(b).offset()[d.toLowerCase()]:b["offset"+d],i=b["client"+g],j=a(c)[f+d](),k=a(c)[g.toLowerCase()]();h+i>j+k?a(c)[f+d](h+i-k):j>h&&a(c)[f+d](h)};g("Top","Height"),g("Left","Width")},_navigatable:function(){var b=this,d=b.options.navigatable,e=b.element,f=function(c){b.current(a(c.currentTarget)),a(c.target).is(":button,a,:input,a>.k-icon,textarea")||e.focus()};d&&(b._tabindex(),e.on("focus"+u,function(){var a=b._current;a&&a.is(":visible")||(a=b._item("first")),b.current(a)}).on("focusout"+u,function(){b._current&&b._current.removeClass(m)}).on("keydown"+u,function(d){var f,g=d.keyCode,h=b.current(),j=a(d.target),k=!j.is(":button,textarea,a,a>.t-icon,input"),l=j.is(":text"),m=c.preventDefault,n=e.find("."+o),p=w();if(!(!k&&!l&&i.ESC!=g||l&&i.ESC!=g&&i.ENTER!=g))if(i.UP===g||i.LEFT===g)h&&(h=h.prev()),b.current(h&&h[0]?h:b._item("last")),m(d);else if(i.DOWN===g||i.RIGHT===g)h&&(h=h.next()),b.current(h&&h[0]?h:b._item("first")),m(d);else if(i.PAGEUP===g)b.current(null),b.dataSource.page(b.dataSource.page()-1),m(d);else if(i.PAGEDOWN===g)b.current(null),b.dataSource.page(b.dataSource.page()+1),m(d);else if(i.HOME===g)b.current(b._item("first")),m(d);else if(i.END===g)b.current(b._item("last")),m(d);else if(i.ENTER===g)if(0!==n.length&&(k||l)){f=b.items().index(n),p&&p.blur(),b.save();var q=function(){b.element.trigger("focus"),b.current(b.items().eq(f))};b.one("dataBound",q)}else""!==b.options.editTemplate&&b.edit(h);else if(i.ESC===g){if(n=e.find("."+o),0===n.length)return;f=b.items().index(n),b.cancel(),b.element.trigger("focus"),b.current(b.items().eq(f))}}),e.on("mousedown"+u+" touchstart"+u,j,v(f,b)))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(d)},select:function(b){var c=this,d=c.selectable;return b=a(b),b.length?(d.options.multiple||(d.clear(),b=b.first()),void d.value(b)):d.value()},_destroyEditable:function(){var a=this;a.editable&&(a.editable.destroy(),delete a.editable)},_modelFromElement:function(a){var b=a.attr(c.attr("uid"));return this.dataSource.getByUid(b)},_closeEditable:function(a){var b,d,e=this,f=e.editable,g=e.template,h=!0;return f&&(a&&(h=f.end()),h&&(f.element.index()%2&&(g=e.altTemplate),b=e._modelFromElement(f.element),e._destroyEditable(),d=f.element.index(),f.element.replaceWith(g(b)),e.items().eq(d).attr(c.attr("uid"),b.uid))),h},edit:function(a){var b,d,e=this,f=e._modelFromElement(a),g=f.uid;e.cancel(),a=e.items().filter("["+c.attr("uid")+"="+g+"]"),d=a.index(),a.replaceWith(e.editTemplate(f)),b=e.items().eq(d).addClass(o).attr(c.attr("uid"),f.uid),e.editable=b.joyEditable({model:f,clearContainer:!1,errorTemplate:!1}).data("joyEditable"),e.trigger(q,{model:f,item:b})},save:function(){var a,b=this,c=b.editable;c&&(c=c.element,a=b._modelFromElement(c),!b.trigger(s,{model:a,item:c})&&b._closeEditable(!0)&&b.dataSource.sync())},remove:function(a){var b=this,c=b.dataSource,d=b._modelFromElement(a);b.trigger(r,{model:d,item:a})||(a.hide(),c.remove(d),c.sync())},add:function(){var a=this,b=a.dataSource,c=b.indexOf((b.view()||[])[0]);0>c&&(c=0),a.cancel(),b.insert(c,{}),a.edit(a.element.children().first())},cancel:function(){var a=this,b=a.dataSource;if(a.editable){var c=a.editable.element,d=a._modelFromElement(c);a.trigger(e,{model:d,container:c})||(b.cancelChanges(d),a._closeEditable(!1))}},_crudHandlers:function(){var b=this,d=t+u;b.element.on(d,".k-edit-button",function(d){var e=a(this).closest("["+c.attr("uid")+"]");b.edit(e),d.preventDefault()}),b.element.on(d,".k-delete-button",function(d){var e=a(this).closest("["+c.attr("uid")+"]");b.remove(e),d.preventDefault()}),b.element.on(d,".k-update-button",function(a){b.save(),a.preventDefault()}),b.element.on(d,".k-cancel-button",function(a){b.cancel(),a.preventDefault()})},destroy:function(){var a=this;h.fn.destroy.call(a),a._unbindDataSource(),a._destroyEditable(),a.element.off(u),a.pager&&a.pager.destroy(),a.selectable&&a.selectable.destroy(),c.destroy(a.element)}});c.ui.plugin(z)}(window.joy.jQuery),function(a,b){function c(a){return function(b){var c=b.children(".k-animation-container");return c.length||(c=b),c.children(a)}}function d(a){return o.template(a,{useWithBlock:!1})}function e(a){return a.children("div").find(".k-checkbox:first :checkbox")}function f(a){return function(b,c){c=c.closest(S);var d,e=c.parent();return e.parent().is("li")&&(d=e.parent()),this._dataSourceMove(b,e,d,function(b,d){return this.trigger(C),this._insert(b.data(),d,c.index()+a)})}}function g(b,c){for(var d;b&&"ul"!=b.nodeName.toLowerCase();)d=b,b=b.nextSibling,3==d.nodeType&&(d.nodeValue=a.trim(d.nodeValue)),n.test(d.className)?c.insertBefore(d,c.firstChild):c.appendChild(d)}function h(b){var c=b.children("div"),d=b.children("ul"),e=c.children(".k-icon"),f=b.children(":checkbox"),h=c.children(".k-in");b.hasClass("k-treeview")||(c.length||(c=a("<div />").prependTo(b)),!e.length&&d.length?e=a("<span class='k-icon' />").prependTo(c):d.length&&d.children().length||(e.remove(),d.remove()),f.length&&a("<span class='k-checkbox' />").appendTo(c).append(f),h.length||(h=b.children("a").eq(0).addClass("k-in"),h.length||(h=a("<span class='k-in' />")),h.appendTo(c),c.length&&g(c[0].nextSibling,h[0])))}function i(a){var b=this;b.treeview=a,b.hovered=a.element,b._draggable=new p.Draggable(a.element,{filter:"div:not(.k-state-disabled) .k-in",hint:function(b){return a.templates.dragClue({item:a.dataItem(b),treeview:a.options})},cursorOffset:{left:10,top:o.support.touch||o.support.msPointers||o.support.pointers?-40/o.support.zoomLevel():10},dragstart:w(b.dragstart,b),dragcancel:w(b.dragcancel,b),drag:w(b.drag,b),dragend:w(b.dragend,b)})}var j,k,l,m,n,o=window.joy,p=o.ui,q=o.data,r=a.extend,s=o.template,t=a.isArray,u=p.Widget,v=q.HierarchicalDataSource,w=a.proxy,x=o.keys,y=".joyTreeView",z="select",A="navigate",B="expand",C="change",D="error",E="checked",F="indeterminate",G="collapse",H="dragstart",I="drag",J="drop",K="dragend",L="dataBound",M="click",N="visibility",O="undefined",P="k-state-hover",Q="k-treeview",R=":visible",S=".k-item",T="string",U="aria-selected",V="aria-disabled",W={text:"dataTextField",url:"dataUrlField",spriteCssClass:"dataSpriteCssClassField",imageUrl:"dataImageUrlField"},X=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&typeof a.nodeName===T};k=c(".k-group"),l=c(".k-group,.k-content"),m=function(a){return a.children("div").children(".k-icon")},n=/k-sprite/,j=u.extend({init:function(a,b){var c,d,e=this,f=!1,g=b&&!!b.dataSource;t(b)&&(c=!0,b={dataSource:b}),b&&typeof b.loadOnDemand==O&&t(b.dataSource)&&(b.loadOnDemand=!1),u.prototype.init.call(e,a,b),a=e.element,b=e.options,d=a.is("ul")&&a||a.hasClass(Q)&&a.children("ul"),f=!g&&d.length,f&&(b.dataSource.list=d),e._animation(),e._accessors(),e._templates(),a.hasClass(Q)?(e.wrapper=a,e.root=a.children("ul").eq(0)):(e._wrapper(),d&&(e.root=a,e._group(e.wrapper))),e._tabindex(),e.wrapper.filter("[role=tree]").length||e.wrapper.attr("role","tree"),e._dataSource(f),e._attachEvents(),e._dragging(),f?e._syncHtmlAndDataSource():b.autoBind&&(e._progress(!0),e.dataSource.fetch()),b.checkboxes&&b.checkboxes.checkChildren&&e.updateIndeterminate(),e.element[0].id&&(e._ariaId=o.format("{0}_tv_active",e.element[0].id))},_attachEvents:function(){var b=this,c=".k-in:not(.k-state-selected,.k-state-disabled)",d="mouseenter";b.wrapper.on(d+y,".k-in.k-state-selected",function(a){a.preventDefault()}).on(d+y,c,function(){a(this).addClass(P)}).on("mouseleave"+y,c,function(){a(this).removeClass(P)}).on(M+y,c,w(b._click,b)).on("dblclick"+y,".k-in:not(.k-state-disabled)",w(b._toggleButtonClick,b)).on(M+y,".k-plus,.k-minus",w(b._toggleButtonClick,b)).on("keydown"+y,w(b._keydown,b)).on("focus"+y,w(b._focus,b)).on("blur"+y,w(b._blur,b)).on("mousedown"+y,".k-in,.k-checkbox :checkbox,.k-plus,.k-minus",w(b._mousedown,b)).on("change"+y,".k-checkbox :checkbox",w(b._checkboxChange,b)).on("click"+y,".k-checkbox :checkbox",w(b._checkboxClick,b)).on("click"+y,".k-request-retry",w(b._retryRequest,b)).on("click"+y,function(c){a(c.target).is(":joyFocusable")||b.focus()})},_checkboxClick:function(b){var c=a(b.target);c.data(F)&&(c.data(F,!1).prop(F,!1).prop(E,!0),this._checkboxChange(b))},_syncHtmlAndDataSource:function(a,b){a=a||this.root,b=b||this.dataSource;var c,d,f,g=b.view(),h=o.attr("uid"),i=o.attr("expanded"),j=this.options.checkboxes,k=a.children("li");for(c=0;c<k.length;c++)f=g[c],d=k.eq(c),d.attr("role","treeitem").attr(h,f.uid),f.expanded="true"===d.attr(i),j&&(f.checked=e(d).prop(E)),this._syncHtmlAndDataSource(d.children("ul"),f.children)},_animation:function(){var a=this.options,b=a.animation;b===!1?b={expand:{effects:{}},collapse:{hide:!0,effects:{}}}:b.collapse&&"effects"in b.collapse||(b.collapse=r({reverse:!0},b.expand)),r(b.collapse,{hide:!0}),a.animation=b},_dragging:function(){var a=this.options.dragAndDrop,b=this.dragging;a&&!b?this.dragging=new i(this):!a&&b&&(b.destroy(),this.dragging=null)},_templates:function(){var b=this,c=b.options,e=w(b._fieldAccessor,b);if(c.templateID&&typeof c.templateID==T){var f=a("#"+c.templateID).html();c.template=s(f)}else c.templateID||(c.template=d("# var text = "+e("text")+"(data.item); ## if (typeof data.item.encoded != 'undefined' && data.item.encoded === false) {##= text ## } else { ##: text ## } #"));b._checkboxes(),b.templates={wrapperCssClass:function(a,b){var c="k-item",d=b.index;return a.firstLevel&&0===d&&(c+=" k-first"),d==a.length-1&&(c+=" k-last"),c},cssClass:function(a,b){var c="",d=b.index,e=a.length-1;return a.firstLevel&&0===d&&(c+="k-top "),c+=0===d&&d!=e?"k-top":d==e?"k-bot":"k-mid"},textClass:function(a){var b="k-in";return a.enabled===!1&&(b+=" k-state-disabled"),a.selected===!0&&(b+=" k-state-selected"),b},toggleButtonClass:function(a){var b="k-icon";return b+=a.expanded!==!0?" k-plus":" k-minus",a.enabled===!1&&(b+="-disabled"),b},groupAttributes:function(a){return a.expanded!==!0?" style='display:none'":""},groupCssClass:function(a){var b="k-group";return a.firstLevel&&(b+=" k-treeview-lines"),b},dragClue:d("<div class='k-header k-drag-clue'><span class='k-icon k-drag-status' />#= data.treeview.template(data) #</div>"),group:d("<ul class='#= data.r.groupCssClass(data.group) #'#= data.r.groupAttributes(data.group) # role='group'>#= data.renderItems(data) #</ul>"),itemContent:d("# var imageUrl = "+e("imageUrl")+"(data.item); ## var spriteCssClass = "+e("spriteCssClass")+"(data.item); ## if (imageUrl) { #<img class='k-image' alt='' src='#= imageUrl #'># } ## if (spriteCssClass) { #<span class='k-sprite #= spriteCssClass #' /># } ##= data.treeview.template(data) #"),itemElement:d("# var item = data.item, r = data.r; ## var url = "+e("url")+"(item); #<div class='#= r.cssClass(data.group, item) #'># if (item.hasChildren) { #<span class='#= r.toggleButtonClass(item) #' role='presentation' /># } ## if (data.treeview.checkboxes) { #<span class='k-checkbox' role='presentation'>#= data.treeview.checkboxes.template(data) #</span># } ## var tag = url ? 'a' : 'span'; ## var textAttr = url ? ' href=\\'' + url + '\\'' : ''; #<#=tag#  class='#= r.textClass(item) #'#= textAttr #>#= r.itemContent(data) #</#=tag#></div>"),item:d("# var item = data.item, r = data.r; #<li role='treeitem' class='#= r.wrapperCssClass(data.group, item) #' "+o.attr("uid")+"='#= item.uid #'#=item.selected ? \"aria-selected='true'\" : ''##=item.enabled === false ? \"aria-disabled='true'\" : ''#>#= r.itemElement(data) #</li>"),loading:d("<div class='k-icon k-loading' /> #: data.messages.loading #"),retry:d("#: data.messages.requestFailed # <button class='k-button k-request-retry'>#: data.messages.retry #</button>")}},items:function(){return this.element.find(".k-item")},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),this.dataSource.fetch()},_bindDataSource:function(){this._refreshHandler=w(this.refresh,this),this._errorHandler=w(this._error,this),this.dataSource.bind(C,this._refreshHandler),this.dataSource.bind(D,this._errorHandler)},_unbindDataSource:function(){var a=this.dataSource;a&&(a.unbind(C,this._refreshHandler),a.unbind(D,this._errorHandler))},_dataSource:function(a){function b(a){for(var c=0;c<a.length;c++)a[c]._initChildren(),a[c].children.fetch(),b(a[c].children.view())}var c=this,d=c.options,e=d.dataSource;e=t(e)?{data:e}:e,c._unbindDataSource(),e.fields||(e.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),c.dataSource=e=v.create(e),a&&(e.fetch(),b(e.view())),c._bindDataSource()},events:[H,I,J,K,L,B,G,z,C,A],options:{name:"TreeView",dataSource:{},animation:{expand:{effects:"expand:vertical",duration:200},collapse:{duration:100}},messages:{loading:"Loading...",requestFailed:"Request failed.",retry:"Retry"},dragAndDrop:!1,checkboxes:!1,autoBind:!0,loadOnDemand:!0,templateID:"",dataTextField:null},_accessors:function(){var a,b,c,d=this,e=d.options,f=d.element;for(a in W)b=e[W[a]],c=f.attr(o.attr(a+"-field")),!b&&c&&(b=c),b||(b=a),t(b)||(b=[b]),e[W[a]]=b},_fieldAccessor:function(b){var c=this.options[W[b]],d=c.length,e="(function(item) {";return 0===d?e+="return item['"+b+"'];":(e+="var levels = ["+a.map(c,function(a){return"function(d){ return "+o.expr(a)+"}"}).join(",")+"];",e+="return levels[Math.min(item.level(), "+d+"-1)](item)"),e+="})"},setOptions:function(a){u.fn.setOptions.call(this,a),this._animation(),this._dragging(),this._templates()},_trigger:function(a,b){return this.trigger(a,{node:b.closest(S)[0]})},_setChecked:function(b,c){if(b&&a.isFunction(b.view))for(var d=0,e=b.view();d<e.length;d++)e[d][E]=c,e[d].children&&this._setChecked(e[d].children,c)},_setIndeterminate:function(a){var b,c,d,f=k(a),g=!0;if(f.length&&(b=e(f.children()),c=b.length)){if(c>1){for(d=1;c>d;d++)if(b[d].checked!=b[d-1].checked||b[d].indeterminate||b[d-1].indeterminate){g=!1;break}}else g=!b[0].indeterminate;return e(a).data(F,!g).prop(F,!g).prop(E,g&&b[0].checked)}},updateIndeterminate:function(a){
a=a||this.wrapper;var b,c,d=k(a).children();if(d.length){for(b=0;b<d.length;b++)this.updateIndeterminate(d.eq(b));c=this._setIndeterminate(a),c&&c.prop(E)&&(this.dataItem(a).checked=!0)}},_bubbleIndeterminate:function(a){if(a.length){var b,c=this.parent(a);c.length&&(this._setIndeterminate(c),b=c.children("div").find(".k-checkbox :checkbox"),b.prop(F)===!1?this.dataItem(c).set(E,b.prop(E)):this.dataItem(c).checked=!1,this._bubbleIndeterminate(c))}},_checkboxChange:function(b){var c=a(b.target),d=c.prop(E),e=c.closest(S);this.dataItem(e).set(E,d)},_toggleButtonClick:function(b){this.toggle(a(b.target).closest(S))},_mousedown:function(b){var c=a(b.currentTarget).closest(S);this._clickTarget=c,this.current(c)},_focusable:function(a){return a&&a.length&&a.is(":visible")&&!a.find(".k-in:first").hasClass("k-state-disabled")},_focus:function(){var b=this.select(),c=this._clickTarget;o.support.touch||(c&&c.length&&(b=c),this._focusable(b)||(b=this.current()),this._focusable(b)||(b=this._nextVisible(a())),this.current(b))},focus:function(){var a,b=this.wrapper,c=b[0],d=[],e=[],f=document.documentElement;do c=c.parentNode,c.scrollHeight>c.clientHeight&&(d.push(c),e.push(c.scrollTop));while(c!=f);for(b.focus(),a=0;a<d.length;a++)d[a].scrollTop=e[a]},_blur:function(){this.current().find(".k-in:first").removeClass("k-state-focused")},_enabled:function(a){return!a.children("div").children(".k-in").hasClass("k-state-disabled")},parent:function(b){var c,d,e=/\bk-treeview\b/,f=/\bk-item\b/;typeof b==T&&(b=this.element.find(b)),X(b)||(b=b[0]),d=f.test(b.className);do b=b.parentNode,f.test(b.className)&&(d?c=b:d=!0);while(!e.test(b.className)&&!c);return a(c)},_nextVisible:function(a){function b(a){for(;a.length&&!a.next().length;)a=d.parent(a);return a.next().length?a.next():a}var c,d=this,e=d._expanded(a);return a.length&&a.is(":visible")?e?(c=k(a).children().first(),c.length||(c=b(a))):c=b(a):c=d.root.children().eq(0),d._enabled(c)||(c=d._nextVisible(c)),c},_previousVisible:function(a){var b,c,d=this;if(!a.length||a.prev().length)for(c=a.length?a.prev():d.root.children().last();d._expanded(c)&&(b=k(c).children().last(),b.length);)c=b;else c=d.parent(a)||a;return d._enabled(c)||(c=d._previousVisible(c)),c},_keydown:function(c){var d,e=this,f=c.keyCode,g=e.current(),h=e._expanded(g),i=g.find(".k-checkbox:first :checkbox"),j=o.support.isRtl(e.element);c.target==c.currentTarget&&(!j&&f==x.RIGHT||j&&f==x.LEFT?h?d=e._nextVisible(g):e.expand(g):!j&&f==x.LEFT||j&&f==x.RIGHT?h?e.collapse(g):(d=e.parent(g),e._enabled(d)||(d=b)):f==x.DOWN?d=e._nextVisible(g):f==x.UP?d=e._previousVisible(g):f==x.HOME?d=e._nextVisible(a()):f==x.END?d=e._previousVisible(a()):f==x.ENTER?g.find(".k-in:first").hasClass("k-state-selected")||e._trigger(z,g)||e.select(g):f==x.SPACEBAR&&i.length&&(i.prop(E,!i.prop(E)).data(F,!1).prop(F,!1),e._checkboxChange({target:i}),d=g),d&&(c.preventDefault(),g[0]!=d[0]&&(e._trigger(A,d),e.current(d))))},_click:function(b){var c,d=this,e=a(b.currentTarget),f=l(e.closest(S)),g=e.attr("href");c=g?"#"==g||g.indexOf("#"+this.element.id+"-")>=0:f.length&&!f.children().length,c&&b.preventDefault(),e.hasClass(".k-state-selected")||d._trigger(z,e)||d.select(e)},_wrapper:function(){var a,b,c=this,d=c.element,e="k-widget k-treeview";d.is("ul")?(a=d.wrap("<div />").parent(),b=d):(a=d,b=a.children("ul").eq(0)),c.wrapper=a.addClass(e),c.root=b},_group:function(a){var b=this,c=a.hasClass(Q),d={firstLevel:c,expanded:c||b._expanded(a)},e=a.children("ul");e.addClass(b.templates.groupCssClass(d)).css("display",d.expanded?"":"none"),b._nodes(e,d)},_nodes:function(b,c){var d,e=this,f=b.children("li");c=r({length:f.length},c),f.each(function(b,f){f=a(f),d={index:b,expanded:e._expanded(f)},h(f),e._updateNodeClasses(f,c,d),e._group(f)})},_checkboxes:function(){var a,b=this.options,c=b.checkboxes;(c||b.checkboxTemplate)&&(b.checkboxTemplate?a=b.checkboxTemplate:(a="<input type='checkbox' #= (item.enabled === false) ? 'disabled' : '' # #= item.checked ? 'checked' : '' #",c.name&&(a+=" name='"+c.name+"'"),a+=" />"),c=r({template:a},b.checkboxes),typeof c.template==T&&(c.template=s(c.template)),b.checkboxes=c)},_updateNodeClasses:function(a,b,c){var d=a.children("div"),e=a.children("ul"),f=this.templates;a.hasClass("k-treeview")||(c=c||{},c.expanded=typeof c.expanded!=O?c.expanded:this._expanded(a),c.index=typeof c.index!=O?c.index:a.index(),c.enabled=typeof c.enabled!=O?c.enabled:!d.children(".k-in").hasClass("k-state-disabled"),b=b||{},b.firstLevel=typeof b.firstLevel!=O?b.firstLevel:a.parent().parent().hasClass(Q),b.length=typeof b.length!=O?b.length:a.parent().children().length,a.removeClass("k-first k-last").addClass(f.wrapperCssClass(b,c)),d.removeClass("k-top k-mid k-bot").addClass(f.cssClass(b,c)),d.children(".k-in").removeClass("k-in k-state-default k-state-disabled").addClass(f.textClass(c)),(e.length||"true"==a.attr("data-hasChildren"))&&(d.children(".k-icon").removeClass("k-plus k-minus k-plus-disabled k-minus-disabled").addClass(f.toggleButtonClass(c)),e.addClass("k-group")))},_processNodes:function(b,c){var d=this;d.element.find(b).each(function(b,e){c.call(d,b,a(e).closest(S))})},dataItem:function(b){var c=a(b).closest(S).attr(o.attr("uid")),d=this.dataSource;return d&&d.getByUid(c)},_insertNode:function(b,c,d,e,f){var g,i,j,l,m=this,n=k(d),o=n.children().length+1,p={firstLevel:d.hasClass(Q),expanded:!f,length:o},q="",r=function(a,b){a.appendTo(b)};for(j=0;j<b.length;j++)l=b[j],l.index=c+j,q+=m._renderItem({group:p,item:l});if(i=a(q),i.length){for(n.length||(n=a(m._renderGroup({group:p})).appendTo(d)),e(i,n),d.hasClass("k-item")&&(h(d),m._updateNodeClasses(d)),m._updateNodeClasses(i.prev().first()),m._updateNodeClasses(i.next().last()),j=0;j<b.length;j++)l=b[j],l.hasChildren&&(g=l.children.data(),g.length&&m._insertNode(g,l.index,i.eq(j),r,!m._expanded(i.eq(j))));return i}},_updateNode:function(b,c){function d(){n=!0}function e(a,b){a.find(".k-checkbox :checkbox").prop(E,b).data(F,!1).prop(F,!1)}var f,g,h,i,j,k=this,m={treeview:k.options,item:h},n=!1;if("selected"==b)h=c[0],g=k.findByUid(h.uid).find(".k-in:first").removeClass("k-state-hover").toggleClass("k-state-selected",h[b]).end(),h[b]?(k.current(g),g.attr(U,!0)):g.attr(U,!1);else for(a.inArray(b,k.options.dataTextField)>=0?n=!0:(m.item=c[0],m.item.bind("get",d),k.templates.itemContent(m),m.item.unbind("set",d)),f=0;f<c.length;f++)m.item=h=c[f],("spriteCssClass"==b||"imageUrl"==b||n)&&k.findByUid(h.uid).find(">div>.k-in").html(k.templates.itemContent(m)),b==E?(g=k.findByUid(h.uid),i=h[b],e(g.children("div"),i),k.options.checkboxes.checkChildren&&(e(g.children(".k-group"),i),k._setChecked(h.children,i),k._bubbleIndeterminate(g))):"expanded"==b?k._toggle(k.findByUid(h.uid),h,h[b]):"enabled"==b&&(g=k.findByUid(h.uid),g.find(".k-checkbox :checkbox").prop("disabled",!h[b]),j=!l(g).is(R),g.removeAttr(V),h[b]||(h.selected&&h.set("selected",!1),h.expanded&&h.set("expanded",!1),j=!0,g.removeAttr(U).attr(V,!0)),k._updateNodeClasses(g,{},{enabled:h[b],expanded:!j}))},_appendItems:function(a,b,c){var d=k(c),e=d.children(),f=!this._expanded(c);typeof a==O&&(a=e.length),this._insertNode(b,a,c,function(b,c){a>=e.length?b.appendTo(c):b.insertBefore(e.eq(a))},f),this._expanded(c)&&(this._updateNodeClasses(c),k(c).css("display","block"))},refresh:function(c){var d,e=this,f=e.wrapper,g=c.node,i=c.action,j=c.items,l=e.options,m=l.loadOnDemand,n=l.checkboxes&&l.checkboxes.checkChildren;if(c.field){if(!j[0].level)return;return e._updateNode(c.field,j)}if(g&&(f=e.findByUid(g.uid),e._progress(f,!1)),n&&"remove"!=i&&g&&g.checked)for(d=0;d<j.length;d++)j[d].checked=!0;if("add"==i)this._appendItems(c.index,j,f);else if("remove"==i)e._remove(e.findByUid(j[0].uid),!1);else if(g)k(f).empty(),j.length?(this._appendItems(c.index,j,f),m&&n&&this._bubbleIndeterminate(k(f).children().last())):h(f);else{var o=e._renderGroup({items:j,group:{firstLevel:!0,expanded:!0}});if(e.root.length){var p=a(o);e.root.attr("class",p.attr("class")).attr("role",p.attr("role")).html(p.html())}else e.root=e.wrapper.html(o).children("ul")}for(d=0;d<j.length;d++)(!m||j[d].expanded)&&j[d].load();e.trigger(L,{node:g?f:b})},_error:function(a){var b=a.node&&this.findByUid(a.node.uid),c=this.templates.retry({messages:this.options.messages});b?(this._progress(b,!1),this._expanded(b,!1),m(b).addClass("k-i-refresh"),a.node.loaded(!1)):(this._progress(!1),this.element.html(c))},_retryRequest:function(a){a.preventDefault(),this.dataSource.fetch()},expand:function(a){this._processNodes(a,function(a,b){this.toggle(b,!0)})},collapse:function(a){this._processNodes(a,function(a,b){this.toggle(b,!1)})},enable:function(a,b){b=2==arguments.length?!!b:!0,this._processNodes(a,function(a,c){this.dataItem(c).set("enabled",b)})},current:function(b){var c=this,d=c._current,e=c.element,f=c._ariaId;return arguments.length>0&&b&&b.length?(d&&(d[0].id===f&&d.removeAttr("id"),d.find(".k-in:first").removeClass("k-state-focused")),d=c._current=a(b,e).closest(S),d.find(".k-in:first").addClass("k-state-focused"),f=d[0].id||f,void(f&&(c.wrapper.removeAttr("aria-activedescendant"),d.attr("id",f),c.wrapper.attr("aria-activedescendant",f)))):(d||(d=c._nextVisible(a())),d)},select:function(b){var c=this,d=c.element;return arguments.length?(b=a(b,d).closest(S),d.find(".k-state-selected").each(function(){var a=c.dataItem(this);a.set("selected",!1),delete a.selected}),b.length&&c.dataItem(b).set("selected",!0),void c.trigger(C)):d.find(".k-state-selected").closest(S)},_toggle:function(a,b,c){var d,e=this,f=e.options,g=l(a),h=c?"expand":"collapse",i=f.animation[h];if(!g.data("animating")&&!e._trigger(h,a))if(e._expanded(a,c),d=b&&b.loaded(),d&&g.children().length>0){if(e._updateNodeClasses(a,{},{expanded:c}),g.css("display")==(c?"block":"none"))return;c||g.css("height",g.height()).css("height"),g.joyStop(!0,!0).joyAnimate(r({reset:!0},i,{complete:function(){c&&g.css("height","")}}))}else c&&(f.loadOnDemand&&e._progress(a,!0),g.remove(),b.load())},toggle:function(b,c){b=a(b),m(b).is(".k-minus,.k-plus,.k-minus-disabled,.k-plus-disabled")&&(1==arguments.length&&(c=!this._expanded(b)),this._expanded(b,c))},destroy:function(){var a=this;u.fn.destroy.call(a),a.wrapper.off(y),a._unbindDataSource(),a.dragging&&a.dragging.destroy(),o.destroy(a.element),a.root=a.wrapper=a.element=null},_expanded:function(a,b){var c=o.attr("expanded"),d=this.dataItem(a);return 1==arguments.length?"true"===a.attr(c)||d&&d.expanded:void(l(a).data("animating")||(d&&(d.set("expanded",b),b=d.expanded),b?(a.attr(c,"true"),a.attr("aria-expanded","true")):(a.removeAttr(c),a.attr("aria-expanded","false"))))},_progress:function(a,b){var c=this.element,d=this.templates.loading({messages:this.options.messages});1==arguments.length?(b=a,b?c.html(d):c.empty()):m(a).toggleClass("k-loading",b).removeClass("k-i-refresh")},text:function(a,b){var c=this.dataItem(a),d=this.options[W.text],e=c.level(),f=d.length,g=d[Math.min(e,f-1)];return b?void c.set(g,b):c[g]},_objectOrSelf:function(b){return a(b).closest("[data-role=treeview]").data("joyTreeView")||this},_dataSourceMove:function(a,b,c,d){var e,f=this._objectOrSelf(c||b),g=f.dataSource;return c&&c[0]!=f.element[0]&&(e=f.dataItem(c),e.loaded()||(f._progress(c,!0),e.load()),c!=this.root&&(g=e.children,g&&g instanceof v||(e._initChildren(),e.loaded(!0),g=e.children))),a=this._toObservableData(a),d.call(this,g,a)},_toObservableData:function(b){var c,d,e=b;return(b instanceof window.jQuery||X(b))&&(c=this._objectOrSelf(b).dataSource,d=a(b).attr(o.attr("uid")),e=c.getByUid(d),e&&(e=c.remove(e))),e},_insert:function(a,b,c){b instanceof o.data.ObservableArray?b=b.toJSON():t(b)||(b=[b]);var d=a.parent();return d&&d._initChildren&&(d.hasChildren=!0,d._initChildren()),a.splice.apply(a,[c,0].concat(b)),this.findByUid(a[c].uid)},insertAfter:f(1),insertBefore:f(0),append:function(b,c,d,e){var f=this,g=f.root;return e=e||a.noop,c&&(g=k(c)),f._dataSourceMove(b,g,c,function(a,b){function g(){c&&f._expanded(c,!0);var e=a.data();return index=1==d?0:Math.max(e.length,0),f._insert(e,b,index)}var h;return a.data()?(h=g(),e(h),h):(a.one(C,function(){e(g())}),null)})},_remove:function(b,c){var d,e,f,g=this;return b=a(b,g.element),d=b.parent().parent(),e=b.prev(),f=b.next(),b[c?"detach":"remove"](),d.hasClass("k-item")&&(h(d),g._updateNodeClasses(d)),g._updateNodeClasses(e),g._updateNodeClasses(f),b},remove:function(a){var b=this.dataItem(a);b&&this.dataSource.remove(b)},detach:function(a){return this._remove(a,!0)},findByText:function(b){return a(this.element).find(".k-in").filter(function(c,d){return a.trim(a(d).text())==b}).closest(S)},findByUid:function(a){return this.element.find(".k-item["+o.attr("uid")+"="+a+"]")},expandPath:function(b,c){var d=this.dataSource,e=d.get(b[0]);for(c=c||a.noop;b.length>0&&(e.expanded||e.loaded());)e.set("expanded",!0),b.shift(),e=d.get(b[0]);return b.length?(d.bind("change",function(a){var e=a.node&&a.node.id;e&&e===b[0]&&(b.shift(),b.length?d.get(b[0]).set("expanded",!0):c())}),void e.set("expanded",!0)):c()},_renderItem:function(a){return a.group||(a.group={}),a.treeview=this.options,a.r=this.templates,this.templates.item(a)},_renderGroup:function(a){var b=this;return a.renderItems=function(a){var c="",d=0,e=a.items,f=e?e.length:0,g=a.group;for(g.length=f;f>d;d++)a.group=g,a.item=e[d],a.item.index=d,c+=b._renderItem(a);return c},a.r=b.templates,b.templates.group(a)}}),i.prototype={_removeTouchHover:function(){var a=this;o.support.touch&&a.hovered&&(a.hovered.find("."+P).removeClass(P),a.hovered=!1)},_hintStatus:function(b){var c=this._draggable.hint.find(".k-drag-status")[0];return b?void(c.className="k-icon k-drag-status "+b):a.trim(c.className.replace(/k-(icon|drag-status)/g,""))},dragstart:function(b){var c=this,d=c.treeview,e=c.sourceNode=b.currentTarget.closest(S);d.trigger(H,{sourceNode:e[0]})&&b.preventDefault(),c.dropHint=a("<div class='k-drop-hint' />").css(N,"hidden").appendTo(d.element)},drag:function(b){var c,d,e,f,g,h,i,j,k,l,m=this,n=m.treeview,p=m.sourceNode,q=m.dropTarget=a(o.eventTarget(b)),r=q.closest(".k-treeview");r.length?a.contains(p[0],q[0])?c="k-denied":(c="k-insert-middle",d=q.closest(".k-top,.k-mid,.k-bot"),d.length?(f=d.outerHeight(),g=o.getOffset(d).top,h=q.closest(".k-in"),i=f/(h.length>0?4:2),j=b.y.location<g+i,k=g+f-i<b.y.location,m._removeTouchHover(),l=h.length&&!j&&!k,m.hovered=l?r:!1,m.dropHint.css(N,l?"hidden":"visible"),h.toggleClass(P,l),l?c="k-add":(e=d.position(),e.top+=j?0:f,m.dropHint.css(e)[j?"prependTo":"appendTo"](q.closest(S).children("div:first")),j&&d.hasClass("k-top")&&(c="k-insert-top"),k&&d.hasClass("k-bot")&&(c="k-insert-bottom"))):q[0]!=m.dropHint[0]&&(c=r[0]!=n.element[0]?"k-add":"k-denied")):(c="k-denied",m._removeTouchHover()),n.trigger(I,{sourceNode:p[0],dropTarget:q[0],pageY:b.y.location,pageX:b.x.location,statusClass:c.substring(2),setStatusClass:function(a){c=a}}),0!==c.indexOf("k-insert")&&m.dropHint.css(N,"hidden"),m._hintStatus(c)},dragcancel:function(){this.dropHint.remove()},dragend:function(){function a(a){f.trigger(K,{sourceNode:a&&a[0],destinationNode:b[0],dropPosition:g})}var b,c,d,e=this,f=e.treeview,g="over",h=e.sourceNode,i=e.dropHint,j=e.dropTarget;return"visible"==i.css(N)?(g=i.prevAll(".k-in").length>0?"after":"before",b=i.closest(S)):j&&(b=j.closest(S),b.length||(b=j.closest(".k-treeview"))),c={sourceNode:h[0],destinationNode:b[0],valid:"k-denied"!=e._hintStatus(),setValid:function(a){this.valid=a},dropTarget:j[0],dropPosition:g},d=f.trigger(J,c),i.remove(),e._removeTouchHover(),!c.valid||d?void(e._draggable.dropped=c.valid):(e._draggable.dropped=!0,void("over"==g?f.append(h,b,a):("before"==g?h=f.insertBefore(h,b):"after"==g&&(h=f.insertAfter(h,b)),a(h))))},destroy:function(){this._draggable.destroy()}},p.plugin(j)}(window.joy.jQuery);